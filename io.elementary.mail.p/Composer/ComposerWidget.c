/* ComposerWidget.c generated by valac 0.56.3, the Vala compiler
 * generated from ComposerWidget.vala, do not modify */

/* -*- Mode: vala; indent-tabs-mode: nil; tab-width: 4 -*-*/
/*-
 * Copyright (c) 2017 elementary LLC. (https://elementary.io)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Authored by: David Hewitt <davidmhewitt@gmail.com>
 */

#include <gtk/gtk.h>
#include <glib-object.h>
#include <glib.h>
#include <stdlib.h>
#include <string.h>
#include <camel/camel.h>
#include <webkit2/webkit2.h>
#include <gio/gio.h>
#include <granite.h>
#include <glib/gi18n-lib.h>
#include <libedataserver/libedataserver.h>
#include <gee.h>
#include <handy.h>
#include <float.h>
#include <math.h>

#define MAIL_COMPOSER_WIDGET_ACTION_GROUP_PREFIX "composer"
#define MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_GROUP_PREFIX "."
#define MAIL_COMPOSER_WIDGET_ACTION_ADD_ATTACHMENT "add-attachment"
#define MAIL_COMPOSER_WIDGET_ACTION_BOLD "bold"
#define MAIL_COMPOSER_WIDGET_ACTION_ITALIC "italic"
#define MAIL_COMPOSER_WIDGET_ACTION_UNDERLINE "underline"
#define MAIL_COMPOSER_WIDGET_ACTION_STRIKETHROUGH "strikethrough"
#define MAIL_COMPOSER_WIDGET_ACTION_INSERT_LINK "insert_link"
#define MAIL_COMPOSER_WIDGET_ACTION_REMOVE_FORMAT "remove_formatting"
#define MAIL_COMPOSER_WIDGET_ACTION_DISCARD "discard"
#define MAIL_COMPOSER_WIDGET_ACTION_SEND "send"
#if !defined(VALA_EXTERN)
#if defined(_MSC_VER)
#define VALA_EXTERN __declspec(dllexport) extern
#elif __GNUC__ >= 4
#define VALA_EXTERN __attribute__((visibility("default"))) extern
#else
#define VALA_EXTERN extern
#endif
#endif

#define MAIL_TYPE_COMPOSER_WIDGET (mail_composer_widget_get_type ())
#define MAIL_COMPOSER_WIDGET(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), MAIL_TYPE_COMPOSER_WIDGET, MailComposerWidget))
#define MAIL_COMPOSER_WIDGET_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), MAIL_TYPE_COMPOSER_WIDGET, MailComposerWidgetClass))
#define MAIL_IS_COMPOSER_WIDGET(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), MAIL_TYPE_COMPOSER_WIDGET))
#define MAIL_IS_COMPOSER_WIDGET_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), MAIL_TYPE_COMPOSER_WIDGET))
#define MAIL_COMPOSER_WIDGET_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), MAIL_TYPE_COMPOSER_WIDGET, MailComposerWidgetClass))

typedef struct _MailComposerWidget MailComposerWidget;
typedef struct _MailComposerWidgetClass MailComposerWidgetClass;
typedef struct _MailComposerWidgetPrivate MailComposerWidgetPrivate;

#define MAIL_TYPE_WEB_VIEW (mail_web_view_get_type ())
#define MAIL_WEB_VIEW(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), MAIL_TYPE_WEB_VIEW, MailWebView))
#define MAIL_WEB_VIEW_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), MAIL_TYPE_WEB_VIEW, MailWebViewClass))
#define MAIL_IS_WEB_VIEW(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), MAIL_TYPE_WEB_VIEW))
#define MAIL_IS_WEB_VIEW_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), MAIL_TYPE_WEB_VIEW))
#define MAIL_WEB_VIEW_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), MAIL_TYPE_WEB_VIEW, MailWebViewClass))

typedef struct _MailWebView MailWebView;
typedef struct _MailWebViewClass MailWebViewClass;
enum  {
	MAIL_COMPOSER_WIDGET_0_PROPERTY,
	MAIL_COMPOSER_WIDGET_HAS_RECIPIENTS_PROPERTY,
	MAIL_COMPOSER_WIDGET_HAS_SUBJECT_FIELD_PROPERTY,
	MAIL_COMPOSER_WIDGET_CAN_CHANGE_SENDER_PROPERTY,
	MAIL_COMPOSER_WIDGET_TO_PROPERTY,
	MAIL_COMPOSER_WIDGET_MAILTO_QUERY_PROPERTY,
	MAIL_COMPOSER_WIDGET_NUM_PROPERTIES
};
static GParamSpec* mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_NUM_PROPERTIES];
typedef enum  {
	MAIL_COMPOSER_WIDGET_TYPE_REPLY,
	MAIL_COMPOSER_WIDGET_TYPE_REPLY_ALL,
	MAIL_COMPOSER_WIDGET_TYPE_FORWARD,
	MAIL_COMPOSER_WIDGET_TYPE_DRAFT
} MailComposerWidgetType;

#define MAIL_COMPOSER_WIDGET_TYPE_TYPE (mail_composer_widget_type_get_type ())
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_regex_unref0(var) ((var == NULL) ? NULL : (var = (g_regex_unref (var), NULL)))

#define MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT (mail_composer_widget_attachment_get_type ())
#define MAIL_COMPOSER_WIDGET_ATTACHMENT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, MailComposerWidgetAttachment))
#define MAIL_COMPOSER_WIDGET_ATTACHMENT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, MailComposerWidgetAttachmentClass))
#define MAIL_COMPOSER_WIDGET_IS_ATTACHMENT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT))
#define MAIL_COMPOSER_WIDGET_IS_ATTACHMENT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT))
#define MAIL_COMPOSER_WIDGET_ATTACHMENT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, MailComposerWidgetAttachmentClass))

typedef struct _MailComposerWidgetAttachment MailComposerWidgetAttachment;
typedef struct _MailComposerWidgetAttachmentClass MailComposerWidgetAttachmentClass;
typedef struct _Block15Data Block15Data;

#define TYPE_INSERT_LINK_DIALOG (insert_link_dialog_get_type ())
#define INSERT_LINK_DIALOG(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_INSERT_LINK_DIALOG, InsertLinkDialog))
#define INSERT_LINK_DIALOG_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_INSERT_LINK_DIALOG, InsertLinkDialogClass))
#define IS_INSERT_LINK_DIALOG(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_INSERT_LINK_DIALOG))
#define IS_INSERT_LINK_DIALOG_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_INSERT_LINK_DIALOG))
#define INSERT_LINK_DIALOG_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_INSERT_LINK_DIALOG, InsertLinkDialogClass))

typedef struct _InsertLinkDialog InsertLinkDialog;
typedef struct _InsertLinkDialogClass InsertLinkDialogClass;
typedef struct _MailComposerWidgetAskInsertLinkData MailComposerWidgetAskInsertLinkData;

#define MAIL_BACKEND_TYPE_SESSION (mail_backend_session_get_type ())
#define MAIL_BACKEND_SESSION(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), MAIL_BACKEND_TYPE_SESSION, MailBackendSession))
#define MAIL_BACKEND_SESSION_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), MAIL_BACKEND_TYPE_SESSION, MailBackendSessionClass))
#define MAIL_BACKEND_IS_SESSION(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), MAIL_BACKEND_TYPE_SESSION))
#define MAIL_BACKEND_IS_SESSION_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), MAIL_BACKEND_TYPE_SESSION))
#define MAIL_BACKEND_SESSION_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), MAIL_BACKEND_TYPE_SESSION, MailBackendSessionClass))

typedef struct _MailBackendSession MailBackendSession;
typedef struct _MailBackendSessionClass MailBackendSessionClass;
typedef struct _Block16Data Block16Data;
typedef gboolean (*MailUtilsAcceptAddress) (const gchar* address, gpointer user_data);
#define _g_date_time_unref0(var) ((var == NULL) ? NULL : (var = (g_date_time_unref (var), NULL)))
#define _g_variant_unref0(var) ((var == NULL) ? NULL : (var = (g_variant_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))
typedef struct _MailComposerWidgetSendMessageData MailComposerWidgetSendMessageData;
typedef struct _Block17Data Block17Data;

#define MAIL_TYPE_MAIN_WINDOW (mail_main_window_get_type ())
#define MAIL_MAIN_WINDOW(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), MAIL_TYPE_MAIN_WINDOW, MailMainWindow))
#define MAIL_MAIN_WINDOW_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), MAIL_TYPE_MAIN_WINDOW, MailMainWindowClass))
#define MAIL_IS_MAIN_WINDOW(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), MAIL_TYPE_MAIN_WINDOW))
#define MAIL_IS_MAIN_WINDOW_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), MAIL_TYPE_MAIN_WINDOW))
#define MAIL_MAIN_WINDOW_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), MAIL_TYPE_MAIN_WINDOW, MailMainWindowClass))

typedef struct _MailMainWindow MailMainWindow;
typedef struct _MailMainWindowClass MailMainWindowClass;

#define MAIL_TYPE_COMPOSER_WINDOW (mail_composer_window_get_type ())
#define MAIL_COMPOSER_WINDOW(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), MAIL_TYPE_COMPOSER_WINDOW, MailComposerWindow))
#define MAIL_COMPOSER_WINDOW_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), MAIL_TYPE_COMPOSER_WINDOW, MailComposerWindowClass))
#define MAIL_IS_COMPOSER_WINDOW(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), MAIL_TYPE_COMPOSER_WINDOW))
#define MAIL_IS_COMPOSER_WINDOW_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), MAIL_TYPE_COMPOSER_WINDOW))
#define MAIL_COMPOSER_WINDOW_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), MAIL_TYPE_COMPOSER_WINDOW, MailComposerWindowClass))

typedef struct _MailComposerWindow MailComposerWindow;
typedef struct _MailComposerWindowClass MailComposerWindowClass;
typedef struct _MailComposerWidgetAttachmentPrivate MailComposerWidgetAttachmentPrivate;
enum  {
	MAIL_COMPOSER_WIDGET_ATTACHMENT_0_PROPERTY,
	MAIL_COMPOSER_WIDGET_ATTACHMENT_INFO_PROPERTY,
	MAIL_COMPOSER_WIDGET_ATTACHMENT_FILE_PROPERTY,
	MAIL_COMPOSER_WIDGET_ATTACHMENT_NUM_PROPERTIES
};
static GParamSpec* mail_composer_widget_attachment_properties[MAIL_COMPOSER_WIDGET_ATTACHMENT_NUM_PROPERTIES];

#define MAIL_COMPOSER_WIDGET_TYPE_ENTRY_GRID (mail_composer_widget_entry_grid_get_type ())
#define MAIL_COMPOSER_WIDGET_ENTRY_GRID(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), MAIL_COMPOSER_WIDGET_TYPE_ENTRY_GRID, MailComposerWidgetEntryGrid))
#define MAIL_COMPOSER_WIDGET_ENTRY_GRID_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), MAIL_COMPOSER_WIDGET_TYPE_ENTRY_GRID, MailComposerWidgetEntryGridClass))
#define MAIL_COMPOSER_WIDGET_IS_ENTRY_GRID(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), MAIL_COMPOSER_WIDGET_TYPE_ENTRY_GRID))
#define MAIL_COMPOSER_WIDGET_IS_ENTRY_GRID_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), MAIL_COMPOSER_WIDGET_TYPE_ENTRY_GRID))
#define MAIL_COMPOSER_WIDGET_ENTRY_GRID_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), MAIL_COMPOSER_WIDGET_TYPE_ENTRY_GRID, MailComposerWidgetEntryGridClass))

typedef struct _MailComposerWidgetEntryGrid MailComposerWidgetEntryGrid;
typedef struct _MailComposerWidgetEntryGridClass MailComposerWidgetEntryGridClass;
typedef struct _MailComposerWidgetEntryGridPrivate MailComposerWidgetEntryGridPrivate;
enum  {
	MAIL_COMPOSER_WIDGET_ENTRY_GRID_0_PROPERTY,
	MAIL_COMPOSER_WIDGET_ENTRY_GRID_NUM_PROPERTIES
};
static GParamSpec* mail_composer_widget_entry_grid_properties[MAIL_COMPOSER_WIDGET_ENTRY_GRID_NUM_PROPERTIES];
typedef struct _Block18Data Block18Data;
#define _g_bytes_unref0(var) ((var == NULL) ? NULL : (var = (g_bytes_unref (var), NULL)))

#define MAIL_TYPE_CONTACT_MANAGER (mail_contact_manager_get_type ())
#define MAIL_CONTACT_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), MAIL_TYPE_CONTACT_MANAGER, MailContactManager))
#define MAIL_CONTACT_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), MAIL_TYPE_CONTACT_MANAGER, MailContactManagerClass))
#define MAIL_IS_CONTACT_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), MAIL_TYPE_CONTACT_MANAGER))
#define MAIL_IS_CONTACT_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), MAIL_TYPE_CONTACT_MANAGER))
#define MAIL_CONTACT_MANAGER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), MAIL_TYPE_CONTACT_MANAGER, MailContactManagerClass))

typedef struct _MailContactManager MailContactManager;
typedef struct _MailContactManagerClass MailContactManagerClass;
enum  {
	MAIL_COMPOSER_WIDGET_DISCARDED_SIGNAL,
	MAIL_COMPOSER_WIDGET_SENT_SIGNAL,
	MAIL_COMPOSER_WIDGET_SUBJECT_CHANGED_SIGNAL,
	MAIL_COMPOSER_WIDGET_NUM_SIGNALS
};
static guint mail_composer_widget_signals[MAIL_COMPOSER_WIDGET_NUM_SIGNALS] = {0};

struct _MailComposerWidget {
	GtkGrid parent_instance;
	MailComposerWidgetPrivate * priv;
};

struct _MailComposerWidgetClass {
	GtkGridClass parent_class;
};

struct _MailComposerWidgetPrivate {
	gboolean _has_recipients;
	gboolean _has_subject_field;
	gboolean _can_change_sender;
	gchar* _to;
	gchar* _mailto_query;
	gboolean discard_draft;
	CamelMessageInfo* ancestor_message_info;
	MailWebView* web_view;
	GSimpleActionGroup* actions;
	GtkEntry* to_val;
	GtkEntry* cc_val;
	GtkEntry* bcc_val;
	GtkFlowBox* attachment_box;
	GtkRevealer* from_revealer;
	GtkRevealer* cc_revealer;
	GtkRevealer* bcc_revealer;
	GtkToggleButton* cc_button;
	GraniteWidgetsOverlayBar* message_url_overlay;
	GtkComboBoxText* from_combo;
	GtkEntry* subject_val;
};

struct _Block15Data {
	int _ref_count_;
	MailComposerWidget* self;
	gchar* selected_text;
	gpointer _async_data_;
};

struct _MailComposerWidgetAskInsertLinkData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GTask* _async_result;
	MailComposerWidget* self;
	Block15Data* _data15_;
	MailWebView* _tmp0_;
	gchar* _tmp1_;
	InsertLinkDialog* insert_link_dialog;
	InsertLinkDialog* _tmp2_;
	GtkWidget* _tmp3_;
};

struct _Block16Data {
	int _ref_count_;
	MailComposerWidget* self;
	gchar* identity_address;
};

struct _MailComposerWidgetSendMessageData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GTask* _async_result;
	MailComposerWidget* self;
	GtkEntry* _tmp0_;
	const gchar* _tmp1_;
	const gchar* _tmp2_;
	GraniteMessageDialog* no_subject_dialog;
	GraniteMessageDialog* _tmp3_;
	GraniteMessageDialog* _tmp4_;
	GtkWidget* _tmp5_;
	GraniteMessageDialog* _tmp6_;
	GtkWidget* send_anyway;
	GraniteMessageDialog* _tmp7_;
	GtkWidget* _tmp8_;
	GtkWidget* _tmp9_;
	GtkWidget* _tmp10_;
	GtkStyleContext* _tmp11_;
	GraniteMessageDialog* _tmp12_;
	GraniteMessageDialog* _tmp13_;
	GraniteMessageDialog* _tmp14_;
	MailBackendSession* session;
	MailBackendSession* _tmp15_;
	gchar* body_html;
	MailWebView* _tmp16_;
	gchar* _tmp17_;
	CamelMimeMessage* message;
	const gchar* _tmp18_;
	CamelMimeMessage* _tmp19_;
	CamelInternetAddress* sender;
	CamelMimeMessage* _tmp20_;
	GtkComboBoxText* _tmp21_;
	gchar* _tmp22_;
	gchar* _tmp23_;
	CamelInternetAddress* _tmp24_;
	CamelInternetAddress* _tmp25_;
	CamelInternetAddress* recipients;
	CamelMimeMessage* _tmp26_;
	GtkEntry* _tmp27_;
	const gchar* _tmp28_;
	const gchar* _tmp29_;
	GtkEntry* _tmp30_;
	const gchar* _tmp31_;
	const gchar* _tmp32_;
	GtkEntry* _tmp33_;
	const gchar* _tmp34_;
	const gchar* _tmp35_;
	CamelInternetAddress* _tmp36_;
	gboolean sent_message_saved;
	MailBackendSession* _tmp37_;
	CamelMimeMessage* _tmp38_;
	CamelInternetAddress* _tmp39_;
	CamelInternetAddress* _tmp40_;
	GraniteMessageDialog* warning_dialog;
	GThemedIcon* _tmp41_;
	GThemedIcon* _tmp42_;
	GThemedIcon* _tmp43_;
	GraniteMessageDialog* _tmp44_;
	GraniteMessageDialog* _tmp45_;
	GraniteMessageDialog* _tmp46_;
	GraniteMessageDialog* _tmp47_;
	GError* e;
	GraniteMessageDialog* error_dialog;
	GThemedIcon* _tmp48_;
	GThemedIcon* _tmp49_;
	GThemedIcon* _tmp50_;
	GraniteMessageDialog* _tmp51_;
	GraniteMessageDialog* _tmp52_;
	GraniteMessageDialog* _tmp53_;
	GError* _tmp54_;
	const gchar* _tmp55_;
	GraniteMessageDialog* _tmp56_;
	GraniteMessageDialog* _tmp57_;
	GError* _inner_error1_;
	GError* _inner_error0_;
};

struct _Block17Data {
	int _ref_count_;
	MailComposerWidget* self;
	MailBackendSession* session;
};

struct _MailComposerWidgetAttachment {
	GtkFlowBoxChild parent_instance;
	MailComposerWidgetAttachmentPrivate * priv;
};

struct _MailComposerWidgetAttachmentClass {
	GtkFlowBoxChildClass parent_class;
};

struct _MailComposerWidgetAttachmentPrivate {
	GFileInfo* _info;
	GFile* _file;
};

struct _MailComposerWidgetEntryGrid {
	GtkGrid parent_instance;
	MailComposerWidgetEntryGridPrivate * priv;
};

struct _MailComposerWidgetEntryGridClass {
	GtkGridClass parent_class;
};

struct _Block18Data {
	int _ref_count_;
	MailComposerWidget* self;
	GtkToggleButton* bcc_button;
	MailComposerWidgetEntryGrid* to_grid;
};

static gint MailComposerWidget_private_offset;
static gpointer mail_composer_widget_parent_class = NULL;
static gint MailComposerWidgetAttachment_private_offset;
static gpointer mail_composer_widget_attachment_parent_class = NULL;
static gpointer mail_composer_widget_entry_grid_parent_class = NULL;

VALA_EXTERN GType mail_composer_widget_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (MailComposerWidget, g_object_unref)
VALA_EXTERN GType mail_web_view_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (MailWebView, g_object_unref)
VALA_EXTERN GType mail_composer_widget_type_get_type (void) G_GNUC_CONST ;
static void mail_composer_widget_on_add_attachment (MailComposerWidget* self);
static void _mail_composer_widget_on_add_attachment_gsimple_action_activate_callback (GSimpleAction* action,
                                                                               GVariant* parameter,
                                                                               gpointer self);
static void mail_composer_widget_on_edit_action (MailComposerWidget* self,
                                          GSimpleAction* action,
                                          GVariant* param);
static void _mail_composer_widget_on_edit_action_gsimple_action_activate_callback (GSimpleAction* action,
                                                                            GVariant* parameter,
                                                                            gpointer self);
static void mail_composer_widget_on_insert_link_clicked (MailComposerWidget* self);
static void _mail_composer_widget_on_insert_link_clicked_gsimple_action_activate_callback (GSimpleAction* action,
                                                                                    GVariant* parameter,
                                                                                    gpointer self);
static void mail_composer_widget_on_remove_format (MailComposerWidget* self);
static void _mail_composer_widget_on_remove_format_gsimple_action_activate_callback (GSimpleAction* action,
                                                                              GVariant* parameter,
                                                                              gpointer self);
static void mail_composer_widget_on_discard (MailComposerWidget* self);
static void _mail_composer_widget_on_discard_gsimple_action_activate_callback (GSimpleAction* action,
                                                                        GVariant* parameter,
                                                                        gpointer self);
static void mail_composer_widget_on_send (MailComposerWidget* self);
static void _mail_composer_widget_on_send_gsimple_action_activate_callback (GSimpleAction* action,
                                                                     GVariant* parameter,
                                                                     gpointer self);
VALA_EXTERN MailComposerWidget* mail_composer_widget_new_inline (void);
VALA_EXTERN MailComposerWidget* mail_composer_widget_construct_inline (GType object_type);
VALA_EXTERN MailComposerWidget* mail_composer_widget_new_with_subject (void);
VALA_EXTERN MailComposerWidget* mail_composer_widget_construct_with_subject (GType object_type);
VALA_EXTERN MailComposerWidget* mail_composer_widget_new_with_headers (const gchar* to,
                                                           const gchar* mailto_query);
VALA_EXTERN MailComposerWidget* mail_composer_widget_construct_with_headers (GType object_type,
                                                                 const gchar* to,
                                                                 const gchar* mailto_query);
static void mail_composer_widget_on_sanitize_recipient_entry (MailComposerWidget* self,
                                                       GtkEntry* entry);
static GType mail_composer_widget_attachment_get_type (void) G_GNUC_CONST  G_GNUC_UNUSED ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (MailComposerWidgetAttachment, g_object_unref)
static MailComposerWidgetAttachment* mail_composer_widget_attachment_new (GFile* file);
static MailComposerWidgetAttachment* mail_composer_widget_attachment_construct (GType object_type,
                                                                         GFile* file);
static void _g_object_unref0_ (gpointer var);
static inline void _g_slist_free__g_object_unref0_ (GSList* self);
static void mail_composer_widget_ask_insert_link (MailComposerWidget* self,
                                           GAsyncReadyCallback _callback_,
                                           gpointer _user_data_);
static void mail_composer_widget_ask_insert_link_finish (MailComposerWidget* self,
                                                  GAsyncResult* _res_);
static void mail_composer_widget_ask_insert_link_data_free (gpointer _data);
static gboolean mail_composer_widget_ask_insert_link_co (MailComposerWidgetAskInsertLinkData* _data_);
static Block15Data* block15_data_ref (Block15Data* _data15_);
static void block15_data_unref (void * _userdata_);
VALA_EXTERN void mail_web_view_get_selected_text (MailWebView* self,
                                      GAsyncReadyCallback _callback_,
                                      gpointer _user_data_);
VALA_EXTERN gchar* mail_web_view_get_selected_text_finish (MailWebView* self,
                                               GAsyncResult* _res_);
static void mail_composer_widget_ask_insert_link_ready (GObject* source_object,
                                                 GAsyncResult* _res_,
                                                 gpointer _user_data_);
VALA_EXTERN GType insert_link_dialog_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (InsertLinkDialog, g_object_unref)
VALA_EXTERN InsertLinkDialog* insert_link_dialog_new (const gchar* text);
VALA_EXTERN InsertLinkDialog* insert_link_dialog_construct (GType object_type,
                                                const gchar* text);
static void __lambda58_ (Block15Data* _data15_,
                  const gchar* url,
                  const gchar* title);
static void mail_composer_widget_on_link_inserted (MailComposerWidget* self,
                                            const gchar* url,
                                            const gchar* title,
                                            const gchar* selected_text);
static void ___lambda58__insert_link_dialog_insert_link (InsertLinkDialog* _sender,
                                                  const gchar* url,
                                                  const gchar* title,
                                                  gpointer self);
VALA_EXTERN void mail_web_view_execute_editor_command (MailWebView* self,
                                           const gchar* command,
                                           const gchar* argument);
static void mail_composer_widget_on_mouse_target_changed (MailComposerWidget* self,
                                                   WebKitWebView* web_view,
                                                   WebKitHitTestResult* hit_test,
                                                   guint mods);
VALA_EXTERN void mail_composer_widget_quote_content (MailComposerWidget* self,
                                         MailComposerWidgetType type,
                                         CamelMessageInfo* info,
                                         CamelMimeMessage* message,
                                         const gchar* content_to_quote);
static void mail_composer_widget_set_can_change_sender (MailComposerWidget* self,
                                                 gboolean value);
VALA_EXTERN GType mail_backend_session_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (MailBackendSession, g_object_unref)
VALA_EXTERN MailBackendSession* mail_backend_session_get_default (void);
VALA_EXTERN ESource* mail_backend_session_ref_source (MailBackendSession* self,
                                          const gchar* source_uid);
static Block16Data* block16_data_ref (Block16Data* _data16_);
static void block16_data_unref (void * _userdata_);
static gboolean _______lambda59_ (Block16Data* _data16_,
                           GtkTreeModel* model,
                           GtkTreePath* path,
                           GtkTreeIter* iter);
static gboolean ________lambda59__gtk_tree_model_foreach_func (GtkTreeModel* model,
                                                        GtkTreePath* path,
                                                        GtkTreeIter* iter,
                                                        gpointer self);
VALA_EXTERN gchar* mail_utils_get_reply_addresses (const gchar* raw_addresses,
                                       MailUtilsAcceptAddress should_add,
                                       gpointer should_add_target);
static gboolean ______lambda60_ (MailComposerWidget* self,
                          const gchar* address);
static gboolean _______lambda60__mail_utils_accept_address (const gchar* address,
                                                     gpointer self);
static gboolean _______lambda61_ (MailComposerWidget* self,
                           const gchar* address);
static gboolean ________lambda61__mail_utils_accept_address (const gchar* address,
                                                      gpointer self);
VALA_EXTERN gchar* mail_utils_escape_html_tags (const gchar* input);
VALA_EXTERN void mail_web_view_set_body_content (MailWebView* self,
                                     gchar* content);
static void mail_composer_widget_update_actions (MailComposerWidget* self);
VALA_EXTERN void mail_web_view_query_command_state (MailWebView* self,
                                        const gchar* command,
                                        GAsyncReadyCallback _callback_,
                                        gpointer _user_data_);
VALA_EXTERN gboolean mail_web_view_query_command_state_finish (MailWebView* self,
                                                   GAsyncResult* _res_);
static void __lambda52_ (MailComposerWidget* self,
                  GObject* obj,
                  GAsyncResult* res);
static GVariant* _variant_new1 (const gchar* value);
static void ___lambda52__gasync_ready_callback (GObject* source_object,
                                         GAsyncResult* res,
                                         gpointer self);
static void __lambda53_ (MailComposerWidget* self,
                  GObject* obj,
                  GAsyncResult* res);
static GVariant* _variant_new2 (const gchar* value);
static void ___lambda53__gasync_ready_callback (GObject* source_object,
                                         GAsyncResult* res,
                                         gpointer self);
static void __lambda54_ (MailComposerWidget* self,
                  GObject* obj,
                  GAsyncResult* res);
static GVariant* _variant_new3 (const gchar* value);
static void ___lambda54__gasync_ready_callback (GObject* source_object,
                                         GAsyncResult* res,
                                         gpointer self);
static void __lambda55_ (MailComposerWidget* self,
                  GObject* obj,
                  GAsyncResult* res);
static GVariant* _variant_new4 (const gchar* value);
static void ___lambda55__gasync_ready_callback (GObject* source_object,
                                         GAsyncResult* res,
                                         gpointer self);
static void mail_composer_widget_send_message (MailComposerWidget* self,
                                        GAsyncReadyCallback _callback_,
                                        gpointer _user_data_);
static void mail_composer_widget_send_message_finish (MailComposerWidget* self,
                                               GAsyncResult* _res_);
static void mail_composer_widget_send_message_data_free (gpointer _data);
static gboolean mail_composer_widget_send_message_co (MailComposerWidgetSendMessageData* _data_);
VALA_EXTERN void mail_web_view_get_body_html (MailWebView* self,
                                  GAsyncReadyCallback _callback_,
                                  gpointer _user_data_);
VALA_EXTERN gchar* mail_web_view_get_body_html_finish (MailWebView* self,
                                           GAsyncResult* _res_);
static void mail_composer_widget_send_message_ready (GObject* source_object,
                                              GAsyncResult* _res_,
                                              gpointer _user_data_);
static CamelMimeMessage* mail_composer_widget_build_message (MailComposerWidget* self,
                                                      const gchar* body_html);
static CamelInternetAddress* mail_composer_widget_build_sender (MailComposerWidget* self,
                                                         CamelMimeMessage* message,
                                                         const gchar* from);
static CamelInternetAddress* mail_composer_widget_build_recipients (MailComposerWidget* self,
                                                             CamelMimeMessage* message,
                                                             const gchar* to,
                                                             const gchar* cc,
                                                             const gchar* bcc);
VALA_EXTERN void mail_backend_session_send_email (MailBackendSession* self,
                                      CamelMimeMessage* message,
                                      CamelInternetAddress* from,
                                      CamelAddress* recipients,
                                      GAsyncReadyCallback _callback_,
                                      gpointer _user_data_);
VALA_EXTERN gboolean mail_backend_session_send_email_finish (MailBackendSession* self,
                                                 GAsyncResult* _res_,
                                                 GError** error);
static CamelMimePart* mail_composer_widget_attachment_get_mime_part (MailComposerWidgetAttachment* self);
static void mail_composer_widget_load_from_combobox (MailComposerWidget* self);
VALA_EXTERN GeeArrayList* mail_backend_session_get_own_addresses (MailBackendSession* self);
static void mail_composer_widget_real_destroy (GtkWidget* base);
VALA_EXTERN gboolean mail_web_view_get_body_html_changed (MailWebView* self);
static void __lambda62_ (MailComposerWidget* self,
                  GObject* obj,
                  GAsyncResult* res);
static Block17Data* block17_data_ref (Block17Data* _data17_);
static void block17_data_unref (void * _userdata_);
VALA_EXTERN void mail_backend_session_save_draft (MailBackendSession* self,
                                      CamelMimeMessage* message,
                                      CamelInternetAddress* from,
                                      CamelAddress* recipients,
                                      CamelMessageInfo* ancestor_message_info,
                                      GAsyncReadyCallback _callback_,
                                      gpointer _user_data_);
VALA_EXTERN void mail_backend_session_save_draft_finish (MailBackendSession* self,
                                             GAsyncResult* _res_,
                                             GError** error);
static void ___lambda63_ (Block17Data* _data17_,
                   GObject* obj,
                   GAsyncResult* res);
VALA_EXTERN GType mail_main_window_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (MailMainWindow, g_object_unref)
VALA_EXTERN MailComposerWindow* mail_composer_window_new_for_widget (GtkWindow* parent,
                                                         MailComposerWidget* composer_widget);
VALA_EXTERN MailComposerWindow* mail_composer_window_construct_for_widget (GType object_type,
                                                               GtkWindow* parent,
                                                               MailComposerWidget* composer_widget);
VALA_EXTERN GType mail_composer_window_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (MailComposerWindow, g_object_unref)
static void ____lambda63__gasync_ready_callback (GObject* source_object,
                                          GAsyncResult* res,
                                          gpointer self);
static void ___lambda62__gasync_ready_callback (GObject* source_object,
                                         GAsyncResult* res,
                                         gpointer self);
VALA_EXTERN MailComposerWidget* mail_composer_widget_new (void);
VALA_EXTERN MailComposerWidget* mail_composer_widget_construct (GType object_type);
VALA_EXTERN gboolean mail_composer_widget_get_has_recipients (MailComposerWidget* self);
VALA_EXTERN void mail_composer_widget_set_has_recipients (MailComposerWidget* self,
                                              gboolean value);
VALA_EXTERN gboolean mail_composer_widget_get_has_subject_field (MailComposerWidget* self);
static void mail_composer_widget_set_has_subject_field (MailComposerWidget* self,
                                                 gboolean value);
VALA_EXTERN gboolean mail_composer_widget_get_can_change_sender (MailComposerWidget* self);
VALA_EXTERN const gchar* mail_composer_widget_get_to (MailComposerWidget* self);
static void mail_composer_widget_set_to (MailComposerWidget* self,
                                  const gchar* value);
VALA_EXTERN const gchar* mail_composer_widget_get_mailto_query (MailComposerWidget* self);
static void mail_composer_widget_set_mailto_query (MailComposerWidget* self,
                                            const gchar* value);
static GFileInfo* mail_composer_widget_attachment_get_info (MailComposerWidgetAttachment* self);
static GFile* mail_composer_widget_attachment_get_file (MailComposerWidgetAttachment* self);
static void mail_composer_widget_attachment_set_info (MailComposerWidgetAttachment* self,
                                               GFileInfo* value);
static void mail_composer_widget_attachment_set_file (MailComposerWidgetAttachment* self,
                                               GFile* value);
static GObject * mail_composer_widget_attachment_constructor (GType type,
                                                       guint n_construct_properties,
                                                       GObjectConstructParam * construct_properties);
static void _mail_composer_widget_attachment___lambda51_ (MailComposerWidgetAttachment* self);
static void __mail_composer_widget_attachment___lambda51__gtk_button_clicked (GtkButton* _sender,
                                                                       gpointer self);
static void mail_composer_widget_attachment_finalize (GObject * obj);
static GType mail_composer_widget_attachment_get_type_once (void);
static void _vala_mail_composer_widget_attachment_get_property (GObject * object,
                                                         guint property_id,
                                                         GValue * value,
                                                         GParamSpec * pspec);
static void _vala_mail_composer_widget_attachment_set_property (GObject * object,
                                                         guint property_id,
                                                         const GValue * value,
                                                         GParamSpec * pspec);
static GType mail_composer_widget_entry_grid_get_type (void) G_GNUC_CONST  G_GNUC_UNUSED ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (MailComposerWidgetEntryGrid, g_object_unref)
static MailComposerWidgetEntryGrid* mail_composer_widget_entry_grid_new (void);
static MailComposerWidgetEntryGrid* mail_composer_widget_entry_grid_construct (GType object_type);
static GType mail_composer_widget_entry_grid_get_type_once (void);
static GObject * mail_composer_widget_constructor (GType type,
                                            guint n_construct_properties,
                                            GObjectConstructParam * construct_properties);
static Block18Data* block18_data_ref (Block18Data* _data18_);
static void block18_data_unref (void * _userdata_);
static void _mail_composer_widget___lambda67_ (MailComposerWidget* self);
static void __mail_composer_widget___lambda67__gtk_editable_changed (GtkEditable* _sender,
                                                              gpointer self);
static GVariant* _variant_new5 (const gchar* value);
static GVariant* _variant_new6 (const gchar* value);
static GVariant* _variant_new7 (const gchar* value);
static GVariant* _variant_new8 (const gchar* value);
VALA_EXTERN MailWebView* mail_web_view_new (void);
VALA_EXTERN MailWebView* mail_web_view_construct (GType object_type);
VALA_EXTERN void mail_web_view_load_html (MailWebView* self,
                              const gchar* body);
static void _mail_composer_widget_update_actions_mail_web_view_selection_changed (MailWebView* _sender,
                                                                           gpointer self);
static void _mail_composer_widget_on_mouse_target_changed_webkit_web_view_mouse_target_changed (WebKitWebView* _sender,
                                                                                         WebKitHitTestResult* hit_test_result,
                                                                                         guint modifiers,
                                                                                         gpointer self);
VALA_EXTERN GType mail_contact_manager_get_type (void) G_GNUC_CONST ;
G_DEFINE_AUTOPTR_CLEANUP_FUNC (MailContactManager, g_object_unref)
VALA_EXTERN MailContactManager* mail_contact_manager_get_default (void);
VALA_EXTERN void mail_contact_manager_setup_entry (MailContactManager* self,
                                       GtkEntry* entry);
static void _mail_composer_widget___lambda70_ (MailComposerWidget* self);
static void __mail_composer_widget___lambda70__gtk_button_clicked (GtkButton* _sender,
                                                            gpointer self);
static void _mail_composer_widget___lambda71_ (MailComposerWidget* self);
static void __mail_composer_widget___lambda71__gtk_editable_changed (GtkEditable* _sender,
                                                              gpointer self);
static void _mail_composer_widget___lambda72_ (Block18Data* _data18_);
static void __mail_composer_widget___lambda72__gtk_button_clicked (GtkButton* _sender,
                                                            gpointer self);
static void _mail_composer_widget___lambda73_ (Block18Data* _data18_);
static void __mail_composer_widget___lambda73__gtk_editable_changed (GtkEditable* _sender,
                                                              gpointer self);
static void _mail_composer_widget___lambda74_ (MailComposerWidget* self);
static void __mail_composer_widget___lambda74__gtk_combo_box_changed (GtkComboBox* _sender,
                                                               gpointer self);
static void _mail_composer_widget___lambda75_ (MailComposerWidget* self);
static void __mail_composer_widget___lambda75__gtk_editable_changed (GtkEditable* _sender,
                                                              gpointer self);
static void _mail_composer_widget___lambda76_ (Block18Data* _data18_);
static void __mail_composer_widget___lambda76__gtk_style_context_changed (GtkStyleContext* _sender,
                                                                   gpointer self);
static void mail_composer_widget_finalize (GObject * obj);
static GType mail_composer_widget_get_type_once (void);
static void _vala_mail_composer_widget_get_property (GObject * object,
                                              guint property_id,
                                              GValue * value,
                                              GParamSpec * pspec);
static void _vala_mail_composer_widget_set_property (GObject * object,
                                              guint property_id,
                                              const GValue * value,
                                              GParamSpec * pspec);
static void _vala_array_destroy (gpointer array,
                          gssize array_length,
                          GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array,
                       gssize array_length,
                       GDestroyNotify destroy_func);
static gssize _vala_array_length (gpointer array);

static const GActionEntry MAIL_COMPOSER_WIDGET_ACTION_ENTRIES[9] = {{MAIL_COMPOSER_WIDGET_ACTION_ADD_ATTACHMENT, _mail_composer_widget_on_add_attachment_gsimple_action_activate_callback}, {MAIL_COMPOSER_WIDGET_ACTION_BOLD, _mail_composer_widget_on_edit_action_gsimple_action_activate_callback, "s", "''"}, {MAIL_COMPOSER_WIDGET_ACTION_ITALIC, _mail_composer_widget_on_edit_action_gsimple_action_activate_callback, "s", "''"}, {MAIL_COMPOSER_WIDGET_ACTION_UNDERLINE, _mail_composer_widget_on_edit_action_gsimple_action_activate_callback, "s", "''"}, {MAIL_COMPOSER_WIDGET_ACTION_STRIKETHROUGH, _mail_composer_widget_on_edit_action_gsimple_action_activate_callback, "s", "''"}, {MAIL_COMPOSER_WIDGET_ACTION_INSERT_LINK, _mail_composer_widget_on_insert_link_clicked_gsimple_action_activate_callback}, {MAIL_COMPOSER_WIDGET_ACTION_REMOVE_FORMAT, _mail_composer_widget_on_remove_format_gsimple_action_activate_callback}, {MAIL_COMPOSER_WIDGET_ACTION_DISCARD, _mail_composer_widget_on_discard_gsimple_action_activate_callback}, {MAIL_COMPOSER_WIDGET_ACTION_SEND, _mail_composer_widget_on_send_gsimple_action_activate_callback}};

static inline gpointer
mail_composer_widget_get_instance_private (MailComposerWidget* self)
{
	return G_STRUCT_MEMBER_P (self, MailComposerWidget_private_offset);
}

static GType
mail_composer_widget_type_get_type_once (void)
{
	static const GEnumValue values[] = {{MAIL_COMPOSER_WIDGET_TYPE_REPLY, "MAIL_COMPOSER_WIDGET_TYPE_REPLY", "reply"}, {MAIL_COMPOSER_WIDGET_TYPE_REPLY_ALL, "MAIL_COMPOSER_WIDGET_TYPE_REPLY_ALL", "reply-all"}, {MAIL_COMPOSER_WIDGET_TYPE_FORWARD, "MAIL_COMPOSER_WIDGET_TYPE_FORWARD", "forward"}, {MAIL_COMPOSER_WIDGET_TYPE_DRAFT, "MAIL_COMPOSER_WIDGET_TYPE_DRAFT", "draft"}, {0, NULL, NULL}};
	GType mail_composer_widget_type_type_id;
	mail_composer_widget_type_type_id = g_enum_register_static ("MailComposerWidgetType", values);
	return mail_composer_widget_type_type_id;
}

GType
mail_composer_widget_type_get_type (void)
{
	static volatile gsize mail_composer_widget_type_type_id__once = 0;
	if (g_once_init_enter (&mail_composer_widget_type_type_id__once)) {
		GType mail_composer_widget_type_type_id;
		mail_composer_widget_type_type_id = mail_composer_widget_type_get_type_once ();
		g_once_init_leave (&mail_composer_widget_type_type_id__once, mail_composer_widget_type_type_id);
	}
	return mail_composer_widget_type_type_id__once;
}

static void
_mail_composer_widget_on_add_attachment_gsimple_action_activate_callback (GSimpleAction* action,
                                                                          GVariant* parameter,
                                                                          gpointer self)
{
	mail_composer_widget_on_add_attachment ((MailComposerWidget*) self);
}

static void
_mail_composer_widget_on_edit_action_gsimple_action_activate_callback (GSimpleAction* action,
                                                                       GVariant* parameter,
                                                                       gpointer self)
{
	mail_composer_widget_on_edit_action ((MailComposerWidget*) self, action, parameter);
}

static void
_mail_composer_widget_on_insert_link_clicked_gsimple_action_activate_callback (GSimpleAction* action,
                                                                               GVariant* parameter,
                                                                               gpointer self)
{
	mail_composer_widget_on_insert_link_clicked ((MailComposerWidget*) self);
}

static void
_mail_composer_widget_on_remove_format_gsimple_action_activate_callback (GSimpleAction* action,
                                                                         GVariant* parameter,
                                                                         gpointer self)
{
	mail_composer_widget_on_remove_format ((MailComposerWidget*) self);
}

static void
_mail_composer_widget_on_discard_gsimple_action_activate_callback (GSimpleAction* action,
                                                                   GVariant* parameter,
                                                                   gpointer self)
{
	mail_composer_widget_on_discard ((MailComposerWidget*) self);
}

static void
_mail_composer_widget_on_send_gsimple_action_activate_callback (GSimpleAction* action,
                                                                GVariant* parameter,
                                                                gpointer self)
{
	mail_composer_widget_on_send ((MailComposerWidget*) self);
}

MailComposerWidget*
mail_composer_widget_construct_inline (GType object_type)
{
	MailComposerWidget * self = NULL;
	self = (MailComposerWidget*) g_object_new (object_type, "can-change-sender", FALSE, "has-subject-field", TRUE, NULL);
	return self;
}

MailComposerWidget*
mail_composer_widget_new_inline (void)
{
	return mail_composer_widget_construct_inline (MAIL_TYPE_COMPOSER_WIDGET);
}

MailComposerWidget*
mail_composer_widget_construct_with_subject (GType object_type)
{
	MailComposerWidget * self = NULL;
	self = (MailComposerWidget*) g_object_new (object_type, "has-subject-field", TRUE, NULL);
	return self;
}

MailComposerWidget*
mail_composer_widget_new_with_subject (void)
{
	return mail_composer_widget_construct_with_subject (MAIL_TYPE_COMPOSER_WIDGET);
}

MailComposerWidget*
mail_composer_widget_construct_with_headers (GType object_type,
                                             const gchar* to,
                                             const gchar* mailto_query)
{
	MailComposerWidget * self = NULL;
	self = (MailComposerWidget*) g_object_new (object_type, "has-subject-field", TRUE, "to", to, "mailto-query", mailto_query, NULL);
	return self;
}

MailComposerWidget*
mail_composer_widget_new_with_headers (const gchar* to,
                                       const gchar* mailto_query)
{
	return mail_composer_widget_construct_with_headers (MAIL_TYPE_COMPOSER_WIDGET, to, mailto_query);
}

static gboolean
string_contains (const gchar* self,
                 const gchar* needle)
{
	gchar* _tmp0_;
	gboolean result;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (needle != NULL, FALSE);
	_tmp0_ = strstr ((gchar*) self, (gchar*) needle);
	result = _tmp0_ != NULL;
	return result;
}

static gchar*
string_replace (const gchar* self,
                const gchar* old,
                const gchar* replacement)
{
	gboolean _tmp0_ = FALSE;
	gboolean _tmp1_ = FALSE;
	GError* _inner_error0_ = NULL;
	gchar* result;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (old != NULL, NULL);
	g_return_val_if_fail (replacement != NULL, NULL);
	if ((*((gchar*) self)) == '\0') {
		_tmp1_ = TRUE;
	} else {
		_tmp1_ = (*((gchar*) old)) == '\0';
	}
	if (_tmp1_) {
		_tmp0_ = TRUE;
	} else {
		_tmp0_ = g_strcmp0 (old, replacement) == 0;
	}
	if (_tmp0_) {
		gchar* _tmp2_;
		_tmp2_ = g_strdup (self);
		result = _tmp2_;
		return result;
	}
	{
		GRegex* regex = NULL;
		gchar* _tmp3_;
		gchar* _tmp4_;
		GRegex* _tmp5_;
		GRegex* _tmp6_;
		gchar* _tmp7_ = NULL;
		GRegex* _tmp8_;
		gchar* _tmp9_;
		gchar* _tmp10_;
		_tmp3_ = g_regex_escape_string (old, -1);
		_tmp4_ = _tmp3_;
		_tmp5_ = g_regex_new (_tmp4_, 0, 0, &_inner_error0_);
		_tmp6_ = _tmp5_;
		_g_free0 (_tmp4_);
		regex = _tmp6_;
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			if (_inner_error0_->domain == G_REGEX_ERROR) {
				goto __catch0_g_regex_error;
			}
			g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
			g_clear_error (&_inner_error0_);
			return NULL;
		}
		_tmp8_ = regex;
		_tmp9_ = g_regex_replace_literal (_tmp8_, self, (gssize) -1, 0, replacement, 0, &_inner_error0_);
		_tmp7_ = _tmp9_;
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			_g_regex_unref0 (regex);
			if (_inner_error0_->domain == G_REGEX_ERROR) {
				goto __catch0_g_regex_error;
			}
			g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
			g_clear_error (&_inner_error0_);
			return NULL;
		}
		_tmp10_ = _tmp7_;
		_tmp7_ = NULL;
		result = _tmp10_;
		_g_free0 (_tmp7_);
		_g_regex_unref0 (regex);
		return result;
	}
	goto __finally0;
	__catch0_g_regex_error:
	{
		g_clear_error (&_inner_error0_);
		g_assert_not_reached ();
	}
	__finally0:
	g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
	g_clear_error (&_inner_error0_);
	return NULL;
}

static void
mail_composer_widget_on_sanitize_recipient_entry (MailComposerWidget* self,
                                                  GtkEntry* entry)
{
	const gchar* _tmp0_;
	const gchar* _tmp1_;
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	const gchar* _tmp8_;
	const gchar* _tmp9_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (entry != NULL);
	_tmp0_ = gtk_entry_get_text (entry);
	_tmp1_ = _tmp0_;
	if (g_strcmp0 (_tmp1_, "") == 0) {
		return;
	}
	_tmp2_ = gtk_entry_get_text (entry);
	_tmp3_ = _tmp2_;
	if (string_contains (_tmp3_, "\n")) {
		const gchar* _tmp4_;
		const gchar* _tmp5_;
		gchar* _tmp6_;
		gchar* _tmp7_;
		_tmp4_ = gtk_entry_get_text (entry);
		_tmp5_ = _tmp4_;
		_tmp6_ = string_replace (_tmp5_, "\n", ", ");
		_tmp7_ = _tmp6_;
		gtk_entry_set_text (entry, _tmp7_);
		_g_free0 (_tmp7_);
	}
	_tmp8_ = gtk_entry_get_text (entry);
	_tmp9_ = _tmp8_;
	if (string_contains (_tmp9_, "\r")) {
		const gchar* _tmp10_;
		const gchar* _tmp11_;
		gchar* _tmp12_;
		gchar* _tmp13_;
		_tmp10_ = gtk_entry_get_text (entry);
		_tmp11_ = _tmp10_;
		_tmp12_ = string_replace (_tmp11_, "\r", ", ");
		_tmp13_ = _tmp12_;
		gtk_entry_set_text (entry, _tmp13_);
		_g_free0 (_tmp13_);
	}
}

static void
_g_object_unref0_ (gpointer var)
{
	(var == NULL) ? NULL : (var = (g_object_unref (var), NULL));
}

static inline void
_g_slist_free__g_object_unref0_ (GSList* self)
{
	g_slist_free_full (self, (GDestroyNotify) _g_object_unref0_);
}

static void
mail_composer_widget_on_add_attachment (MailComposerWidget* self)
{
	GtkFileChooserNative* filechooser = NULL;
	GtkWidget* _tmp0_;
	GtkFileChooserNative* _tmp1_;
	GtkFileChooserNative* _tmp2_;
	GtkFileChooserNative* _tmp12_;
	g_return_if_fail (self != NULL);
	_tmp0_ = gtk_widget_get_toplevel ((GtkWidget*) self);
	_tmp1_ = gtk_file_chooser_native_new (_ ("Choose a file"), G_TYPE_CHECK_INSTANCE_CAST (_tmp0_, gtk_window_get_type (), GtkWindow), GTK_FILE_CHOOSER_ACTION_OPEN, _ ("Attach"), _ ("Cancel"));
	filechooser = _tmp1_;
	_tmp2_ = filechooser;
	if (gtk_native_dialog_run ((GtkNativeDialog*) _tmp2_) == ((gint) GTK_RESPONSE_ACCEPT)) {
		GtkFileChooserNative* _tmp3_;
		GtkFileChooserNative* _tmp4_;
		GSList* _tmp5_;
		GtkFlowBox* _tmp11_;
		_tmp3_ = filechooser;
		gtk_native_dialog_hide ((GtkNativeDialog*) _tmp3_);
		_tmp4_ = filechooser;
		_tmp5_ = gtk_file_chooser_get_files ((GtkFileChooser*) _tmp4_);
		{
			GSList* file_collection = NULL;
			GSList* file_it = NULL;
			file_collection = _tmp5_;
			for (file_it = file_collection; file_it != NULL; file_it = file_it->next) {
				GFile* file = NULL;
				file = (GFile*) file_it->data;
				{
					MailComposerWidgetAttachment* attachment = NULL;
					GFile* _tmp6_;
					MailComposerWidgetAttachment* _tmp7_;
					MailComposerWidgetAttachment* _tmp8_;
					GtkFlowBox* _tmp9_;
					MailComposerWidgetAttachment* _tmp10_;
					_tmp6_ = file;
					_tmp7_ = mail_composer_widget_attachment_new (_tmp6_);
					g_object_ref_sink (_tmp7_);
					attachment = _tmp7_;
					_tmp8_ = attachment;
					g_object_set ((GtkWidget*) _tmp8_, "margin", 3, NULL);
					_tmp9_ = self->priv->attachment_box;
					_tmp10_ = attachment;
					gtk_container_add ((GtkContainer*) _tmp9_, (GtkWidget*) _tmp10_);
					_g_object_unref0 (attachment);
				}
			}
			(file_collection == NULL) ? NULL : (file_collection = (_g_slist_free__g_object_unref0_ (file_collection), NULL));
		}
		_tmp11_ = self->priv->attachment_box;
		gtk_widget_show_all ((GtkWidget*) _tmp11_);
	}
	_tmp12_ = filechooser;
	gtk_native_dialog_destroy ((GtkNativeDialog*) _tmp12_);
	_g_object_unref0 (filechooser);
}

static void
mail_composer_widget_on_insert_link_clicked (MailComposerWidget* self)
{
	g_return_if_fail (self != NULL);
	mail_composer_widget_ask_insert_link (self, NULL, NULL);
}

static void
mail_composer_widget_ask_insert_link_data_free (gpointer _data)
{
	MailComposerWidgetAskInsertLinkData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (MailComposerWidgetAskInsertLinkData, _data_);
}

static gpointer
_g_object_ref0 (gpointer self)
{
	return self ? g_object_ref (self) : NULL;
}

static void
mail_composer_widget_ask_insert_link (MailComposerWidget* self,
                                      GAsyncReadyCallback _callback_,
                                      gpointer _user_data_)
{
	MailComposerWidgetAskInsertLinkData* _data_;
	MailComposerWidget* _tmp0_;
	g_return_if_fail (self != NULL);
	_data_ = g_slice_new0 (MailComposerWidgetAskInsertLinkData);
	_data_->_async_result = g_task_new (G_OBJECT (self), NULL, _callback_, _user_data_);
	g_task_set_task_data (_data_->_async_result, _data_, mail_composer_widget_ask_insert_link_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	mail_composer_widget_ask_insert_link_co (_data_);
}

static void
mail_composer_widget_ask_insert_link_finish (MailComposerWidget* self,
                                             GAsyncResult* _res_)
{
	MailComposerWidgetAskInsertLinkData* _data_;
	_data_ = g_task_propagate_pointer (G_TASK (_res_), NULL);
}

static Block15Data*
block15_data_ref (Block15Data* _data15_)
{
	g_atomic_int_inc (&_data15_->_ref_count_);
	return _data15_;
}

static void
block15_data_unref (void * _userdata_)
{
	Block15Data* _data15_;
	_data15_ = (Block15Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data15_->_ref_count_)) {
		MailComposerWidget* self;
		self = _data15_->self;
		_g_free0 (_data15_->selected_text);
		_g_object_unref0 (self);
		g_slice_free (Block15Data, _data15_);
	}
}

static void
mail_composer_widget_ask_insert_link_ready (GObject* source_object,
                                            GAsyncResult* _res_,
                                            gpointer _user_data_)
{
	MailComposerWidgetAskInsertLinkData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	mail_composer_widget_ask_insert_link_co (_data_);
}

static void
__lambda58_ (Block15Data* _data15_,
             const gchar* url,
             const gchar* title)
{
	MailComposerWidget* self;
	self = _data15_->self;
	g_return_if_fail (url != NULL);
	g_return_if_fail (title != NULL);
	mail_composer_widget_on_link_inserted (self, url, title, _data15_->selected_text);
}

static void
___lambda58__insert_link_dialog_insert_link (InsertLinkDialog* _sender,
                                             const gchar* url,
                                             const gchar* title,
                                             gpointer self)
{
	__lambda58_ (self, url, title);
}

static gboolean
mail_composer_widget_ask_insert_link_co (MailComposerWidgetAskInsertLinkData* _data_)
{
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_data15_ = g_slice_new0 (Block15Data);
	_data_->_data15_->_ref_count_ = 1;
	_data_->_data15_->self = g_object_ref (_data_->self);
	_data_->_data15_->_async_data_ = _data_;
	_data_->_tmp0_ = _data_->self->priv->web_view;
	_data_->_state_ = 1;
	mail_web_view_get_selected_text (_data_->_tmp0_, mail_composer_widget_ask_insert_link_ready, _data_);
	return FALSE;
	_state_1:
	_data_->_tmp1_ = mail_web_view_get_selected_text_finish (_data_->_tmp0_, _data_->_res_);
	_data_->_data15_->selected_text = _data_->_tmp1_;
	_data_->_tmp2_ = insert_link_dialog_new (_data_->_data15_->selected_text);
	g_object_ref_sink (_data_->_tmp2_);
	_data_->insert_link_dialog = _data_->_tmp2_;
	g_signal_connect_data (_data_->insert_link_dialog, "insert-link", (GCallback) ___lambda58__insert_link_dialog_insert_link, block15_data_ref (_data_->_data15_), (GClosureNotify) block15_data_unref, 0);
	_data_->_tmp3_ = gtk_widget_get_toplevel ((GtkWidget*) _data_->self);
	gtk_window_set_transient_for ((GtkWindow*) _data_->insert_link_dialog, G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp3_, gtk_window_get_type (), GtkWindow));
	gtk_dialog_run ((GtkDialog*) _data_->insert_link_dialog);
	_g_object_unref0 (_data_->insert_link_dialog);
	block15_data_unref (_data_->_data15_);
	_data_->_data15_ = NULL;
	g_task_return_pointer (_data_->_async_result, _data_, NULL);
	if (_data_->_state_ != 0) {
		while (!g_task_get_completed (_data_->_async_result)) {
			g_main_context_iteration (g_task_get_context (_data_->_async_result), TRUE);
		}
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}

static void
mail_composer_widget_on_link_inserted (MailComposerWidget* self,
                                       const gchar* url,
                                       const gchar* title,
                                       const gchar* selected_text)
{
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	g_return_if_fail (url != NULL);
	g_return_if_fail (title != NULL);
	if (selected_text != NULL) {
		_tmp0_ = g_strcmp0 (title, selected_text) == 0;
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		MailWebView* _tmp1_;
		_tmp1_ = self->priv->web_view;
		mail_web_view_execute_editor_command (_tmp1_, "createLink", url);
	} else {
		gboolean _tmp2_ = FALSE;
		if (title != NULL) {
			gint _tmp3_;
			gint _tmp4_;
			_tmp3_ = strlen (title);
			_tmp4_ = _tmp3_;
			_tmp2_ = _tmp4_ > 0;
		} else {
			_tmp2_ = FALSE;
		}
		if (_tmp2_) {
			MailWebView* _tmp5_;
			gchar* _tmp6_;
			gchar* _tmp7_;
			_tmp5_ = self->priv->web_view;
			_tmp6_ = g_strdup_printf ("<a href=\"%s\">%s</a>", url, title);
			_tmp7_ = _tmp6_;
			mail_web_view_execute_editor_command (_tmp5_, "insertHTML", _tmp7_);
			_g_free0 (_tmp7_);
		} else {
			MailWebView* _tmp8_;
			gchar* _tmp9_;
			gchar* _tmp10_;
			_tmp8_ = self->priv->web_view;
			_tmp9_ = g_strdup_printf ("<a href=\"%s\">%s</a>", url, url);
			_tmp10_ = _tmp9_;
			mail_web_view_execute_editor_command (_tmp8_, "insertHTML", _tmp10_);
			_g_free0 (_tmp10_);
		}
	}
}

static void
mail_composer_widget_on_mouse_target_changed (MailComposerWidget* self,
                                              WebKitWebView* web_view,
                                              WebKitHitTestResult* hit_test,
                                              guint mods)
{
	g_return_if_fail (self != NULL);
	g_return_if_fail (web_view != NULL);
	g_return_if_fail (hit_test != NULL);
	if (webkit_hit_test_result_context_is_link (hit_test)) {
		gchar* url = NULL;
		const gchar* _tmp0_;
		gchar* _tmp1_;
		gchar* _tmp2_ = NULL;
		const gchar* _tmp3_;
		gchar* hover_url = NULL;
		gchar* _tmp6_;
		const gchar* _tmp7_;
		_tmp0_ = webkit_hit_test_result_get_link_uri (hit_test);
		_tmp1_ = g_strdup (_tmp0_);
		url = _tmp1_;
		_tmp3_ = url;
		if (_tmp3_ != NULL) {
			const gchar* _tmp4_;
			gchar* _tmp5_;
			_tmp4_ = url;
			_tmp5_ = g_uri_unescape_string (_tmp4_, NULL);
			_g_free0 (_tmp2_);
			_tmp2_ = _tmp5_;
		} else {
			_g_free0 (_tmp2_);
			_tmp2_ = NULL;
		}
		_tmp6_ = g_strdup (_tmp2_);
		hover_url = _tmp6_;
		_tmp7_ = hover_url;
		if (_tmp7_ == NULL) {
			GraniteWidgetsOverlayBar* _tmp8_;
			_tmp8_ = self->priv->message_url_overlay;
			gtk_widget_hide ((GtkWidget*) _tmp8_);
		} else {
			GraniteWidgetsOverlayBar* _tmp9_;
			const gchar* _tmp10_;
			GraniteWidgetsOverlayBar* _tmp11_;
			GraniteWidgetsOverlayBar* _tmp12_;
			_tmp9_ = self->priv->message_url_overlay;
			_tmp10_ = hover_url;
			granite_widgets_overlay_bar_set_label (_tmp9_, _tmp10_);
			_tmp11_ = self->priv->message_url_overlay;
			gtk_widget_set_no_show_all ((GtkWidget*) _tmp11_, FALSE);
			_tmp12_ = self->priv->message_url_overlay;
			gtk_widget_show_all ((GtkWidget*) _tmp12_);
		}
		_g_free0 (hover_url);
		_g_free0 (_tmp2_);
		_g_free0 (url);
	} else {
		GraniteWidgetsOverlayBar* _tmp13_;
		_tmp13_ = self->priv->message_url_overlay;
		gtk_widget_hide ((GtkWidget*) _tmp13_);
	}
}

static Block16Data*
block16_data_ref (Block16Data* _data16_)
{
	g_atomic_int_inc (&_data16_->_ref_count_);
	return _data16_;
}

static void
block16_data_unref (void * _userdata_)
{
	Block16Data* _data16_;
	_data16_ = (Block16Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data16_->_ref_count_)) {
		MailComposerWidget* self;
		self = _data16_->self;
		_g_free0 (_data16_->identity_address);
		_g_object_unref0 (self);
		g_slice_free (Block16Data, _data16_);
	}
}

static gboolean
_______lambda59_ (Block16Data* _data16_,
                  GtkTreeModel* model,
                  GtkTreePath* path,
                  GtkTreeIter* iter)
{
	MailComposerWidget* self;
	GValue value = {0};
	GtkTreeIter _tmp0_;
	GValue _tmp1_ = {0};
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	gboolean result;
	self = _data16_->self;
	g_return_val_if_fail (model != NULL, FALSE);
	g_return_val_if_fail (path != NULL, FALSE);
	g_return_val_if_fail (iter != NULL, FALSE);
	_tmp0_ = *iter;
	gtk_tree_model_get_value (model, &_tmp0_, 0, &_tmp1_);
	G_IS_VALUE (&value) ? (g_value_unset (&value), NULL) : NULL;
	value = _tmp1_;
	_tmp2_ = g_value_get_string (&value);
	_tmp3_ = _data16_->identity_address;
	if (g_strcmp0 (_tmp2_, _tmp3_) == 0) {
		GtkComboBoxText* _tmp4_;
		GtkTreeIter _tmp5_;
		_tmp4_ = self->priv->from_combo;
		_tmp5_ = *iter;
		gtk_combo_box_set_active_iter ((GtkComboBox*) _tmp4_, &_tmp5_);
		result = TRUE;
		G_IS_VALUE (&value) ? (g_value_unset (&value), NULL) : NULL;
		return result;
	}
	result = FALSE;
	G_IS_VALUE (&value) ? (g_value_unset (&value), NULL) : NULL;
	return result;
}

static gboolean
________lambda59__gtk_tree_model_foreach_func (GtkTreeModel* model,
                                               GtkTreePath* path,
                                               GtkTreeIter* iter,
                                               gpointer self)
{
	gboolean result;
	result = _______lambda59_ (self, model, path, iter);
	return result;
}

static gboolean
______lambda60_ (MailComposerWidget* self,
                 const gchar* address)
{
	gboolean result;
	g_return_val_if_fail (address != NULL, FALSE);
	result = TRUE;
	return result;
}

static gboolean
_______lambda60__mail_utils_accept_address (const gchar* address,
                                            gpointer self)
{
	gboolean result;
	result = ______lambda60_ ((MailComposerWidget*) self, address);
	return result;
}

static gboolean
_______lambda61_ (MailComposerWidget* self,
                  const gchar* address)
{
	GtkEntry* _tmp0_;
	const gchar* _tmp1_;
	const gchar* _tmp2_;
	gboolean result;
	g_return_val_if_fail (address != NULL, FALSE);
	_tmp0_ = self->priv->to_val;
	_tmp1_ = gtk_entry_get_text (_tmp0_);
	_tmp2_ = _tmp1_;
	if (string_contains (_tmp2_, address)) {
		result = FALSE;
		return result;
	}
	result = TRUE;
	return result;
}

static gboolean
________lambda61__mail_utils_accept_address (const gchar* address,
                                             gpointer self)
{
	gboolean result;
	result = _______lambda61_ ((MailComposerWidget*) self, address);
	return result;
}

void
mail_composer_widget_quote_content (MailComposerWidget* self,
                                    MailComposerWidgetType type,
                                    CamelMessageInfo* info,
                                    CamelMimeMessage* message,
                                    const gchar* content_to_quote)
{
	const gchar* _tmp0_;
	gboolean _tmp16_ = FALSE;
	GtkComboBoxText* _tmp17_;
	GtkTreeModel* _tmp18_;
	GtkTreeModel* _tmp19_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (info != NULL);
	g_return_if_fail (message != NULL);
	_tmp0_ = camel_mime_message_get_subject (message);
	if (_tmp0_ != NULL) {
		GtkEntry* _tmp1_;
		const gchar* _tmp2_;
		gboolean _tmp3_ = FALSE;
		_tmp1_ = self->priv->subject_val;
		_tmp2_ = camel_mime_message_get_subject (message);
		gtk_entry_set_text (_tmp1_, _tmp2_);
		if (type == MAIL_COMPOSER_WIDGET_TYPE_REPLY) {
			_tmp3_ = TRUE;
		} else {
			_tmp3_ = type == MAIL_COMPOSER_WIDGET_TYPE_REPLY_ALL;
		}
		if (_tmp3_) {
			GtkEntry* _tmp4_;
			const gchar* _tmp5_;
			const gchar* _tmp6_;
			gchar* _tmp7_;
			gchar* _tmp8_;
			gboolean _tmp9_;
			_tmp4_ = self->priv->subject_val;
			_tmp5_ = gtk_entry_get_text (_tmp4_);
			_tmp6_ = _tmp5_;
			_tmp7_ = g_utf8_strup (_tmp6_, (gssize) -1);
			_tmp8_ = _tmp7_;
			_tmp9_ = !string_contains (_tmp8_, "RE: ");
			_g_free0 (_tmp8_);
			if (_tmp9_) {
				GtkEntry* _tmp10_;
				GtkEntry* _tmp11_;
				const gchar* _tmp12_;
				const gchar* _tmp13_;
				gchar* _tmp14_;
				gchar* _tmp15_;
				_tmp10_ = self->priv->subject_val;
				_tmp11_ = self->priv->subject_val;
				_tmp12_ = gtk_entry_get_text (_tmp11_);
				_tmp13_ = _tmp12_;
				_tmp14_ = g_strdup_printf ("Re: %s", _tmp13_);
				_tmp15_ = _tmp14_;
				gtk_entry_set_text (_tmp10_, _tmp15_);
				_g_free0 (_tmp15_);
			}
		}
	}
	_tmp17_ = self->priv->from_combo;
	_tmp18_ = gtk_combo_box_get_model ((GtkComboBox*) _tmp17_);
	_tmp19_ = _tmp18_;
	if (gtk_tree_model_iter_n_children (_tmp19_, NULL) > 1) {
		gboolean _tmp20_ = FALSE;
		gboolean _tmp21_ = FALSE;
		if (type == MAIL_COMPOSER_WIDGET_TYPE_REPLY) {
			_tmp21_ = TRUE;
		} else {
			_tmp21_ = type == MAIL_COMPOSER_WIDGET_TYPE_REPLY_ALL;
		}
		if (_tmp21_) {
			_tmp20_ = TRUE;
		} else {
			_tmp20_ = type == MAIL_COMPOSER_WIDGET_TYPE_FORWARD;
		}
		_tmp16_ = _tmp20_;
	} else {
		_tmp16_ = FALSE;
	}
	if (_tmp16_) {
		GtkRevealer* _tmp22_;
		MailBackendSession* session = NULL;
		MailBackendSession* _tmp23_;
		const gchar* account_source_uid = NULL;
		const gchar* _tmp24_;
		ESource* account_source = NULL;
		MailBackendSession* _tmp25_;
		const gchar* _tmp26_;
		ESource* _tmp27_;
		gboolean _tmp28_ = FALSE;
		ESource* _tmp29_;
		_tmp22_ = self->priv->from_revealer;
		mail_composer_widget_set_can_change_sender (self, TRUE);
		gtk_revealer_set_reveal_child (_tmp22_, TRUE);
		_tmp23_ = mail_backend_session_get_default ();
		session = _tmp23_;
		_tmp24_ = camel_mime_message_get_source (message);
		account_source_uid = _tmp24_;
		_tmp25_ = session;
		_tmp26_ = account_source_uid;
		_tmp27_ = mail_backend_session_ref_source (_tmp25_, _tmp26_);
		account_source = _tmp27_;
		_tmp29_ = account_source;
		if (_tmp29_ != NULL) {
			ESource* _tmp30_;
			_tmp30_ = account_source;
			_tmp28_ = e_source_has_extension (_tmp30_, E_SOURCE_EXTENSION_MAIL_ACCOUNT);
		} else {
			_tmp28_ = FALSE;
		}
		if (_tmp28_) {
			ESourceMailAccount* account_extension = NULL;
			ESource* _tmp31_;
			ESourceExtension* _tmp32_;
			gchar* identity_uid = NULL;
			ESourceMailAccount* _tmp33_;
			const gchar* _tmp34_;
			const gchar* _tmp35_;
			gchar* _tmp36_;
			gboolean _tmp37_ = FALSE;
			const gchar* _tmp38_;
			_tmp31_ = account_source;
			_tmp32_ = e_source_get_extension (_tmp31_, E_SOURCE_EXTENSION_MAIL_ACCOUNT);
			account_extension = G_TYPE_CHECK_INSTANCE_CAST (_tmp32_, e_source_mail_account_get_type (), ESourceMailAccount);
			_tmp33_ = account_extension;
			_tmp34_ = e_source_mail_account_get_identity_uid (_tmp33_);
			_tmp35_ = _tmp34_;
			_tmp36_ = g_strdup (_tmp35_);
			identity_uid = _tmp36_;
			_tmp38_ = identity_uid;
			if (_tmp38_ != NULL) {
				const gchar* _tmp39_;
				_tmp39_ = identity_uid;
				_tmp37_ = g_strcmp0 (_tmp39_, "") != 0;
			} else {
				_tmp37_ = FALSE;
			}
			if (_tmp37_) {
				ESource* identity_source = NULL;
				MailBackendSession* _tmp40_;
				const gchar* _tmp41_;
				ESource* _tmp42_;
				gboolean _tmp43_ = FALSE;
				ESource* _tmp44_;
				_tmp40_ = session;
				_tmp41_ = identity_uid;
				_tmp42_ = mail_backend_session_ref_source (_tmp40_, _tmp41_);
				identity_source = _tmp42_;
				_tmp44_ = identity_source;
				if (_tmp44_ != NULL) {
					ESource* _tmp45_;
					_tmp45_ = identity_source;
					_tmp43_ = e_source_has_extension (_tmp45_, E_SOURCE_EXTENSION_MAIL_IDENTITY);
				} else {
					_tmp43_ = FALSE;
				}
				if (_tmp43_) {
					Block16Data* _data16_;
					ESourceMailIdentity* identity_extension = NULL;
					ESource* _tmp46_;
					ESourceExtension* _tmp47_;
					ESourceMailIdentity* _tmp48_;
					const gchar* _tmp49_;
					gchar* _tmp50_;
					const gchar* _tmp51_;
					_data16_ = g_slice_new0 (Block16Data);
					_data16_->_ref_count_ = 1;
					_data16_->self = g_object_ref (self);
					_tmp46_ = identity_source;
					_tmp47_ = e_source_get_extension (_tmp46_, E_SOURCE_EXTENSION_MAIL_IDENTITY);
					identity_extension = G_TYPE_CHECK_INSTANCE_CAST (_tmp47_, e_source_mail_identity_get_type (), ESourceMailIdentity);
					_tmp48_ = identity_extension;
					_tmp49_ = e_source_mail_identity_get_address (_tmp48_);
					_tmp50_ = g_strdup (_tmp49_);
					_data16_->identity_address = _tmp50_;
					_tmp51_ = _data16_->identity_address;
					if (g_strcmp0 (_tmp51_, "") != 0) {
						GtkComboBoxText* _tmp52_;
						GtkTreeModel* _tmp53_;
						GtkTreeModel* _tmp54_;
						_tmp52_ = self->priv->from_combo;
						_tmp53_ = gtk_combo_box_get_model ((GtkComboBox*) _tmp52_);
						_tmp54_ = _tmp53_;
						gtk_tree_model_foreach (_tmp54_, ________lambda59__gtk_tree_model_foreach_func, _data16_);
					}
					block16_data_unref (_data16_);
					_data16_ = NULL;
				}
				_g_object_unref0 (identity_source);
			}
			_g_free0 (identity_uid);
		}
		_g_object_unref0 (account_source);
	}
	if (content_to_quote != NULL) {
		gchar* message_content = NULL;
		MailWebView* _tmp207_;
		const gchar* _tmp208_;
		gchar* _tmp209_;
		if (type == MAIL_COMPOSER_WIDGET_TYPE_DRAFT) {
			CamelMessageInfo* _tmp55_;
			gchar* _tmp56_;
			CamelInternetAddress* to = NULL;
			CamelInternetAddress* _tmp57_;
			CamelInternetAddress* _tmp58_;
			CamelInternetAddress* cc = NULL;
			CamelInternetAddress* _tmp63_;
			CamelInternetAddress* _tmp64_;
			CamelInternetAddress* bcc = NULL;
			CamelInternetAddress* _tmp75_;
			CamelInternetAddress* _tmp76_;
			_tmp55_ = _g_object_ref0 (info);
			_g_object_unref0 (self->priv->ancestor_message_info);
			self->priv->ancestor_message_info = _tmp55_;
			_tmp56_ = g_strdup (content_to_quote);
			_g_free0 (message_content);
			message_content = _tmp56_;
			_tmp57_ = camel_mime_message_get_recipients (message, CAMEL_RECIPIENT_TYPE_TO);
			to = _tmp57_;
			_tmp58_ = to;
			if (_tmp58_ != NULL) {
				GtkEntry* _tmp59_;
				CamelInternetAddress* _tmp60_;
				gchar* _tmp61_;
				gchar* _tmp62_;
				_tmp59_ = self->priv->to_val;
				_tmp60_ = to;
				_tmp61_ = camel_address_format ((CamelAddress*) _tmp60_);
				_tmp62_ = _tmp61_;
				gtk_entry_set_text (_tmp59_, _tmp62_);
				_g_free0 (_tmp62_);
			}
			_tmp63_ = camel_mime_message_get_recipients (message, CAMEL_RECIPIENT_TYPE_CC);
			cc = _tmp63_;
			_tmp64_ = cc;
			if (_tmp64_ != NULL) {
				GtkEntry* _tmp65_;
				CamelInternetAddress* _tmp66_;
				gchar* _tmp67_;
				gchar* _tmp68_;
				GtkEntry* _tmp69_;
				const gchar* _tmp70_;
				const gchar* _tmp71_;
				gint _tmp72_;
				gint _tmp73_;
				_tmp65_ = self->priv->cc_val;
				_tmp66_ = cc;
				_tmp67_ = camel_address_format ((CamelAddress*) _tmp66_);
				_tmp68_ = _tmp67_;
				gtk_entry_set_text (_tmp65_, _tmp68_);
				_g_free0 (_tmp68_);
				_tmp69_ = self->priv->cc_val;
				_tmp70_ = gtk_entry_get_text (_tmp69_);
				_tmp71_ = _tmp70_;
				_tmp72_ = strlen (_tmp71_);
				_tmp73_ = _tmp72_;
				if (_tmp73_ > 0) {
					GtkRevealer* _tmp74_;
					_tmp74_ = self->priv->cc_revealer;
					gtk_revealer_set_reveal_child (_tmp74_, TRUE);
				}
			}
			_tmp75_ = camel_mime_message_get_recipients (message, CAMEL_RECIPIENT_TYPE_BCC);
			bcc = _tmp75_;
			_tmp76_ = bcc;
			if (_tmp76_ != NULL) {
				GtkEntry* _tmp77_;
				CamelInternetAddress* _tmp78_;
				gchar* _tmp79_;
				gchar* _tmp80_;
				GtkEntry* _tmp81_;
				const gchar* _tmp82_;
				const gchar* _tmp83_;
				gint _tmp84_;
				gint _tmp85_;
				_tmp77_ = self->priv->bcc_val;
				_tmp78_ = bcc;
				_tmp79_ = camel_address_format ((CamelAddress*) _tmp78_);
				_tmp80_ = _tmp79_;
				gtk_entry_set_text (_tmp77_, _tmp80_);
				_g_free0 (_tmp80_);
				_tmp81_ = self->priv->bcc_val;
				_tmp82_ = gtk_entry_get_text (_tmp81_);
				_tmp83_ = _tmp82_;
				_tmp84_ = strlen (_tmp83_);
				_tmp85_ = _tmp84_;
				if (_tmp85_ > 0) {
					GtkRevealer* _tmp86_;
					_tmp86_ = self->priv->bcc_revealer;
					gtk_revealer_set_reveal_child (_tmp86_, TRUE);
				}
			}
		} else {
			gchar* _tmp87_;
			gchar* date_format = NULL;
			gchar* _tmp88_;
			gboolean _tmp89_ = FALSE;
			_tmp87_ = g_strdup ("<br/><br/>");
			_g_free0 (message_content);
			message_content = _tmp87_;
			_tmp88_ = g_strdup (_ ("%a, %b %-e, %Y at %-l:%M %p"));
			date_format = _tmp88_;
			if (type == MAIL_COMPOSER_WIDGET_TYPE_REPLY) {
				_tmp89_ = TRUE;
			} else {
				_tmp89_ = type == MAIL_COMPOSER_WIDGET_TYPE_REPLY_ALL;
			}
			if (_tmp89_) {
				CamelInternetAddress* reply_to = NULL;
				CamelInternetAddress* _tmp90_;
				CamelInternetAddress* _tmp91_;
				CamelInternetAddress* _tmp92_;
				gchar* when = NULL;
				gint64 _tmp126_;
				gint64 _tmp127_;
				GDateTime* _tmp128_;
				GDateTime* _tmp129_;
				const gchar* _tmp130_;
				gchar* _tmp131_;
				gchar* _tmp132_;
				gchar* who = NULL;
				CamelInternetAddress* _tmp133_;
				gchar* _tmp134_;
				gchar* _tmp135_;
				gchar* _tmp136_;
				gchar* _tmp137_;
				const gchar* _tmp138_;
				const gchar* _tmp139_;
				const gchar* _tmp140_;
				gchar* _tmp141_;
				gchar* _tmp142_;
				gchar* _tmp143_;
				const gchar* _tmp144_;
				gchar* _tmp145_;
				const gchar* _tmp146_;
				gchar* _tmp147_;
				gchar* _tmp148_;
				gchar* _tmp149_;
				_tmp90_ = camel_mime_message_get_reply_to (message);
				_tmp91_ = _g_object_ref0 (_tmp90_);
				reply_to = _tmp91_;
				_tmp92_ = reply_to;
				if (_tmp92_ != NULL) {
					GtkEntry* _tmp93_;
					CamelInternetAddress* _tmp94_;
					gchar* _tmp95_;
					gchar* _tmp96_;
					_tmp93_ = self->priv->to_val;
					_tmp94_ = reply_to;
					_tmp95_ = camel_address_format ((CamelAddress*) _tmp94_);
					_tmp96_ = _tmp95_;
					gtk_entry_set_text (_tmp93_, _tmp96_);
					_g_free0 (_tmp96_);
				} else {
					GtkEntry* _tmp97_;
					CamelInternetAddress* _tmp98_;
					gchar* _tmp99_;
					gchar* _tmp100_;
					_tmp97_ = self->priv->to_val;
					_tmp98_ = camel_mime_message_get_from (message);
					_tmp99_ = camel_address_format ((CamelAddress*) _tmp98_);
					_tmp100_ = _tmp99_;
					gtk_entry_set_text (_tmp97_, _tmp100_);
					_g_free0 (_tmp100_);
				}
				if (type == MAIL_COMPOSER_WIDGET_TYPE_REPLY_ALL) {
					gchar* to_addresses = NULL;
					const gchar* _tmp101_;
					const gchar* _tmp102_;
					gchar* _tmp103_;
					GtkEntry* _tmp104_;
					GtkEntry* _tmp105_;
					const gchar* _tmp106_;
					const gchar* _tmp107_;
					const gchar* _tmp108_;
					gchar* _tmp109_;
					gchar* _tmp110_;
					gchar* _tmp111_;
					gchar* _tmp112_;
					const gchar* _tmp113_;
					const gchar* _tmp114_;
					_tmp101_ = camel_message_info_get_to (info);
					_tmp102_ = _tmp101_;
					_tmp103_ = mail_utils_get_reply_addresses (_tmp102_, _______lambda60__mail_utils_accept_address, self);
					to_addresses = _tmp103_;
					_tmp104_ = self->priv->to_val;
					_tmp105_ = self->priv->to_val;
					_tmp106_ = gtk_entry_get_text (_tmp105_);
					_tmp107_ = _tmp106_;
					_tmp108_ = to_addresses;
					_tmp109_ = g_strdup_printf (", %s", _tmp108_);
					_tmp110_ = _tmp109_;
					_tmp111_ = g_strconcat (_tmp107_, _tmp110_, NULL);
					_tmp112_ = _tmp111_;
					gtk_entry_set_text (_tmp105_, _tmp112_);
					_g_free0 (_tmp112_);
					_g_free0 (_tmp110_);
					_tmp113_ = camel_message_info_get_cc (info);
					_tmp114_ = _tmp113_;
					if (_tmp114_ != NULL) {
						GtkEntry* _tmp115_;
						const gchar* _tmp116_;
						const gchar* _tmp117_;
						gchar* _tmp118_;
						gchar* _tmp119_;
						GtkEntry* _tmp120_;
						const gchar* _tmp121_;
						const gchar* _tmp122_;
						gint _tmp123_;
						gint _tmp124_;
						_tmp115_ = self->priv->cc_val;
						_tmp116_ = camel_message_info_get_cc (info);
						_tmp117_ = _tmp116_;
						_tmp118_ = mail_utils_get_reply_addresses (_tmp117_, ________lambda61__mail_utils_accept_address, self);
						_tmp119_ = _tmp118_;
						gtk_entry_set_text (_tmp115_, _tmp119_);
						_g_free0 (_tmp119_);
						_tmp120_ = self->priv->cc_val;
						_tmp121_ = gtk_entry_get_text (_tmp120_);
						_tmp122_ = _tmp121_;
						_tmp123_ = strlen (_tmp122_);
						_tmp124_ = _tmp123_;
						if (_tmp124_ > 0) {
							GtkRevealer* _tmp125_;
							_tmp125_ = self->priv->cc_revealer;
							gtk_revealer_set_reveal_child (_tmp125_, TRUE);
						}
					}
					_g_free0 (to_addresses);
				}
				_tmp126_ = camel_message_info_get_date_received (info);
				_tmp127_ = _tmp126_;
				_tmp128_ = g_date_time_new_from_unix_utc (_tmp127_);
				_tmp129_ = _tmp128_;
				_tmp130_ = date_format;
				_tmp131_ = g_date_time_format (_tmp129_, _tmp130_);
				_tmp132_ = _tmp131_;
				_g_date_time_unref0 (_tmp129_);
				when = _tmp132_;
				_tmp133_ = camel_mime_message_get_from (message);
				_tmp134_ = camel_address_format ((CamelAddress*) _tmp133_);
				_tmp135_ = _tmp134_;
				_tmp136_ = mail_utils_escape_html_tags (_tmp135_);
				_tmp137_ = _tmp136_;
				_g_free0 (_tmp135_);
				who = _tmp137_;
				_tmp138_ = message_content;
				_tmp139_ = when;
				_tmp140_ = who;
				_tmp141_ = g_strdup_printf (_ ("On %1$s, %2$s wrote:"), _tmp139_, _tmp140_);
				_tmp142_ = _tmp141_;
				_tmp143_ = g_strconcat (_tmp138_, _tmp142_, NULL);
				_g_free0 (message_content);
				message_content = _tmp143_;
				_g_free0 (_tmp142_);
				_tmp144_ = message_content;
				_tmp145_ = g_strconcat (_tmp144_, "<br/>", NULL);
				_g_free0 (message_content);
				message_content = _tmp145_;
				_tmp146_ = message_content;
				_tmp147_ = g_strdup_printf ("<blockquote type=\"cite\">%s</blockquote>", content_to_quote);
				_tmp148_ = _tmp147_;
				_tmp149_ = g_strconcat (_tmp146_, _tmp148_, NULL);
				_g_free0 (message_content);
				message_content = _tmp149_;
				_g_free0 (_tmp148_);
				_g_free0 (who);
				_g_free0 (when);
				_g_object_unref0 (reply_to);
			} else {
				if (type == MAIL_COMPOSER_WIDGET_TYPE_FORWARD) {
					const gchar* _tmp150_;
					gchar* _tmp151_;
					const gchar* _tmp152_;
					gchar* _tmp153_;
					const gchar* _tmp154_;
					CamelInternetAddress* _tmp155_;
					gchar* _tmp156_;
					gchar* _tmp157_;
					gchar* _tmp158_;
					gchar* _tmp159_;
					gchar* _tmp160_;
					gchar* _tmp161_;
					gchar* _tmp162_;
					const gchar* _tmp163_;
					const gchar* _tmp164_;
					const gchar* _tmp165_;
					gchar* _tmp166_;
					gchar* _tmp167_;
					gchar* _tmp168_;
					gchar* _tmp169_;
					gchar* _tmp170_;
					const gchar* _tmp171_;
					gint64 _tmp172_;
					gint64 _tmp173_;
					GDateTime* _tmp174_;
					GDateTime* _tmp175_;
					const gchar* _tmp176_;
					gchar* _tmp177_;
					gchar* _tmp178_;
					gchar* _tmp179_;
					gchar* _tmp180_;
					gchar* _tmp181_;
					const gchar* _tmp182_;
					const gchar* _tmp183_;
					const gchar* _tmp184_;
					gchar* _tmp185_;
					gchar* _tmp186_;
					gchar* _tmp187_;
					gchar* _tmp188_;
					gchar* _tmp189_;
					gboolean _tmp190_ = FALSE;
					const gchar* _tmp191_;
					const gchar* _tmp192_;
					const gchar* _tmp203_;
					gchar* _tmp204_;
					const gchar* _tmp205_;
					gchar* _tmp206_;
					_tmp150_ = message_content;
					_tmp151_ = g_strconcat (_tmp150_, _ ("---------- Forwarded message ----------"), NULL);
					_g_free0 (message_content);
					message_content = _tmp151_;
					_tmp152_ = message_content;
					_tmp153_ = g_strconcat (_tmp152_, "<br/><br/>", NULL);
					_g_free0 (message_content);
					message_content = _tmp153_;
					_tmp154_ = message_content;
					_tmp155_ = camel_mime_message_get_from (message);
					_tmp156_ = camel_address_format ((CamelAddress*) _tmp155_);
					_tmp157_ = _tmp156_;
					_tmp158_ = mail_utils_escape_html_tags (_tmp157_);
					_tmp159_ = _tmp158_;
					_tmp160_ = g_strdup_printf (_ ("From: %s<br/>"), _tmp159_);
					_tmp161_ = _tmp160_;
					_tmp162_ = g_strconcat (_tmp154_, _tmp161_, NULL);
					_g_free0 (message_content);
					message_content = _tmp162_;
					_g_free0 (_tmp161_);
					_g_free0 (_tmp159_);
					_g_free0 (_tmp157_);
					_tmp163_ = message_content;
					_tmp164_ = camel_message_info_get_subject (info);
					_tmp165_ = _tmp164_;
					_tmp166_ = mail_utils_escape_html_tags (_tmp165_);
					_tmp167_ = _tmp166_;
					_tmp168_ = g_strdup_printf (_ ("Subject: %s<br/>"), _tmp167_);
					_tmp169_ = _tmp168_;
					_tmp170_ = g_strconcat (_tmp163_, _tmp169_, NULL);
					_g_free0 (message_content);
					message_content = _tmp170_;
					_g_free0 (_tmp169_);
					_g_free0 (_tmp167_);
					_tmp171_ = message_content;
					_tmp172_ = camel_message_info_get_date_received (info);
					_tmp173_ = _tmp172_;
					_tmp174_ = g_date_time_new_from_unix_utc (_tmp173_);
					_tmp175_ = _tmp174_;
					_tmp176_ = date_format;
					_tmp177_ = g_date_time_format (_tmp175_, _tmp176_);
					_tmp178_ = _tmp177_;
					_tmp179_ = g_strdup_printf (_ ("Date: %s<br/>"), _tmp178_);
					_tmp180_ = _tmp179_;
					_tmp181_ = g_strconcat (_tmp171_, _tmp180_, NULL);
					_g_free0 (message_content);
					message_content = _tmp181_;
					_g_free0 (_tmp180_);
					_g_free0 (_tmp178_);
					_g_date_time_unref0 (_tmp175_);
					_tmp182_ = message_content;
					_tmp183_ = camel_message_info_get_to (info);
					_tmp184_ = _tmp183_;
					_tmp185_ = mail_utils_escape_html_tags (_tmp184_);
					_tmp186_ = _tmp185_;
					_tmp187_ = g_strdup_printf (_ ("To: %s<br/>"), _tmp186_);
					_tmp188_ = _tmp187_;
					_tmp189_ = g_strconcat (_tmp182_, _tmp188_, NULL);
					_g_free0 (message_content);
					message_content = _tmp189_;
					_g_free0 (_tmp188_);
					_g_free0 (_tmp186_);
					_tmp191_ = camel_message_info_get_cc (info);
					_tmp192_ = _tmp191_;
					if (_tmp192_ != NULL) {
						const gchar* _tmp193_;
						const gchar* _tmp194_;
						_tmp193_ = camel_message_info_get_cc (info);
						_tmp194_ = _tmp193_;
						_tmp190_ = g_strcmp0 (_tmp194_, "") != 0;
					} else {
						_tmp190_ = FALSE;
					}
					if (_tmp190_) {
						const gchar* _tmp195_;
						const gchar* _tmp196_;
						const gchar* _tmp197_;
						gchar* _tmp198_;
						gchar* _tmp199_;
						gchar* _tmp200_;
						gchar* _tmp201_;
						gchar* _tmp202_;
						_tmp195_ = message_content;
						_tmp196_ = camel_message_info_get_cc (info);
						_tmp197_ = _tmp196_;
						_tmp198_ = mail_utils_escape_html_tags (_tmp197_);
						_tmp199_ = _tmp198_;
						_tmp200_ = g_strdup_printf (_ ("Cc: %s<br/>"), _tmp199_);
						_tmp201_ = _tmp200_;
						_tmp202_ = g_strconcat (_tmp195_, _tmp201_, NULL);
						_g_free0 (message_content);
						message_content = _tmp202_;
						_g_free0 (_tmp201_);
						_g_free0 (_tmp199_);
					}
					_tmp203_ = message_content;
					_tmp204_ = g_strconcat (_tmp203_, "<br/><br/>", NULL);
					_g_free0 (message_content);
					message_content = _tmp204_;
					_tmp205_ = message_content;
					_tmp206_ = g_strconcat (_tmp205_, content_to_quote, NULL);
					_g_free0 (message_content);
					message_content = _tmp206_;
				}
			}
			_g_free0 (date_format);
		}
		_tmp207_ = self->priv->web_view;
		_tmp208_ = message_content;
		_tmp209_ = g_strdup (_tmp208_);
		mail_web_view_set_body_content (_tmp207_, _tmp209_);
		_g_free0 (message_content);
	}
}

static void
mail_composer_widget_on_edit_action (MailComposerWidget* self,
                                     GSimpleAction* action,
                                     GVariant* param)
{
	gchar* command = NULL;
	const gchar* _tmp0_;
	gchar* _tmp1_;
	MailWebView* _tmp2_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (action != NULL);
	_tmp0_ = g_variant_get_string (param, NULL);
	_tmp1_ = g_strdup (_tmp0_);
	command = _tmp1_;
	_tmp2_ = self->priv->web_view;
	mail_web_view_execute_editor_command (_tmp2_, command, "");
	mail_composer_widget_update_actions (self);
	_g_free0 (command);
}

static void
mail_composer_widget_on_remove_format (MailComposerWidget* self)
{
	MailWebView* _tmp0_;
	MailWebView* _tmp1_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->web_view;
	mail_web_view_execute_editor_command (_tmp0_, "removeformat", "");
	_tmp1_ = self->priv->web_view;
	mail_web_view_execute_editor_command (_tmp1_, "unlink", "");
}

static GVariant*
_variant_new1 (const gchar* value)
{
	return g_variant_ref_sink (g_variant_new_string (value));
}

static void
__lambda52_ (MailComposerWidget* self,
             GObject* obj,
             GAsyncResult* res)
{
	const gchar* _tmp0_ = NULL;
	MailWebView* _tmp1_;
	GSimpleActionGroup* _tmp2_;
	GVariant* _tmp3_;
	g_return_if_fail (res != NULL);
	_tmp1_ = self->priv->web_view;
	if (mail_web_view_query_command_state_finish (_tmp1_, res)) {
		_tmp0_ = MAIL_COMPOSER_WIDGET_ACTION_BOLD;
	} else {
		_tmp0_ = "";
	}
	_tmp2_ = self->priv->actions;
	_tmp3_ = _variant_new1 (_tmp0_);
	g_action_group_change_action_state ((GActionGroup*) _tmp2_, MAIL_COMPOSER_WIDGET_ACTION_BOLD, _tmp3_);
	_g_variant_unref0 (_tmp3_);
}

static void
___lambda52__gasync_ready_callback (GObject* source_object,
                                    GAsyncResult* res,
                                    gpointer self)
{
	__lambda52_ ((MailComposerWidget*) self, source_object, res);
	g_object_unref (self);
}

static GVariant*
_variant_new2 (const gchar* value)
{
	return g_variant_ref_sink (g_variant_new_string (value));
}

static void
__lambda53_ (MailComposerWidget* self,
             GObject* obj,
             GAsyncResult* res)
{
	const gchar* _tmp0_ = NULL;
	MailWebView* _tmp1_;
	GSimpleActionGroup* _tmp2_;
	GVariant* _tmp3_;
	g_return_if_fail (res != NULL);
	_tmp1_ = self->priv->web_view;
	if (mail_web_view_query_command_state_finish (_tmp1_, res)) {
		_tmp0_ = MAIL_COMPOSER_WIDGET_ACTION_ITALIC;
	} else {
		_tmp0_ = "";
	}
	_tmp2_ = self->priv->actions;
	_tmp3_ = _variant_new2 (_tmp0_);
	g_action_group_change_action_state ((GActionGroup*) _tmp2_, MAIL_COMPOSER_WIDGET_ACTION_ITALIC, _tmp3_);
	_g_variant_unref0 (_tmp3_);
}

static void
___lambda53__gasync_ready_callback (GObject* source_object,
                                    GAsyncResult* res,
                                    gpointer self)
{
	__lambda53_ ((MailComposerWidget*) self, source_object, res);
	g_object_unref (self);
}

static GVariant*
_variant_new3 (const gchar* value)
{
	return g_variant_ref_sink (g_variant_new_string (value));
}

static void
__lambda54_ (MailComposerWidget* self,
             GObject* obj,
             GAsyncResult* res)
{
	const gchar* _tmp0_ = NULL;
	MailWebView* _tmp1_;
	GSimpleActionGroup* _tmp2_;
	GVariant* _tmp3_;
	g_return_if_fail (res != NULL);
	_tmp1_ = self->priv->web_view;
	if (mail_web_view_query_command_state_finish (_tmp1_, res)) {
		_tmp0_ = MAIL_COMPOSER_WIDGET_ACTION_UNDERLINE;
	} else {
		_tmp0_ = "";
	}
	_tmp2_ = self->priv->actions;
	_tmp3_ = _variant_new3 (_tmp0_);
	g_action_group_change_action_state ((GActionGroup*) _tmp2_, MAIL_COMPOSER_WIDGET_ACTION_UNDERLINE, _tmp3_);
	_g_variant_unref0 (_tmp3_);
}

static void
___lambda54__gasync_ready_callback (GObject* source_object,
                                    GAsyncResult* res,
                                    gpointer self)
{
	__lambda54_ ((MailComposerWidget*) self, source_object, res);
	g_object_unref (self);
}

static GVariant*
_variant_new4 (const gchar* value)
{
	return g_variant_ref_sink (g_variant_new_string (value));
}

static void
__lambda55_ (MailComposerWidget* self,
             GObject* obj,
             GAsyncResult* res)
{
	const gchar* _tmp0_ = NULL;
	MailWebView* _tmp1_;
	GSimpleActionGroup* _tmp2_;
	GVariant* _tmp3_;
	g_return_if_fail (res != NULL);
	_tmp1_ = self->priv->web_view;
	if (mail_web_view_query_command_state_finish (_tmp1_, res)) {
		_tmp0_ = MAIL_COMPOSER_WIDGET_ACTION_STRIKETHROUGH;
	} else {
		_tmp0_ = "";
	}
	_tmp2_ = self->priv->actions;
	_tmp3_ = _variant_new4 (_tmp0_);
	g_action_group_change_action_state ((GActionGroup*) _tmp2_, MAIL_COMPOSER_WIDGET_ACTION_STRIKETHROUGH, _tmp3_);
	_g_variant_unref0 (_tmp3_);
}

static void
___lambda55__gasync_ready_callback (GObject* source_object,
                                    GAsyncResult* res,
                                    gpointer self)
{
	__lambda55_ ((MailComposerWidget*) self, source_object, res);
	g_object_unref (self);
}

static void
mail_composer_widget_update_actions (MailComposerWidget* self)
{
	MailWebView* _tmp0_;
	MailWebView* _tmp1_;
	MailWebView* _tmp2_;
	MailWebView* _tmp3_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->web_view;
	mail_web_view_query_command_state (_tmp0_, "bold", ___lambda52__gasync_ready_callback, g_object_ref (self));
	_tmp1_ = self->priv->web_view;
	mail_web_view_query_command_state (_tmp1_, "italic", ___lambda53__gasync_ready_callback, g_object_ref (self));
	_tmp2_ = self->priv->web_view;
	mail_web_view_query_command_state (_tmp2_, "underline", ___lambda54__gasync_ready_callback, g_object_ref (self));
	_tmp3_ = self->priv->web_view;
	mail_web_view_query_command_state (_tmp3_, "strikethrough", ___lambda55__gasync_ready_callback, g_object_ref (self));
}

static void
mail_composer_widget_on_discard (MailComposerWidget* self)
{
	GraniteMessageDialog* discard_dialog = NULL;
	GThemedIcon* _tmp0_;
	GThemedIcon* _tmp1_;
	GThemedIcon* _tmp2_;
	GtkWidget* _tmp3_;
	GtkWindow* _tmp4_;
	GraniteMessageDialog* _tmp5_ = NULL;
	GraniteMessageDialog* _tmp6_;
	GraniteMessageDialog* _tmp7_;
	GtkWidget* discard_anyway = NULL;
	GraniteMessageDialog* _tmp8_;
	GtkWidget* _tmp9_;
	GtkWidget* _tmp10_;
	GtkWidget* _tmp11_;
	GtkStyleContext* _tmp12_;
	GraniteMessageDialog* _tmp13_;
	GraniteMessageDialog* _tmp14_;
	g_return_if_fail (self != NULL);
	_tmp0_ = (GThemedIcon*) g_themed_icon_new ("mail-drafts");
	_tmp1_ = _tmp0_;
	_tmp2_ = (GThemedIcon*) g_themed_icon_new ("edit-delete");
	_tmp3_ = gtk_widget_get_toplevel ((GtkWidget*) self);
	_tmp4_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_TYPE (_tmp3_, gtk_window_get_type ()) ? ((GtkWindow*) _tmp3_) : NULL);
	_tmp5_ = granite_message_dialog_new (_ ("Permanently delete this draft?"), _ ("You cannot undo this action, nor recover your draft once it has been d" \
"eleted."), (GIcon*) _tmp1_, GTK_BUTTONS_NONE);
	granite_message_dialog_set_badge_icon (_tmp5_, (GIcon*) _tmp2_);
	_g_object_unref0 (_tmp2_);
	gtk_window_set_transient_for ((GtkWindow*) _tmp5_, _tmp4_);
	_g_object_unref0 (_tmp4_);
	g_object_ref_sink (_tmp5_);
	_tmp6_ = _tmp5_;
	_g_object_unref0 (_tmp1_);
	discard_dialog = _tmp6_;
	_tmp7_ = discard_dialog;
	gtk_dialog_add_button ((GtkDialog*) _tmp7_, _ ("Cancel"), (gint) GTK_RESPONSE_CANCEL);
	_tmp8_ = discard_dialog;
	_tmp9_ = gtk_dialog_add_button ((GtkDialog*) _tmp8_, _ ("Delete Draft"), (gint) GTK_RESPONSE_ACCEPT);
	_tmp10_ = _g_object_ref0 (_tmp9_);
	discard_anyway = _tmp10_;
	_tmp11_ = discard_anyway;
	_tmp12_ = gtk_widget_get_style_context (_tmp11_);
	gtk_style_context_add_class (_tmp12_, GTK_STYLE_CLASS_DESTRUCTIVE_ACTION);
	_tmp13_ = discard_dialog;
	if (gtk_dialog_run ((GtkDialog*) _tmp13_) == ((gint) GTK_RESPONSE_ACCEPT)) {
		self->priv->discard_draft = TRUE;
		g_signal_emit (self, mail_composer_widget_signals[MAIL_COMPOSER_WIDGET_DISCARDED_SIGNAL], 0);
	}
	_tmp14_ = discard_dialog;
	gtk_widget_destroy ((GtkWidget*) _tmp14_);
	_g_object_unref0 (discard_anyway);
	_g_object_unref0 (discard_dialog);
}

static void
mail_composer_widget_on_send (MailComposerWidget* self)
{
	g_return_if_fail (self != NULL);
	mail_composer_widget_send_message (self, NULL, NULL);
}

static void
mail_composer_widget_send_message_data_free (gpointer _data)
{
	MailComposerWidgetSendMessageData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (MailComposerWidgetSendMessageData, _data_);
}

static void
mail_composer_widget_send_message (MailComposerWidget* self,
                                   GAsyncReadyCallback _callback_,
                                   gpointer _user_data_)
{
	MailComposerWidgetSendMessageData* _data_;
	MailComposerWidget* _tmp0_;
	g_return_if_fail (self != NULL);
	_data_ = g_slice_new0 (MailComposerWidgetSendMessageData);
	_data_->_async_result = g_task_new (G_OBJECT (self), NULL, _callback_, _user_data_);
	g_task_set_task_data (_data_->_async_result, _data_, mail_composer_widget_send_message_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	mail_composer_widget_send_message_co (_data_);
}

static void
mail_composer_widget_send_message_finish (MailComposerWidget* self,
                                          GAsyncResult* _res_)
{
	MailComposerWidgetSendMessageData* _data_;
	_data_ = g_task_propagate_pointer (G_TASK (_res_), NULL);
}

static void
mail_composer_widget_send_message_ready (GObject* source_object,
                                         GAsyncResult* _res_,
                                         gpointer _user_data_)
{
	MailComposerWidgetSendMessageData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	mail_composer_widget_send_message_co (_data_);
}

static gboolean
mail_composer_widget_send_message_co (MailComposerWidgetSendMessageData* _data_)
{
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	gtk_widget_set_sensitive ((GtkWidget*) _data_->self, FALSE);
	_data_->_tmp0_ = _data_->self->priv->subject_val;
	_data_->_tmp1_ = gtk_entry_get_text (_data_->_tmp0_);
	_data_->_tmp2_ = _data_->_tmp1_;
	if (g_strcmp0 (_data_->_tmp2_, "") == 0) {
		_data_->_tmp3_ = granite_message_dialog_new_with_image_from_icon_name (_ ("Send without subject?"), _ ("This message has an empty subject field. The recipient may be unable t" \
"o infer its scope or importance."), "mail-send", GTK_BUTTONS_NONE);
		g_object_ref_sink (_data_->_tmp3_);
		_data_->no_subject_dialog = _data_->_tmp3_;
		_data_->_tmp4_ = _data_->no_subject_dialog;
		_data_->_tmp5_ = gtk_widget_get_toplevel ((GtkWidget*) _data_->self);
		gtk_window_set_transient_for ((GtkWindow*) _data_->_tmp4_, G_TYPE_CHECK_INSTANCE_TYPE (_data_->_tmp5_, gtk_window_get_type ()) ? ((GtkWindow*) _data_->_tmp5_) : NULL);
		_data_->_tmp6_ = _data_->no_subject_dialog;
		gtk_dialog_add_button ((GtkDialog*) _data_->_tmp6_, _ ("Don't Send"), (gint) GTK_RESPONSE_CANCEL);
		_data_->_tmp7_ = _data_->no_subject_dialog;
		_data_->_tmp8_ = gtk_dialog_add_button ((GtkDialog*) _data_->_tmp7_, _ ("Send Anyway"), (gint) GTK_RESPONSE_ACCEPT);
		_data_->_tmp9_ = _g_object_ref0 (_data_->_tmp8_);
		_data_->send_anyway = _data_->_tmp9_;
		_data_->_tmp10_ = _data_->send_anyway;
		_data_->_tmp11_ = gtk_widget_get_style_context (_data_->_tmp10_);
		gtk_style_context_add_class (_data_->_tmp11_, GTK_STYLE_CLASS_DESTRUCTIVE_ACTION);
		_data_->_tmp12_ = _data_->no_subject_dialog;
		if (gtk_dialog_run ((GtkDialog*) _data_->_tmp12_) == ((gint) GTK_RESPONSE_CANCEL)) {
			_data_->_tmp13_ = _data_->no_subject_dialog;
			gtk_widget_destroy ((GtkWidget*) _data_->_tmp13_);
			gtk_widget_set_sensitive ((GtkWidget*) _data_->self, TRUE);
			_g_object_unref0 (_data_->send_anyway);
			_g_object_unref0 (_data_->no_subject_dialog);
			g_task_return_pointer (_data_->_async_result, _data_, NULL);
			if (_data_->_state_ != 0) {
				while (!g_task_get_completed (_data_->_async_result)) {
					g_main_context_iteration (g_task_get_context (_data_->_async_result), TRUE);
				}
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		}
		_data_->_tmp14_ = _data_->no_subject_dialog;
		gtk_widget_destroy ((GtkWidget*) _data_->_tmp14_);
		_g_object_unref0 (_data_->send_anyway);
		_g_object_unref0 (_data_->no_subject_dialog);
	}
	_data_->_tmp15_ = mail_backend_session_get_default ();
	_data_->session = _data_->_tmp15_;
	_data_->_tmp16_ = _data_->self->priv->web_view;
	_data_->_state_ = 1;
	mail_web_view_get_body_html (_data_->_tmp16_, mail_composer_widget_send_message_ready, _data_);
	return FALSE;
	_state_1:
	_data_->_tmp17_ = mail_web_view_get_body_html_finish (_data_->_tmp16_, _data_->_res_);
	_data_->body_html = _data_->_tmp17_;
	_data_->_tmp18_ = _data_->body_html;
	_data_->_tmp19_ = mail_composer_widget_build_message (_data_->self, _data_->_tmp18_);
	_data_->message = _data_->_tmp19_;
	_data_->_tmp20_ = _data_->message;
	_data_->_tmp21_ = _data_->self->priv->from_combo;
	_data_->_tmp22_ = gtk_combo_box_text_get_active_text (_data_->_tmp21_);
	_data_->_tmp23_ = _data_->_tmp22_;
	_data_->_tmp24_ = mail_composer_widget_build_sender (_data_->self, _data_->_tmp20_, _data_->_tmp23_);
	_data_->_tmp25_ = _data_->_tmp24_;
	_g_free0 (_data_->_tmp23_);
	_data_->sender = _data_->_tmp25_;
	_data_->_tmp26_ = _data_->message;
	_data_->_tmp27_ = _data_->self->priv->to_val;
	_data_->_tmp28_ = gtk_entry_get_text (_data_->_tmp27_);
	_data_->_tmp29_ = _data_->_tmp28_;
	_data_->_tmp30_ = _data_->self->priv->cc_val;
	_data_->_tmp31_ = gtk_entry_get_text (_data_->_tmp30_);
	_data_->_tmp32_ = _data_->_tmp31_;
	_data_->_tmp33_ = _data_->self->priv->bcc_val;
	_data_->_tmp34_ = gtk_entry_get_text (_data_->_tmp33_);
	_data_->_tmp35_ = _data_->_tmp34_;
	_data_->_tmp36_ = mail_composer_widget_build_recipients (_data_->self, _data_->_tmp26_, _data_->_tmp29_, _data_->_tmp32_, _data_->_tmp35_);
	_data_->recipients = _data_->_tmp36_;
	{
		_data_->_tmp37_ = _data_->session;
		_data_->_tmp38_ = _data_->message;
		_data_->_tmp39_ = _data_->sender;
		_data_->_tmp40_ = _data_->recipients;
		_data_->_state_ = 2;
		mail_backend_session_send_email (_data_->_tmp37_, _data_->_tmp38_, _data_->_tmp39_, (CamelAddress*) _data_->_tmp40_, mail_composer_widget_send_message_ready, _data_);
		return FALSE;
		_state_2:
		_data_->sent_message_saved = mail_backend_session_send_email_finish (_data_->_tmp37_, _data_->_res_, &_data_->_inner_error0_);
		if (G_UNLIKELY (_data_->_inner_error0_ != NULL)) {
			goto __catch0_g_error;
		}
		if (!_data_->sent_message_saved) {
			_data_->_tmp41_ = (GThemedIcon*) g_themed_icon_new ("mail-send");
			_data_->_tmp42_ = _data_->_tmp41_;
			_data_->_tmp43_ = (GThemedIcon*) g_themed_icon_new ("dialog-warning");
			_data_->_tmp44_ = NULL;
			_data_->_tmp44_ = granite_message_dialog_new (_ ("Sent message was not saved"), _ ("The message was sent, however a copy was not saved to the Sent message" \
" folder."), (GIcon*) _data_->_tmp42_, GTK_BUTTONS_CLOSE);
			granite_message_dialog_set_badge_icon (_data_->_tmp44_, (GIcon*) _data_->_tmp43_);
			_g_object_unref0 (_data_->_tmp43_);
			g_object_ref_sink (_data_->_tmp44_);
			_data_->_tmp45_ = _data_->_tmp44_;
			_g_object_unref0 (_data_->_tmp42_);
			_data_->warning_dialog = _data_->_tmp45_;
			_data_->_tmp46_ = _data_->warning_dialog;
			gtk_dialog_run ((GtkDialog*) _data_->_tmp46_);
			_data_->_tmp47_ = _data_->warning_dialog;
			gtk_widget_destroy ((GtkWidget*) _data_->_tmp47_);
			_g_object_unref0 (_data_->warning_dialog);
		}
		_data_->self->priv->discard_draft = TRUE;
		g_signal_emit (_data_->self, mail_composer_widget_signals[MAIL_COMPOSER_WIDGET_SENT_SIGNAL], 0);
	}
	goto __finally0;
	__catch0_g_error:
	{
		_data_->e = _data_->_inner_error0_;
		_data_->_inner_error0_ = NULL;
		_data_->_tmp48_ = (GThemedIcon*) g_themed_icon_new ("mail-send");
		_data_->_tmp49_ = _data_->_tmp48_;
		_data_->_tmp50_ = (GThemedIcon*) g_themed_icon_new ("dialog-error");
		_data_->_tmp51_ = NULL;
		_data_->_tmp51_ = granite_message_dialog_new (_ ("Unable to send message"), _ ("There was an unexpected error while sending your message."), (GIcon*) _data_->_tmp49_, GTK_BUTTONS_CLOSE);
		granite_message_dialog_set_badge_icon (_data_->_tmp51_, (GIcon*) _data_->_tmp50_);
		_g_object_unref0 (_data_->_tmp50_);
		g_object_ref_sink (_data_->_tmp51_);
		_data_->_tmp52_ = _data_->_tmp51_;
		_g_object_unref0 (_data_->_tmp49_);
		_data_->error_dialog = _data_->_tmp52_;
		_data_->_tmp53_ = _data_->error_dialog;
		_data_->_tmp54_ = _data_->e;
		_data_->_tmp55_ = _data_->_tmp54_->message;
		granite_message_dialog_show_error_details (_data_->_tmp53_, _data_->_tmp55_);
		_data_->_tmp56_ = _data_->error_dialog;
		gtk_dialog_run ((GtkDialog*) _data_->_tmp56_);
		_data_->_tmp57_ = _data_->error_dialog;
		gtk_widget_destroy ((GtkWidget*) _data_->_tmp57_);
		_g_object_unref0 (_data_->error_dialog);
		_g_error_free0 (_data_->e);
	}
	__finally0:
	{
		gtk_widget_set_sensitive ((GtkWidget*) _data_->self, TRUE);
	}
	if (G_UNLIKELY (_data_->_inner_error0_ != NULL)) {
		_g_object_unref0 (_data_->recipients);
		_g_object_unref0 (_data_->sender);
		_g_object_unref0 (_data_->message);
		_g_free0 (_data_->body_html);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error0_->message, g_quark_to_string (_data_->_inner_error0_->domain), _data_->_inner_error0_->code);
		g_clear_error (&_data_->_inner_error0_);
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_g_object_unref0 (_data_->recipients);
	_g_object_unref0 (_data_->sender);
	_g_object_unref0 (_data_->message);
	_g_free0 (_data_->body_html);
	g_task_return_pointer (_data_->_async_result, _data_, NULL);
	if (_data_->_state_ != 0) {
		while (!g_task_get_completed (_data_->_async_result)) {
			g_main_context_iteration (g_task_get_context (_data_->_async_result), TRUE);
		}
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}

static CamelInternetAddress*
mail_composer_widget_build_sender (MailComposerWidget* self,
                                   CamelMimeMessage* message,
                                   const gchar* from)
{
	CamelInternetAddress* sender = NULL;
	CamelInternetAddress* _tmp0_;
	CamelInternetAddress* result;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (message != NULL, NULL);
	g_return_val_if_fail (from != NULL, NULL);
	_tmp0_ = camel_internet_address_new ();
	sender = _tmp0_;
	camel_address_unformat ((CamelAddress*) sender, from);
	camel_mime_message_set_from (message, sender);
	result = sender;
	return result;
}

static CamelInternetAddress*
mail_composer_widget_build_recipients (MailComposerWidget* self,
                                       CamelMimeMessage* message,
                                       const gchar* to,
                                       const gchar* cc,
                                       const gchar* bcc)
{
	CamelInternetAddress* to_addresses = NULL;
	CamelInternetAddress* _tmp0_;
	CamelInternetAddress* cc_addresses = NULL;
	CamelInternetAddress* _tmp1_;
	CamelInternetAddress* bcc_addresses = NULL;
	CamelInternetAddress* _tmp2_;
	CamelInternetAddress* recipients = NULL;
	CamelInternetAddress* _tmp3_;
	CamelInternetAddress* result;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (message != NULL, NULL);
	g_return_val_if_fail (to != NULL, NULL);
	g_return_val_if_fail (cc != NULL, NULL);
	g_return_val_if_fail (bcc != NULL, NULL);
	_tmp0_ = camel_internet_address_new ();
	to_addresses = _tmp0_;
	camel_address_unformat ((CamelAddress*) to_addresses, to);
	camel_mime_message_set_recipients (message, CAMEL_RECIPIENT_TYPE_TO, to_addresses);
	_tmp1_ = camel_internet_address_new ();
	cc_addresses = _tmp1_;
	camel_address_unformat ((CamelAddress*) cc_addresses, cc);
	camel_mime_message_set_recipients (message, CAMEL_RECIPIENT_TYPE_CC, cc_addresses);
	_tmp2_ = camel_internet_address_new ();
	bcc_addresses = _tmp2_;
	camel_address_unformat ((CamelAddress*) bcc_addresses, bcc);
	camel_mime_message_set_recipients (message, CAMEL_RECIPIENT_TYPE_BCC, bcc_addresses);
	_tmp3_ = camel_internet_address_new ();
	recipients = _tmp3_;
	camel_address_cat ((CamelAddress*) recipients, (CamelAddress*) to_addresses);
	camel_address_cat ((CamelAddress*) recipients, (CamelAddress*) cc_addresses);
	camel_address_cat ((CamelAddress*) recipients, (CamelAddress*) bcc_addresses);
	result = recipients;
	_g_object_unref0 (bcc_addresses);
	_g_object_unref0 (cc_addresses);
	_g_object_unref0 (to_addresses);
	return result;
}

static guint8*
string_get_data (const gchar* self,
                 gint* result_length1)
{
	guint8* result;
	guint8* res = NULL;
	gint res_length1;
	gint _res_size_;
	gint _tmp0_;
	gint _tmp1_;
	guint8* _tmp2_;
	gint _tmp2__length1;
	g_return_val_if_fail (self != NULL, NULL);
	res = (guint8*) self;
	res_length1 = -1;
	_res_size_ = res_length1;
	_tmp0_ = strlen (self);
	_tmp1_ = _tmp0_;
	res_length1 = (gint) _tmp1_;
	_tmp2_ = res;
	_tmp2__length1 = res_length1;
	if (result_length1) {
		*result_length1 = _tmp2__length1;
	}
	result = _tmp2_;
	return result;
}

static CamelMimeMessage*
mail_composer_widget_build_message (MailComposerWidget* self,
                                    const gchar* body_html)
{
	CamelStreamMem* stream_mem = NULL;
	guint8* _tmp0_;
	gint _tmp0__length1;
	gint _tmp1_ = 0;
	guint8* _tmp2_;
	gint _tmp2__length1;
	CamelStreamMem* _tmp3_;
	CamelStreamFilter* stream_filter = NULL;
	CamelStreamMem* _tmp4_;
	CamelStreamFilter* _tmp5_;
	CamelDataWrapper* html = NULL;
	CamelDataWrapper* _tmp6_;
	CamelMimePart* part = NULL;
	CamelMimePart* _tmp12_;
	CamelMimePart* _tmp13_;
	CamelDataWrapper* _tmp14_;
	CamelMimePart* _tmp15_;
	CamelMultipart* body = NULL;
	CamelMultipart* _tmp16_;
	CamelMultipart* _tmp17_;
	CamelMultipart* _tmp18_;
	CamelMultipart* _tmp19_;
	CamelMimePart* _tmp20_;
	GtkFlowBox* _tmp21_;
	GList* _tmp22_;
	GList* _tmp23_;
	gboolean _tmp24_;
	CamelMimeMessage* message = NULL;
	CamelMimeMessage* _tmp33_;
	GtkEntry* _tmp34_;
	const gchar* _tmp35_;
	const gchar* _tmp36_;
	CamelMultipart* _tmp37_;
	GError* _inner_error0_ = NULL;
	CamelMimeMessage* result;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (body_html != NULL, NULL);
	_tmp0_ = string_get_data (body_html, &_tmp1_);
	_tmp0__length1 = _tmp1_;
	_tmp2_ = _tmp0_;
	_tmp2__length1 = _tmp0__length1;
	_tmp3_ = (CamelStreamMem*) camel_stream_mem_new_with_buffer (_tmp2_, _tmp2__length1);
	stream_mem = _tmp3_;
	_tmp4_ = stream_mem;
	_tmp5_ = (CamelStreamFilter*) camel_stream_filter_new ((CamelStream*) _tmp4_);
	stream_filter = _tmp5_;
	_tmp6_ = camel_data_wrapper_new ();
	html = _tmp6_;
	{
		CamelDataWrapper* _tmp7_;
		CamelStreamFilter* _tmp8_;
		CamelDataWrapper* _tmp9_;
		_tmp7_ = html;
		_tmp8_ = stream_filter;
		camel_data_wrapper_construct_from_stream_sync (_tmp7_, (CamelStream*) _tmp8_, NULL, &_inner_error0_);
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			goto __catch0_g_error;
		}
		_tmp9_ = html;
		camel_data_wrapper_set_mime_type (_tmp9_, "text/html; charset=utf-8");
	}
	goto __finally0;
	__catch0_g_error:
	{
		GError* e = NULL;
		GError* _tmp10_;
		const gchar* _tmp11_;
		e = _inner_error0_;
		_inner_error0_ = NULL;
		_tmp10_ = e;
		_tmp11_ = _tmp10_->message;
		g_warning ("ComposerWidget.vala:805: Error constructing html from stream: %s", _tmp11_);
		_g_error_free0 (e);
	}
	__finally0:
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
		_g_object_unref0 (html);
		_g_object_unref0 (stream_filter);
		_g_object_unref0 (stream_mem);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
		g_clear_error (&_inner_error0_);
		return NULL;
	}
	_tmp12_ = camel_mime_part_new ();
	part = _tmp12_;
	_tmp13_ = part;
	_tmp14_ = html;
	camel_medium_set_content ((CamelMedium*) _tmp13_, _tmp14_);
	_tmp15_ = part;
	camel_mime_part_set_encoding (_tmp15_, CAMEL_TRANSFER_ENCODING_QUOTEDPRINTABLE);
	_tmp16_ = camel_multipart_new ();
	body = _tmp16_;
	_tmp17_ = body;
	camel_data_wrapper_set_mime_type ((CamelDataWrapper*) _tmp17_, "multipart/alternative");
	_tmp18_ = body;
	camel_multipart_set_boundary (_tmp18_, NULL);
	_tmp19_ = body;
	_tmp20_ = part;
	camel_multipart_add_part (_tmp19_, _tmp20_);
	_tmp21_ = self->priv->attachment_box;
	_tmp22_ = gtk_container_get_children ((GtkContainer*) _tmp21_);
	_tmp23_ = _tmp22_;
	_tmp24_ = g_list_length (_tmp23_) > ((guint) 0);
	(_tmp23_ == NULL) ? NULL : (_tmp23_ = (g_list_free (_tmp23_), NULL));
	if (_tmp24_) {
		GtkFlowBox* _tmp25_;
		GList* _tmp26_;
		_tmp25_ = self->priv->attachment_box;
		_tmp26_ = gtk_container_get_children ((GtkContainer*) _tmp25_);
		{
			GList* attachment_collection = NULL;
			GList* attachment_it = NULL;
			attachment_collection = _tmp26_;
			for (attachment_it = attachment_collection; attachment_it != NULL; attachment_it = attachment_it->next) {
				GtkWidget* attachment = NULL;
				attachment = (GtkWidget*) attachment_it->data;
				{
					GtkWidget* _tmp27_;
					MailComposerWidgetAttachment* attachment_obj = NULL;
					GtkWidget* _tmp28_;
					CamelMultipart* _tmp29_;
					MailComposerWidgetAttachment* _tmp30_;
					CamelMimePart* _tmp31_;
					CamelMimePart* _tmp32_;
					_tmp27_ = attachment;
					if (!MAIL_COMPOSER_WIDGET_IS_ATTACHMENT (_tmp27_)) {
						continue;
					}
					_tmp28_ = attachment;
					attachment_obj = G_TYPE_CHECK_INSTANCE_CAST (_tmp28_, MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, MailComposerWidgetAttachment);
					_tmp29_ = body;
					_tmp30_ = attachment_obj;
					_tmp31_ = mail_composer_widget_attachment_get_mime_part (_tmp30_);
					_tmp32_ = _tmp31_;
					camel_multipart_add_part (_tmp29_, _tmp32_);
					_g_object_unref0 (_tmp32_);
				}
			}
			(attachment_collection == NULL) ? NULL : (attachment_collection = (g_list_free (attachment_collection), NULL));
		}
	}
	_tmp33_ = camel_mime_message_new ();
	message = _tmp33_;
	_tmp34_ = self->priv->subject_val;
	_tmp35_ = gtk_entry_get_text (_tmp34_);
	_tmp36_ = _tmp35_;
	camel_mime_message_set_subject (message, _tmp36_);
	camel_mime_message_set_date (message, (glong) CAMEL_MESSAGE_DATE_CURRENT, 0);
	_tmp37_ = body;
	camel_medium_set_content ((CamelMedium*) message, (CamelDataWrapper*) _tmp37_);
	result = message;
	_g_object_unref0 (body);
	_g_object_unref0 (part);
	_g_object_unref0 (html);
	_g_object_unref0 (stream_filter);
	_g_object_unref0 (stream_mem);
	return result;
}

static void
mail_composer_widget_load_from_combobox (MailComposerWidget* self)
{
	MailBackendSession* session = NULL;
	MailBackendSession* _tmp0_;
	GtkComboBoxText* _tmp12_;
	g_return_if_fail (self != NULL);
	_tmp0_ = mail_backend_session_get_default ();
	session = _tmp0_;
	{
		GeeArrayList* _address_list = NULL;
		MailBackendSession* _tmp1_;
		GeeArrayList* _tmp2_;
		gint _address_size = 0;
		GeeArrayList* _tmp3_;
		gint _tmp4_;
		gint _tmp5_;
		gint _address_index = 0;
		_tmp1_ = session;
		_tmp2_ = mail_backend_session_get_own_addresses (_tmp1_);
		_address_list = _tmp2_;
		_tmp3_ = _address_list;
		_tmp4_ = gee_abstract_collection_get_size ((GeeAbstractCollection*) _tmp3_);
		_tmp5_ = _tmp4_;
		_address_size = _tmp5_;
		_address_index = -1;
		while (TRUE) {
			gint _tmp6_;
			gint _tmp7_;
			gchar* address = NULL;
			GeeArrayList* _tmp8_;
			gpointer _tmp9_;
			GtkComboBoxText* _tmp10_;
			const gchar* _tmp11_;
			_address_index = _address_index + 1;
			_tmp6_ = _address_index;
			_tmp7_ = _address_size;
			if (!(_tmp6_ < _tmp7_)) {
				break;
			}
			_tmp8_ = _address_list;
			_tmp9_ = gee_abstract_list_get ((GeeAbstractList*) _tmp8_, _address_index);
			address = (gchar*) _tmp9_;
			_tmp10_ = self->priv->from_combo;
			_tmp11_ = address;
			gtk_combo_box_text_append_text (_tmp10_, _tmp11_);
			_g_free0 (address);
		}
		_g_object_unref0 (_address_list);
	}
	_tmp12_ = self->priv->from_combo;
	gtk_combo_box_set_active ((GtkComboBox*) _tmp12_, 0);
}

static Block17Data*
block17_data_ref (Block17Data* _data17_)
{
	g_atomic_int_inc (&_data17_->_ref_count_);
	return _data17_;
}

static void
block17_data_unref (void * _userdata_)
{
	Block17Data* _data17_;
	_data17_ = (Block17Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data17_->_ref_count_)) {
		MailComposerWidget* self;
		self = _data17_->self;
		_g_object_unref0 (self);
		g_slice_free (Block17Data, _data17_);
	}
}

static void
___lambda63_ (Block17Data* _data17_,
              GObject* obj,
              GAsyncResult* res)
{
	MailComposerWidget* self;
	GError* _inner_error0_ = NULL;
	self = _data17_->self;
	g_return_if_fail (res != NULL);
	{
		MailBackendSession* _tmp0_;
		_tmp0_ = _data17_->session;
		mail_backend_session_save_draft_finish (_tmp0_, res, &_inner_error0_);
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			goto __catch0_g_error;
		}
		GTK_WIDGET_CLASS (mail_composer_widget_parent_class)->destroy ((GtkWidget*) G_TYPE_CHECK_INSTANCE_CAST (self, gtk_grid_get_type (), GtkGrid));
	}
	goto __finally0;
	__catch0_g_error:
	{
		GError* e = NULL;
		MailMainWindow* main_window = NULL;
		GList* windows = NULL;
		GList* _tmp1_;
		GList* _tmp2_;
		MailMainWindow* _tmp5_;
		GraniteMessageDialog* error_dialog = NULL;
		GThemedIcon* _tmp9_;
		GThemedIcon* _tmp10_;
		GThemedIcon* _tmp11_;
		GraniteMessageDialog* _tmp12_ = NULL;
		GraniteMessageDialog* _tmp13_;
		GraniteMessageDialog* _tmp14_;
		GError* _tmp15_;
		const gchar* _tmp16_;
		GraniteMessageDialog* _tmp17_;
		GraniteMessageDialog* _tmp18_;
		e = _inner_error0_;
		_inner_error0_ = NULL;
		main_window = NULL;
		_tmp1_ = gtk_window_list_toplevels ();
		windows = _tmp1_;
		_tmp2_ = windows;
		{
			GList* window_collection = NULL;
			GList* window_it = NULL;
			window_collection = _tmp2_;
			for (window_it = window_collection; window_it != NULL; window_it = window_it->next) {
				GtkWindow* window = NULL;
				window = (GtkWindow*) window_it->data;
				{
					GtkWindow* _tmp3_;
					_tmp3_ = window;
					if (MAIL_IS_MAIN_WINDOW (_tmp3_)) {
						GtkWindow* _tmp4_;
						_tmp4_ = window;
						main_window = G_TYPE_CHECK_INSTANCE_CAST (_tmp4_, MAIL_TYPE_MAIN_WINDOW, MailMainWindow);
						break;
					}
				}
			}
		}
		_tmp5_ = main_window;
		if (_tmp5_ != NULL) {
			MailMainWindow* _tmp6_;
			MailComposerWindow* _tmp7_;
			MailComposerWindow* _tmp8_;
			_tmp6_ = main_window;
			_tmp7_ = mail_composer_window_new_for_widget ((GtkWindow*) _tmp6_, self);
			g_object_ref_sink (_tmp7_);
			_tmp8_ = _tmp7_;
			gtk_widget_show_all ((GtkWidget*) _tmp8_);
			_g_object_unref0 (_tmp8_);
		} else {
			g_warning ("ComposerWidget.vala:996: Unable to re-show composer. Draft will be los" \
"t.");
		}
		_tmp9_ = (GThemedIcon*) g_themed_icon_new ("mail-drafts");
		_tmp10_ = _tmp9_;
		_tmp11_ = (GThemedIcon*) g_themed_icon_new ("dialog-error");
		_tmp12_ = granite_message_dialog_new (_ ("Unable to save draft"), _ ("There was an unexpected error while saving your draft."), (GIcon*) _tmp10_, GTK_BUTTONS_CLOSE);
		granite_message_dialog_set_badge_icon (_tmp12_, (GIcon*) _tmp11_);
		_g_object_unref0 (_tmp11_);
		g_object_ref_sink (_tmp12_);
		_tmp13_ = _tmp12_;
		_g_object_unref0 (_tmp10_);
		error_dialog = _tmp13_;
		_tmp14_ = error_dialog;
		_tmp15_ = e;
		_tmp16_ = _tmp15_->message;
		granite_message_dialog_show_error_details (_tmp14_, _tmp16_);
		_tmp17_ = error_dialog;
		gtk_dialog_run ((GtkDialog*) _tmp17_);
		_tmp18_ = error_dialog;
		gtk_widget_destroy ((GtkWidget*) _tmp18_);
		_g_object_unref0 (error_dialog);
		(windows == NULL) ? NULL : (windows = (g_list_free (windows), NULL));
		_g_error_free0 (e);
	}
	__finally0:
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
		g_clear_error (&_inner_error0_);
		return;
	}
}

static void
____lambda63__gasync_ready_callback (GObject* source_object,
                                     GAsyncResult* res,
                                     gpointer self)
{
	___lambda63_ (self, source_object, res);
	block17_data_unref (self);
}

static void
__lambda62_ (MailComposerWidget* self,
             GObject* obj,
             GAsyncResult* res)
{
	gchar* body_html = NULL;
	MailWebView* _tmp0_;
	gchar* _tmp1_;
	const gchar* _tmp2_;
	g_return_if_fail (res != NULL);
	_tmp0_ = self->priv->web_view;
	_tmp1_ = mail_web_view_get_body_html_finish (_tmp0_, res);
	body_html = _tmp1_;
	_tmp2_ = body_html;
	if (_tmp2_ == NULL) {
		GTK_WIDGET_CLASS (mail_composer_widget_parent_class)->destroy ((GtkWidget*) G_TYPE_CHECK_INSTANCE_CAST (self, gtk_grid_get_type (), GtkGrid));
	} else {
		Block17Data* _data17_;
		MailBackendSession* _tmp3_;
		CamelMimeMessage* message = NULL;
		const gchar* _tmp4_;
		CamelMimeMessage* _tmp5_;
		CamelInternetAddress* sender = NULL;
		CamelMimeMessage* _tmp6_;
		GtkComboBoxText* _tmp7_;
		gchar* _tmp8_;
		gchar* _tmp9_;
		CamelInternetAddress* _tmp10_;
		CamelInternetAddress* _tmp11_;
		CamelInternetAddress* recipients = NULL;
		CamelMimeMessage* _tmp12_;
		GtkEntry* _tmp13_;
		const gchar* _tmp14_;
		const gchar* _tmp15_;
		GtkEntry* _tmp16_;
		const gchar* _tmp17_;
		const gchar* _tmp18_;
		GtkEntry* _tmp19_;
		const gchar* _tmp20_;
		const gchar* _tmp21_;
		CamelInternetAddress* _tmp22_;
		MailBackendSession* _tmp23_;
		CamelMimeMessage* _tmp24_;
		CamelInternetAddress* _tmp25_;
		CamelInternetAddress* _tmp26_;
		CamelMessageInfo* _tmp27_;
		_data17_ = g_slice_new0 (Block17Data);
		_data17_->_ref_count_ = 1;
		_data17_->self = g_object_ref (self);
		_tmp3_ = mail_backend_session_get_default ();
		_data17_->session = _tmp3_;
		_tmp4_ = body_html;
		_tmp5_ = mail_composer_widget_build_message (self, _tmp4_);
		message = _tmp5_;
		_tmp6_ = message;
		_tmp7_ = self->priv->from_combo;
		_tmp8_ = gtk_combo_box_text_get_active_text (_tmp7_);
		_tmp9_ = _tmp8_;
		_tmp10_ = mail_composer_widget_build_sender (self, _tmp6_, _tmp9_);
		_tmp11_ = _tmp10_;
		_g_free0 (_tmp9_);
		sender = _tmp11_;
		_tmp12_ = message;
		_tmp13_ = self->priv->to_val;
		_tmp14_ = gtk_entry_get_text (_tmp13_);
		_tmp15_ = _tmp14_;
		_tmp16_ = self->priv->cc_val;
		_tmp17_ = gtk_entry_get_text (_tmp16_);
		_tmp18_ = _tmp17_;
		_tmp19_ = self->priv->bcc_val;
		_tmp20_ = gtk_entry_get_text (_tmp19_);
		_tmp21_ = _tmp20_;
		_tmp22_ = mail_composer_widget_build_recipients (self, _tmp12_, _tmp15_, _tmp18_, _tmp21_);
		recipients = _tmp22_;
		_tmp23_ = _data17_->session;
		_tmp24_ = message;
		_tmp25_ = sender;
		_tmp26_ = recipients;
		_tmp27_ = self->priv->ancestor_message_info;
		mail_backend_session_save_draft (_tmp23_, _tmp24_, _tmp25_, (CamelAddress*) _tmp26_, _tmp27_, ____lambda63__gasync_ready_callback, block17_data_ref (_data17_));
		_g_object_unref0 (recipients);
		_g_object_unref0 (sender);
		_g_object_unref0 (message);
		block17_data_unref (_data17_);
		_data17_ = NULL;
	}
	_g_free0 (body_html);
}

static void
___lambda62__gasync_ready_callback (GObject* source_object,
                                    GAsyncResult* res,
                                    gpointer self)
{
	__lambda62_ ((MailComposerWidget*) self, source_object, res);
	g_object_unref (self);
}

static void
mail_composer_widget_real_destroy (GtkWidget* base)
{
	MailComposerWidget * self;
	gboolean _tmp0_ = FALSE;
	MailWebView* _tmp4_;
	self = (MailComposerWidget*) base;
	if (self->priv->discard_draft) {
		_tmp0_ = TRUE;
	} else {
		MailWebView* _tmp1_;
		gboolean _tmp2_;
		gboolean _tmp3_;
		_tmp1_ = self->priv->web_view;
		_tmp2_ = mail_web_view_get_body_html_changed (_tmp1_);
		_tmp3_ = _tmp2_;
		_tmp0_ = !_tmp3_;
	}
	if (_tmp0_) {
		GTK_WIDGET_CLASS (mail_composer_widget_parent_class)->destroy ((GtkWidget*) G_TYPE_CHECK_INSTANCE_CAST (self, gtk_grid_get_type (), GtkGrid));
		return;
	}
	_tmp4_ = self->priv->web_view;
	mail_web_view_get_body_html (_tmp4_, ___lambda62__gasync_ready_callback, g_object_ref (self));
}

MailComposerWidget*
mail_composer_widget_construct (GType object_type)
{
	MailComposerWidget * self = NULL;
	self = (MailComposerWidget*) g_object_new (object_type, NULL);
	return self;
}

MailComposerWidget*
mail_composer_widget_new (void)
{
	return mail_composer_widget_construct (MAIL_TYPE_COMPOSER_WIDGET);
}

gboolean
mail_composer_widget_get_has_recipients (MailComposerWidget* self)
{
	gboolean result;
	g_return_val_if_fail (self != NULL, FALSE);
	result = self->priv->_has_recipients;
	return result;
}

void
mail_composer_widget_set_has_recipients (MailComposerWidget* self,
                                         gboolean value)
{
	gboolean old_value;
	g_return_if_fail (self != NULL);
	old_value = mail_composer_widget_get_has_recipients (self);
	if (old_value != value) {
		self->priv->_has_recipients = value;
		g_object_notify_by_pspec ((GObject *) self, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_HAS_RECIPIENTS_PROPERTY]);
	}
}

gboolean
mail_composer_widget_get_has_subject_field (MailComposerWidget* self)
{
	gboolean result;
	g_return_val_if_fail (self != NULL, FALSE);
	result = self->priv->_has_subject_field;
	return result;
}

static void
mail_composer_widget_set_has_subject_field (MailComposerWidget* self,
                                            gboolean value)
{
	gboolean old_value;
	g_return_if_fail (self != NULL);
	old_value = mail_composer_widget_get_has_subject_field (self);
	if (old_value != value) {
		self->priv->_has_subject_field = value;
		g_object_notify_by_pspec ((GObject *) self, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_HAS_SUBJECT_FIELD_PROPERTY]);
	}
}

gboolean
mail_composer_widget_get_can_change_sender (MailComposerWidget* self)
{
	gboolean result;
	g_return_val_if_fail (self != NULL, FALSE);
	result = self->priv->_can_change_sender;
	return result;
}

static void
mail_composer_widget_set_can_change_sender (MailComposerWidget* self,
                                            gboolean value)
{
	gboolean old_value;
	g_return_if_fail (self != NULL);
	old_value = mail_composer_widget_get_can_change_sender (self);
	if (old_value != value) {
		self->priv->_can_change_sender = value;
		g_object_notify_by_pspec ((GObject *) self, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_CAN_CHANGE_SENDER_PROPERTY]);
	}
}

const gchar*
mail_composer_widget_get_to (MailComposerWidget* self)
{
	const gchar* result;
	const gchar* _tmp0_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_to;
	result = _tmp0_;
	return result;
}

static void
mail_composer_widget_set_to (MailComposerWidget* self,
                             const gchar* value)
{
	gchar* old_value;
	g_return_if_fail (self != NULL);
	old_value = mail_composer_widget_get_to (self);
	if (g_strcmp0 (value, old_value) != 0) {
		gchar* _tmp0_;
		_tmp0_ = g_strdup (value);
		_g_free0 (self->priv->_to);
		self->priv->_to = _tmp0_;
		g_object_notify_by_pspec ((GObject *) self, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_TO_PROPERTY]);
	}
}

const gchar*
mail_composer_widget_get_mailto_query (MailComposerWidget* self)
{
	const gchar* result;
	const gchar* _tmp0_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_mailto_query;
	result = _tmp0_;
	return result;
}

static void
mail_composer_widget_set_mailto_query (MailComposerWidget* self,
                                       const gchar* value)
{
	gchar* old_value;
	g_return_if_fail (self != NULL);
	old_value = mail_composer_widget_get_mailto_query (self);
	if (g_strcmp0 (value, old_value) != 0) {
		gchar* _tmp0_;
		_tmp0_ = g_strdup (value);
		_g_free0 (self->priv->_mailto_query);
		self->priv->_mailto_query = _tmp0_;
		g_object_notify_by_pspec ((GObject *) self, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_MAILTO_QUERY_PROPERTY]);
	}
}

static inline gpointer
mail_composer_widget_attachment_get_instance_private (MailComposerWidgetAttachment* self)
{
	return G_STRUCT_MEMBER_P (self, MailComposerWidgetAttachment_private_offset);
}

static MailComposerWidgetAttachment*
mail_composer_widget_attachment_construct (GType object_type,
                                           GFile* file)
{
	MailComposerWidgetAttachment * self = NULL;
	g_return_val_if_fail (file != NULL, NULL);
	self = (MailComposerWidgetAttachment*) g_object_new (object_type, "file", file, NULL);
	return self;
}

static MailComposerWidgetAttachment*
mail_composer_widget_attachment_new (GFile* file)
{
	return mail_composer_widget_attachment_construct (MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, file);
}

static CamelMimePart*
mail_composer_widget_attachment_get_mime_part (MailComposerWidgetAttachment* self)
{
	GFileInfo* _tmp0_;
	const gchar* content_type = NULL;
	GFileInfo* _tmp1_;
	const gchar* _tmp2_;
	gchar* mime_type = NULL;
	const gchar* _tmp3_;
	gchar* _tmp4_;
	CamelDataWrapper* wrapper = NULL;
	CamelDataWrapper* _tmp5_;
	CamelDataWrapper* _tmp12_;
	const gchar* _tmp13_;
	CamelMimePart* mimepart = NULL;
	CamelMimePart* _tmp14_;
	CamelMimePart* _tmp15_;
	CamelMimePart* _tmp16_;
	GFileInfo* _tmp17_;
	const gchar* _tmp18_;
	CamelMimePart* _tmp19_;
	CamelDataWrapper* _tmp20_;
	CamelMimePart* _tmp21_;
	CamelContentType* _tmp22_;
	GError* _inner_error0_ = NULL;
	CamelMimePart* result;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_info;
	if (_tmp0_ == NULL) {
		result = NULL;
		return result;
	}
	_tmp1_ = self->priv->_info;
	_tmp2_ = g_file_info_get_content_type (_tmp1_);
	content_type = _tmp2_;
	_tmp3_ = content_type;
	_tmp4_ = g_content_type_get_mime_type (_tmp3_);
	mime_type = _tmp4_;
	_tmp5_ = camel_data_wrapper_new ();
	wrapper = _tmp5_;
	{
		GFileInputStream* _tmp6_ = NULL;
		GFile* _tmp7_;
		GFileInputStream* _tmp8_;
		CamelDataWrapper* _tmp9_;
		_tmp7_ = self->priv->_file;
		_tmp8_ = g_file_read (_tmp7_, NULL, &_inner_error0_);
		_tmp6_ = _tmp8_;
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			goto __catch0_g_error;
		}
		_tmp9_ = wrapper;
		camel_data_wrapper_construct_from_input_stream_sync (_tmp9_, (GInputStream*) _tmp6_, NULL, &_inner_error0_);
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			_g_object_unref0 (_tmp6_);
			goto __catch0_g_error;
		}
		_g_object_unref0 (_tmp6_);
	}
	goto __finally0;
	__catch0_g_error:
	{
		GError* e = NULL;
		GError* _tmp10_;
		const gchar* _tmp11_;
		e = _inner_error0_;
		_inner_error0_ = NULL;
		_tmp10_ = e;
		_tmp11_ = _tmp10_->message;
		g_warning ("ComposerWidget.vala:915: Error constructing wrapper for attachment: %s", _tmp11_);
		result = NULL;
		_g_error_free0 (e);
		_g_object_unref0 (wrapper);
		_g_free0 (mime_type);
		return result;
	}
	__finally0:
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
		_g_object_unref0 (wrapper);
		_g_free0 (mime_type);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
		g_clear_error (&_inner_error0_);
		return NULL;
	}
	_tmp12_ = wrapper;
	_tmp13_ = mime_type;
	camel_data_wrapper_set_mime_type (_tmp12_, _tmp13_);
	_tmp14_ = camel_mime_part_new ();
	mimepart = _tmp14_;
	_tmp15_ = mimepart;
	camel_mime_part_set_disposition (_tmp15_, "attachment");
	_tmp16_ = mimepart;
	_tmp17_ = self->priv->_info;
	_tmp18_ = g_file_info_get_display_name (_tmp17_);
	camel_mime_part_set_filename (_tmp16_, _tmp18_);
	_tmp19_ = mimepart;
	_tmp20_ = wrapper;
	camel_medium_set_content (G_TYPE_CHECK_INSTANCE_CAST (_tmp19_, camel_medium_get_type (), CamelMedium), _tmp20_);
	_tmp21_ = mimepart;
	_tmp22_ = camel_mime_part_get_content_type (_tmp21_);
	if (camel_content_type_is (_tmp22_, "text", "*")) {
		CamelStreamNull* stream = NULL;
		CamelStreamNull* _tmp23_;
		CamelStreamFilter* filtered_stream = NULL;
		CamelStreamNull* _tmp24_;
		CamelStreamFilter* _tmp25_;
		CamelMimeFilterBestenc* filter = NULL;
		CamelMimeFilterBestenc* _tmp26_;
		CamelStreamFilter* _tmp27_;
		CamelMimeFilterBestenc* _tmp28_;
		_tmp23_ = (CamelStreamNull*) camel_stream_null_new ();
		stream = _tmp23_;
		_tmp24_ = stream;
		_tmp25_ = (CamelStreamFilter*) camel_stream_filter_new ((CamelStream*) _tmp24_);
		filtered_stream = _tmp25_;
		_tmp26_ = (CamelMimeFilterBestenc*) camel_mime_filter_bestenc_new ((guint) CAMEL_BESTENC_GET_ENCODING);
		filter = _tmp26_;
		_tmp27_ = filtered_stream;
		_tmp28_ = filter;
		camel_stream_filter_add (_tmp27_, (CamelMimeFilter*) _tmp28_);
		{
			CamelDataWrapper* _tmp29_;
			CamelStreamFilter* _tmp30_;
			CamelTransferEncoding encoding = 0;
			CamelMimeFilterBestenc* _tmp31_;
			CamelMimePart* _tmp32_;
			_tmp29_ = wrapper;
			_tmp30_ = filtered_stream;
			camel_data_wrapper_decode_to_stream_sync (_tmp29_, (CamelStream*) _tmp30_, NULL, &_inner_error0_);
			if (G_UNLIKELY (_inner_error0_ != NULL)) {
				goto __catch1_g_error;
			}
			_tmp31_ = filter;
			encoding = camel_mime_filter_bestenc_get_best_encoding (_tmp31_, CAMEL_BESTENC_8BIT);
			_tmp32_ = mimepart;
			camel_mime_part_set_encoding (_tmp32_, encoding);
		}
		goto __finally1;
		__catch1_g_error:
		{
			GError* e = NULL;
			GError* _tmp33_;
			const gchar* _tmp34_;
			e = _inner_error0_;
			_inner_error0_ = NULL;
			_tmp33_ = e;
			_tmp34_ = _tmp33_->message;
			g_warning ("ComposerWidget.vala:939: Unable to determine best encoding for attachm" \
"ent: %s", _tmp34_);
			_g_error_free0 (e);
		}
		__finally1:
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			_g_object_unref0 (filter);
			_g_object_unref0 (filtered_stream);
			_g_object_unref0 (stream);
			_g_object_unref0 (mimepart);
			_g_object_unref0 (wrapper);
			_g_free0 (mime_type);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
			g_clear_error (&_inner_error0_);
			return NULL;
		}
		_g_object_unref0 (filter);
		_g_object_unref0 (filtered_stream);
		_g_object_unref0 (stream);
	} else {
		CamelMimePart* _tmp35_;
		_tmp35_ = mimepart;
		camel_mime_part_set_encoding (_tmp35_, CAMEL_TRANSFER_ENCODING_BASE64);
	}
	result = mimepart;
	_g_object_unref0 (wrapper);
	_g_free0 (mime_type);
	return result;
}

static GFileInfo*
mail_composer_widget_attachment_get_info (MailComposerWidgetAttachment* self)
{
	GFileInfo* result;
	GFileInfo* _tmp0_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_info;
	result = _tmp0_;
	return result;
}

static void
mail_composer_widget_attachment_set_info (MailComposerWidgetAttachment* self,
                                          GFileInfo* value)
{
	GFileInfo* old_value;
	g_return_if_fail (self != NULL);
	old_value = mail_composer_widget_attachment_get_info (self);
	if (old_value != value) {
		GFileInfo* _tmp0_;
		_tmp0_ = _g_object_ref0 (value);
		_g_object_unref0 (self->priv->_info);
		self->priv->_info = _tmp0_;
		g_object_notify_by_pspec ((GObject *) self, mail_composer_widget_attachment_properties[MAIL_COMPOSER_WIDGET_ATTACHMENT_INFO_PROPERTY]);
	}
}

static GFile*
mail_composer_widget_attachment_get_file (MailComposerWidgetAttachment* self)
{
	GFile* result;
	GFile* _tmp0_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_file;
	result = _tmp0_;
	return result;
}

static void
mail_composer_widget_attachment_set_file (MailComposerWidgetAttachment* self,
                                          GFile* value)
{
	GFile* old_value;
	g_return_if_fail (self != NULL);
	old_value = mail_composer_widget_attachment_get_file (self);
	if (old_value != value) {
		GFile* _tmp0_;
		_tmp0_ = _g_object_ref0 (value);
		_g_object_unref0 (self->priv->_file);
		self->priv->_file = _tmp0_;
		g_object_notify_by_pspec ((GObject *) self, mail_composer_widget_attachment_properties[MAIL_COMPOSER_WIDGET_ATTACHMENT_FILE_PROPERTY]);
	}
}

static void
_mail_composer_widget_attachment___lambda51_ (MailComposerWidgetAttachment* self)
{
	gtk_widget_destroy ((GtkWidget*) self);
}

static void
__mail_composer_widget_attachment___lambda51__gtk_button_clicked (GtkButton* _sender,
                                                                  gpointer self)
{
	_mail_composer_widget_attachment___lambda51_ ((MailComposerWidgetAttachment*) self);
}

static GObject *
mail_composer_widget_attachment_constructor (GType type,
                                             guint n_construct_properties,
                                             GObjectConstructParam * construct_properties)
{
	GObject * obj;
	GObjectClass * parent_class;
	MailComposerWidgetAttachment * self;
	static const char QUERY_STRING[] = G_FILE_ATTRIBUTE_STANDARD_CONTENT_TYPE "," G_FILE_ATTRIBUTE_STANDARD_DISPLAY_NAME "," G_FILE_ATTRIBUTE_STANDARD_ICON "," G_FILE_ATTRIBUTE_STANDARD_SIZE;
	GtkImage* image = NULL;
	GFileInfo* _tmp5_;
	GIcon* _tmp6_;
	GIcon* _tmp7_;
	GtkImage* _tmp8_ = NULL;
	GtkLabel* name_label = NULL;
	GFileInfo* _tmp9_;
	const gchar* _tmp10_;
	GtkLabel* _tmp11_ = NULL;
	GtkLabel* size_label = NULL;
	GFileInfo* _tmp12_;
	gchar* _tmp13_;
	gchar* _tmp14_;
	gchar* _tmp15_;
	gchar* _tmp16_;
	GtkLabel* _tmp17_;
	GtkLabel* _tmp18_;
	GtkLabel* _tmp19_;
	GtkStyleContext* _tmp20_;
	GtkButton* remove_button = NULL;
	GtkButton* _tmp21_;
	GtkStyleContext* remove_button_context = NULL;
	GtkButton* _tmp22_;
	GtkStyleContext* _tmp23_;
	GtkStyleContext* _tmp24_;
	GtkStyleContext* _tmp25_;
	GtkGrid* grid = NULL;
	GtkGrid* _tmp26_ = NULL;
	GtkGrid* _tmp27_;
	GtkImage* _tmp28_;
	GtkGrid* _tmp29_;
	GtkLabel* _tmp30_;
	GtkGrid* _tmp31_;
	GtkLabel* _tmp32_;
	GtkGrid* _tmp33_;
	GtkButton* _tmp34_;
	GtkGrid* _tmp35_;
	GtkButton* _tmp36_;
	GError* _inner_error0_ = NULL;
	parent_class = G_OBJECT_CLASS (mail_composer_widget_attachment_parent_class);
	obj = parent_class->constructor (type, n_construct_properties, construct_properties);
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, MailComposerWidgetAttachment);
	{
		GFileInfo* _tmp0_ = NULL;
		GFile* _tmp1_;
		GFileInfo* _tmp2_;
		_tmp1_ = self->priv->_file;
		_tmp2_ = g_file_query_info (_tmp1_, QUERY_STRING, G_FILE_QUERY_INFO_NONE, NULL, &_inner_error0_);
		_tmp0_ = _tmp2_;
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			goto __catch0_g_error;
		}
		mail_composer_widget_attachment_set_info (self, _tmp0_);
		_g_object_unref0 (_tmp0_);
	}
	goto __finally0;
	__catch0_g_error:
	{
		GError* e = NULL;
		GError* _tmp3_;
		const gchar* _tmp4_;
		e = _inner_error0_;
		_inner_error0_ = NULL;
		_tmp3_ = e;
		_tmp4_ = _tmp3_->message;
		g_warning ("ComposerWidget.vala:865: Error querying attachment file attributes: %s", _tmp4_);
		_g_error_free0 (e);
	}
	__finally0:
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
		g_clear_error (&_inner_error0_);
	}
	_tmp5_ = self->priv->_info;
	_tmp6_ = g_file_info_get_icon (_tmp5_);
	_tmp7_ = _g_object_ref0 (_tmp6_);
	_tmp8_ = (GtkImage*) gtk_image_new ();
	g_object_set (_tmp8_, "gicon", _tmp7_, NULL);
	_g_object_unref0 (_tmp7_);
	gtk_image_set_pixel_size (_tmp8_, 24);
	g_object_ref_sink (_tmp8_);
	image = _tmp8_;
	_tmp9_ = self->priv->_info;
	_tmp10_ = g_file_info_get_display_name (_tmp9_);
	_tmp11_ = (GtkLabel*) gtk_label_new (_tmp10_);
	gtk_widget_set_hexpand ((GtkWidget*) _tmp11_, TRUE);
	gtk_label_set_xalign (_tmp11_, (gfloat) 0);
	g_object_ref_sink (_tmp11_);
	name_label = _tmp11_;
	_tmp12_ = self->priv->_info;
	_tmp13_ = g_format_size_full ((guint64) g_file_info_get_size (_tmp12_), G_FORMAT_SIZE_DEFAULT);
	_tmp14_ = _tmp13_;
	_tmp15_ = g_strdup_printf ("(%s)", _tmp14_);
	_tmp16_ = _tmp15_;
	_tmp17_ = (GtkLabel*) gtk_label_new (_tmp16_);
	g_object_ref_sink (_tmp17_);
	_tmp18_ = _tmp17_;
	_g_free0 (_tmp16_);
	_g_free0 (_tmp14_);
	size_label = _tmp18_;
	_tmp19_ = size_label;
	_tmp20_ = gtk_widget_get_style_context ((GtkWidget*) _tmp19_);
	gtk_style_context_add_class (_tmp20_, GTK_STYLE_CLASS_DIM_LABEL);
	_tmp21_ = (GtkButton*) gtk_button_new_from_icon_name ("process-stop-symbolic", (GtkIconSize) GTK_ICON_SIZE_SMALL_TOOLBAR);
	g_object_ref_sink (_tmp21_);
	remove_button = _tmp21_;
	_tmp22_ = remove_button;
	_tmp23_ = gtk_widget_get_style_context ((GtkWidget*) _tmp22_);
	remove_button_context = _tmp23_;
	_tmp24_ = remove_button_context;
	gtk_style_context_add_class (_tmp24_, GTK_STYLE_CLASS_FLAT);
	_tmp25_ = remove_button_context;
	gtk_style_context_add_class (_tmp25_, GTK_STYLE_CLASS_DESTRUCTIVE_ACTION);
	_tmp26_ = (GtkGrid*) gtk_grid_new ();
	gtk_grid_set_column_spacing (_tmp26_, 3);
	g_object_set ((GtkWidget*) _tmp26_, "margin", 3, NULL);
	g_object_ref_sink (_tmp26_);
	grid = _tmp26_;
	_tmp27_ = grid;
	_tmp28_ = image;
	gtk_container_add ((GtkContainer*) _tmp27_, (GtkWidget*) _tmp28_);
	_tmp29_ = grid;
	_tmp30_ = name_label;
	gtk_container_add ((GtkContainer*) _tmp29_, (GtkWidget*) _tmp30_);
	_tmp31_ = grid;
	_tmp32_ = size_label;
	gtk_container_add ((GtkContainer*) _tmp31_, (GtkWidget*) _tmp32_);
	_tmp33_ = grid;
	_tmp34_ = remove_button;
	gtk_container_add ((GtkContainer*) _tmp33_, (GtkWidget*) _tmp34_);
	_tmp35_ = grid;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) _tmp35_);
	_tmp36_ = remove_button;
	g_signal_connect_object (_tmp36_, "clicked", (GCallback) __mail_composer_widget_attachment___lambda51__gtk_button_clicked, self, 0);
	_g_object_unref0 (grid);
	_g_object_unref0 (remove_button);
	_g_object_unref0 (size_label);
	_g_object_unref0 (name_label);
	_g_object_unref0 (image);
	return obj;
}

static void
mail_composer_widget_attachment_class_init (MailComposerWidgetAttachmentClass * klass,
                                            gpointer klass_data)
{
	mail_composer_widget_attachment_parent_class = g_type_class_peek_parent (klass);
	g_type_class_adjust_private_offset (klass, &MailComposerWidgetAttachment_private_offset);
	G_OBJECT_CLASS (klass)->get_property = _vala_mail_composer_widget_attachment_get_property;
	G_OBJECT_CLASS (klass)->set_property = _vala_mail_composer_widget_attachment_set_property;
	G_OBJECT_CLASS (klass)->constructor = mail_composer_widget_attachment_constructor;
	G_OBJECT_CLASS (klass)->finalize = mail_composer_widget_attachment_finalize;
	g_object_class_install_property (G_OBJECT_CLASS (klass), MAIL_COMPOSER_WIDGET_ATTACHMENT_INFO_PROPERTY, mail_composer_widget_attachment_properties[MAIL_COMPOSER_WIDGET_ATTACHMENT_INFO_PROPERTY] = g_param_spec_object ("info", "info", "info", g_file_info_get_type (), G_PARAM_STATIC_STRINGS | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
	g_object_class_install_property (G_OBJECT_CLASS (klass), MAIL_COMPOSER_WIDGET_ATTACHMENT_FILE_PROPERTY, mail_composer_widget_attachment_properties[MAIL_COMPOSER_WIDGET_ATTACHMENT_FILE_PROPERTY] = g_param_spec_object ("file", "file", "file", g_file_get_type (), G_PARAM_STATIC_STRINGS | G_PARAM_READABLE | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
}

static void
mail_composer_widget_attachment_instance_init (MailComposerWidgetAttachment * self,
                                               gpointer klass)
{
	self->priv = mail_composer_widget_attachment_get_instance_private (self);
}

static void
mail_composer_widget_attachment_finalize (GObject * obj)
{
	MailComposerWidgetAttachment * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, MailComposerWidgetAttachment);
	_g_object_unref0 (self->priv->_info);
	_g_object_unref0 (self->priv->_file);
	G_OBJECT_CLASS (mail_composer_widget_attachment_parent_class)->finalize (obj);
}

static GType
mail_composer_widget_attachment_get_type_once (void)
{
	static const GTypeInfo g_define_type_info = { sizeof (MailComposerWidgetAttachmentClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) mail_composer_widget_attachment_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (MailComposerWidgetAttachment), 0, (GInstanceInitFunc) mail_composer_widget_attachment_instance_init, NULL };
	GType mail_composer_widget_attachment_type_id;
	mail_composer_widget_attachment_type_id = g_type_register_static (gtk_flow_box_child_get_type (), "MailComposerWidgetAttachment", &g_define_type_info, 0);
	MailComposerWidgetAttachment_private_offset = g_type_add_instance_private (mail_composer_widget_attachment_type_id, sizeof (MailComposerWidgetAttachmentPrivate));
	return mail_composer_widget_attachment_type_id;
}

static GType
mail_composer_widget_attachment_get_type (void)
{
	static volatile gsize mail_composer_widget_attachment_type_id__once = 0;
	if (g_once_init_enter (&mail_composer_widget_attachment_type_id__once)) {
		GType mail_composer_widget_attachment_type_id;
		mail_composer_widget_attachment_type_id = mail_composer_widget_attachment_get_type_once ();
		g_once_init_leave (&mail_composer_widget_attachment_type_id__once, mail_composer_widget_attachment_type_id);
	}
	return mail_composer_widget_attachment_type_id__once;
}

static void
_vala_mail_composer_widget_attachment_get_property (GObject * object,
                                                    guint property_id,
                                                    GValue * value,
                                                    GParamSpec * pspec)
{
	MailComposerWidgetAttachment * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, MailComposerWidgetAttachment);
	switch (property_id) {
		case MAIL_COMPOSER_WIDGET_ATTACHMENT_INFO_PROPERTY:
		g_value_set_object (value, mail_composer_widget_attachment_get_info (self));
		break;
		case MAIL_COMPOSER_WIDGET_ATTACHMENT_FILE_PROPERTY:
		g_value_set_object (value, mail_composer_widget_attachment_get_file (self));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}

static void
_vala_mail_composer_widget_attachment_set_property (GObject * object,
                                                    guint property_id,
                                                    const GValue * value,
                                                    GParamSpec * pspec)
{
	MailComposerWidgetAttachment * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, MAIL_COMPOSER_WIDGET_TYPE_ATTACHMENT, MailComposerWidgetAttachment);
	switch (property_id) {
		case MAIL_COMPOSER_WIDGET_ATTACHMENT_INFO_PROPERTY:
		mail_composer_widget_attachment_set_info (self, g_value_get_object (value));
		break;
		case MAIL_COMPOSER_WIDGET_ATTACHMENT_FILE_PROPERTY:
		mail_composer_widget_attachment_set_file (self, g_value_get_object (value));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}

static MailComposerWidgetEntryGrid*
mail_composer_widget_entry_grid_construct (GType object_type)
{
	MailComposerWidgetEntryGrid * self = NULL;
	self = (MailComposerWidgetEntryGrid*) g_object_new (object_type, NULL);
	return self;
}

static MailComposerWidgetEntryGrid*
mail_composer_widget_entry_grid_new (void)
{
	return mail_composer_widget_entry_grid_construct (MAIL_COMPOSER_WIDGET_TYPE_ENTRY_GRID);
}

static void
mail_composer_widget_entry_grid_class_init (MailComposerWidgetEntryGridClass * klass,
                                            gpointer klass_data)
{
	mail_composer_widget_entry_grid_parent_class = g_type_class_peek_parent (klass);
	gtk_widget_class_set_css_name (GTK_WIDGET_CLASS (klass), GTK_STYLE_CLASS_ENTRY);
}

static void
mail_composer_widget_entry_grid_instance_init (MailComposerWidgetEntryGrid * self,
                                               gpointer klass)
{
}

static GType
mail_composer_widget_entry_grid_get_type_once (void)
{
	static const GTypeInfo g_define_type_info = { sizeof (MailComposerWidgetEntryGridClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) mail_composer_widget_entry_grid_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (MailComposerWidgetEntryGrid), 0, (GInstanceInitFunc) mail_composer_widget_entry_grid_instance_init, NULL };
	GType mail_composer_widget_entry_grid_type_id;
	mail_composer_widget_entry_grid_type_id = g_type_register_static (gtk_grid_get_type (), "MailComposerWidgetEntryGrid", &g_define_type_info, 0);
	return mail_composer_widget_entry_grid_type_id;
}

static GType
mail_composer_widget_entry_grid_get_type (void)
{
	static volatile gsize mail_composer_widget_entry_grid_type_id__once = 0;
	if (g_once_init_enter (&mail_composer_widget_entry_grid_type_id__once)) {
		GType mail_composer_widget_entry_grid_type_id;
		mail_composer_widget_entry_grid_type_id = mail_composer_widget_entry_grid_get_type_once ();
		g_once_init_leave (&mail_composer_widget_entry_grid_type_id__once, mail_composer_widget_entry_grid_type_id);
	}
	return mail_composer_widget_entry_grid_type_id__once;
}

static Block18Data*
block18_data_ref (Block18Data* _data18_)
{
	g_atomic_int_inc (&_data18_->_ref_count_);
	return _data18_;
}

static void
block18_data_unref (void * _userdata_)
{
	Block18Data* _data18_;
	_data18_ = (Block18Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data18_->_ref_count_)) {
		MailComposerWidget* self;
		self = _data18_->self;
		_g_object_unref0 (_data18_->to_grid);
		_g_object_unref0 (_data18_->bcc_button);
		_g_object_unref0 (self);
		g_slice_free (Block18Data, _data18_);
	}
}

static void
_mail_composer_widget___lambda67_ (MailComposerWidget* self)
{
	GtkEntry* _tmp0_;
	const gchar* _tmp1_;
	const gchar* _tmp2_;
	_tmp0_ = self->priv->subject_val;
	_tmp1_ = gtk_entry_get_text (_tmp0_);
	_tmp2_ = _tmp1_;
	g_signal_emit (self, mail_composer_widget_signals[MAIL_COMPOSER_WIDGET_SUBJECT_CHANGED_SIGNAL], 0, _tmp2_);
}

static void
__mail_composer_widget___lambda67__gtk_editable_changed (GtkEditable* _sender,
                                                         gpointer self)
{
	_mail_composer_widget___lambda67_ ((MailComposerWidget*) self);
}

static GVariant*
_variant_new5 (const gchar* value)
{
	return g_variant_ref_sink (g_variant_new_string (value));
}

static GVariant*
_variant_new6 (const gchar* value)
{
	return g_variant_ref_sink (g_variant_new_string (value));
}

static GVariant*
_variant_new7 (const gchar* value)
{
	return g_variant_ref_sink (g_variant_new_string (value));
}

static GVariant*
_variant_new8 (const gchar* value)
{
	return g_variant_ref_sink (g_variant_new_string (value));
}

static void
_mail_composer_widget_update_actions_mail_web_view_selection_changed (MailWebView* _sender,
                                                                      gpointer self)
{
	mail_composer_widget_update_actions ((MailComposerWidget*) self);
}

static void
_mail_composer_widget_on_mouse_target_changed_webkit_web_view_mouse_target_changed (WebKitWebView* _sender,
                                                                                    WebKitHitTestResult* hit_test_result,
                                                                                    guint modifiers,
                                                                                    gpointer self)
{
	mail_composer_widget_on_mouse_target_changed ((MailComposerWidget*) self, _sender, hit_test_result, modifiers);
}

static void
_mail_composer_widget___lambda70_ (MailComposerWidget* self)
{
	GtkRevealer* _tmp0_;
	GtkToggleButton* _tmp1_;
	gboolean _tmp2_;
	gboolean _tmp3_;
	_tmp0_ = self->priv->cc_revealer;
	_tmp1_ = self->priv->cc_button;
	_tmp2_ = gtk_toggle_button_get_active (_tmp1_);
	_tmp3_ = _tmp2_;
	gtk_revealer_set_reveal_child (_tmp0_, _tmp3_);
}

static void
__mail_composer_widget___lambda70__gtk_button_clicked (GtkButton* _sender,
                                                       gpointer self)
{
	_mail_composer_widget___lambda70_ ((MailComposerWidget*) self);
}

static void
_mail_composer_widget___lambda71_ (MailComposerWidget* self)
{
	GtkEntry* _tmp0_;
	GtkEntry* _tmp1_;
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	_tmp0_ = self->priv->cc_val;
	mail_composer_widget_on_sanitize_recipient_entry (self, _tmp0_);
	_tmp1_ = self->priv->cc_val;
	_tmp2_ = gtk_entry_get_text (_tmp1_);
	_tmp3_ = _tmp2_;
	if (g_strcmp0 (_tmp3_, "") == 0) {
		GtkToggleButton* _tmp4_;
		_tmp4_ = self->priv->cc_button;
		gtk_widget_set_sensitive ((GtkWidget*) _tmp4_, TRUE);
	} else {
		GtkToggleButton* _tmp5_;
		_tmp5_ = self->priv->cc_button;
		gtk_widget_set_sensitive ((GtkWidget*) _tmp5_, FALSE);
	}
}

static void
__mail_composer_widget___lambda71__gtk_editable_changed (GtkEditable* _sender,
                                                         gpointer self)
{
	_mail_composer_widget___lambda71_ ((MailComposerWidget*) self);
}

static void
_mail_composer_widget___lambda72_ (Block18Data* _data18_)
{
	MailComposerWidget* self;
	GtkRevealer* _tmp0_;
	GtkToggleButton* _tmp1_;
	gboolean _tmp2_;
	gboolean _tmp3_;
	self = _data18_->self;
	_tmp0_ = self->priv->bcc_revealer;
	_tmp1_ = _data18_->bcc_button;
	_tmp2_ = gtk_toggle_button_get_active (_tmp1_);
	_tmp3_ = _tmp2_;
	gtk_revealer_set_reveal_child (_tmp0_, _tmp3_);
}

static void
__mail_composer_widget___lambda72__gtk_button_clicked (GtkButton* _sender,
                                                       gpointer self)
{
	_mail_composer_widget___lambda72_ (self);
}

static void
_mail_composer_widget___lambda73_ (Block18Data* _data18_)
{
	MailComposerWidget* self;
	GtkEntry* _tmp0_;
	GtkEntry* _tmp1_;
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	self = _data18_->self;
	_tmp0_ = self->priv->bcc_val;
	mail_composer_widget_on_sanitize_recipient_entry (self, _tmp0_);
	_tmp1_ = self->priv->bcc_val;
	_tmp2_ = gtk_entry_get_text (_tmp1_);
	_tmp3_ = _tmp2_;
	if (g_strcmp0 (_tmp3_, "") == 0) {
		GtkToggleButton* _tmp4_;
		_tmp4_ = _data18_->bcc_button;
		gtk_widget_set_sensitive ((GtkWidget*) _tmp4_, TRUE);
	} else {
		GtkToggleButton* _tmp5_;
		_tmp5_ = _data18_->bcc_button;
		gtk_widget_set_sensitive ((GtkWidget*) _tmp5_, FALSE);
	}
}

static void
__mail_composer_widget___lambda73__gtk_editable_changed (GtkEditable* _sender,
                                                         gpointer self)
{
	_mail_composer_widget___lambda73_ (self);
}

static void
_mail_composer_widget___lambda74_ (MailComposerWidget* self)
{
}

static void
__mail_composer_widget___lambda74__gtk_combo_box_changed (GtkComboBox* _sender,
                                                          gpointer self)
{
	_mail_composer_widget___lambda74_ ((MailComposerWidget*) self);
}

static void
_mail_composer_widget___lambda75_ (MailComposerWidget* self)
{
	GtkEntry* _tmp0_;
	GtkEntry* _tmp1_;
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	_tmp0_ = self->priv->to_val;
	mail_composer_widget_on_sanitize_recipient_entry (self, _tmp0_);
	_tmp1_ = self->priv->to_val;
	_tmp2_ = gtk_entry_get_text (_tmp1_);
	_tmp3_ = _tmp2_;
	mail_composer_widget_set_has_recipients (self, g_strcmp0 (_tmp3_, "") != 0);
}

static void
__mail_composer_widget___lambda75__gtk_editable_changed (GtkEditable* _sender,
                                                         gpointer self)
{
	_mail_composer_widget___lambda75_ ((MailComposerWidget*) self);
}

static void
_mail_composer_widget___lambda76_ (Block18Data* _data18_)
{
	MailComposerWidget* self;
	GtkStyleContext* to_grid_style_context = NULL;
	MailComposerWidgetEntryGrid* _tmp0_;
	GtkStyleContext* _tmp1_;
	GtkStateFlags state = 0U;
	GtkStyleContext* _tmp2_;
	GtkEntry* _tmp3_;
	gboolean _tmp4_;
	gboolean _tmp5_;
	GtkStyleContext* _tmp6_;
	self = _data18_->self;
	_tmp0_ = _data18_->to_grid;
	_tmp1_ = gtk_widget_get_style_context ((GtkWidget*) _tmp0_);
	to_grid_style_context = _tmp1_;
	_tmp2_ = to_grid_style_context;
	state = gtk_style_context_get_state (_tmp2_);
	_tmp3_ = self->priv->to_val;
	g_object_get ((GtkWidget*) _tmp3_, "has-focus", &_tmp4_, NULL);
	_tmp5_ = _tmp4_;
	if (_tmp5_) {
		state |= GTK_STATE_FLAG_FOCUSED;
	} else {
		state ^= GTK_STATE_FLAG_FOCUSED;
	}
	_tmp6_ = to_grid_style_context;
	gtk_style_context_set_state (_tmp6_, state);
}

static void
__mail_composer_widget___lambda76__gtk_style_context_changed (GtkStyleContext* _sender,
                                                              gpointer self)
{
	_mail_composer_widget___lambda76_ (self);
}

static GObject *
mail_composer_widget_constructor (GType type,
                                  guint n_construct_properties,
                                  GObjectConstructParam * construct_properties)
{
	GObject * obj;
	GObjectClass * parent_class;
	MailComposerWidget * self;
	Block18Data* _data18_;
	GSimpleActionGroup* _tmp0_;
	GSimpleActionGroup* _tmp1_;
	GSimpleActionGroup* _tmp2_;
	GtkLabel* from_label = NULL;
	GtkLabel* _tmp3_;
	GtkLabel* _tmp4_;
	GtkLabel* _tmp5_;
	GtkStyleContext* _tmp6_;
	GtkComboBoxText* _tmp7_;
	GtkComboBoxText* _tmp8_;
	GtkGrid* from_grid = NULL;
	GtkGrid* _tmp9_;
	GtkGrid* _tmp10_;
	GtkGrid* _tmp11_;
	GtkGrid* _tmp12_;
	GtkLabel* _tmp13_;
	GtkGrid* _tmp14_;
	GtkComboBoxText* _tmp15_;
	GtkRevealer* _tmp16_;
	GtkRevealer* _tmp17_;
	GtkGrid* _tmp18_;
	GtkLabel* to_label = NULL;
	GtkLabel* _tmp19_;
	GtkLabel* _tmp20_;
	GtkLabel* _tmp21_;
	GtkStyleContext* _tmp22_;
	GtkLabel* subject_label = NULL;
	GtkLabel* _tmp23_;
	GtkLabel* _tmp24_;
	GtkLabel* _tmp25_;
	GtkStyleContext* _tmp26_;
	GtkEntry* _tmp27_;
	GtkEntry* _tmp28_;
	GtkToggleButton* _tmp29_;
	GtkToggleButton* _tmp30_;
	MailComposerWidgetEntryGrid* _tmp31_;
	MailComposerWidgetEntryGrid* _tmp32_;
	GtkEntry* _tmp33_;
	MailComposerWidgetEntryGrid* _tmp34_;
	GtkToggleButton* _tmp35_;
	MailComposerWidgetEntryGrid* _tmp36_;
	GtkToggleButton* _tmp37_;
	GtkLabel* cc_label = NULL;
	GtkLabel* _tmp38_;
	GtkLabel* _tmp39_;
	GtkLabel* _tmp40_;
	GtkStyleContext* _tmp41_;
	GtkEntry* _tmp42_;
	GtkEntry* _tmp43_;
	GtkGrid* cc_grid = NULL;
	GtkGrid* _tmp44_;
	GtkGrid* _tmp45_;
	GtkGrid* _tmp46_;
	GtkGrid* _tmp47_;
	GtkLabel* _tmp48_;
	GtkGrid* _tmp49_;
	GtkEntry* _tmp50_;
	GtkRevealer* _tmp51_;
	GtkRevealer* _tmp52_;
	GtkGrid* _tmp53_;
	GtkLabel* bcc_label = NULL;
	GtkLabel* _tmp54_;
	GtkLabel* _tmp55_;
	GtkLabel* _tmp56_;
	GtkStyleContext* _tmp57_;
	GtkEntry* _tmp58_;
	GtkEntry* _tmp59_;
	GtkGrid* bcc_grid = NULL;
	GtkGrid* _tmp60_;
	GtkGrid* _tmp61_;
	GtkGrid* _tmp62_;
	GtkGrid* _tmp63_;
	GtkLabel* _tmp64_;
	GtkGrid* _tmp65_;
	GtkEntry* _tmp66_;
	GtkRevealer* _tmp67_;
	GtkRevealer* _tmp68_;
	GtkGrid* _tmp69_;
	GtkEntry* _tmp70_;
	GtkEntry* _tmp71_;
	GtkEntry* _tmp72_;
	GtkSizeGroup* size_group = NULL;
	GtkSizeGroup* _tmp73_;
	GtkSizeGroup* _tmp74_;
	GtkLabel* _tmp75_;
	GtkSizeGroup* _tmp76_;
	GtkLabel* _tmp77_;
	GtkSizeGroup* _tmp78_;
	GtkLabel* _tmp79_;
	GtkSizeGroup* _tmp80_;
	GtkLabel* _tmp81_;
	GtkSizeGroup* _tmp82_;
	GtkLabel* _tmp83_;
	GtkGrid* recipient_grid = NULL;
	GtkGrid* _tmp84_;
	GtkGrid* _tmp85_;
	GtkGrid* _tmp86_;
	GtkGrid* _tmp87_;
	GtkRevealer* _tmp88_;
	GtkGrid* _tmp89_;
	GtkLabel* _tmp90_;
	GtkGrid* _tmp91_;
	MailComposerWidgetEntryGrid* _tmp92_;
	GtkGrid* _tmp93_;
	GtkRevealer* _tmp94_;
	GtkGrid* _tmp95_;
	GtkRevealer* _tmp96_;
	gboolean _tmp97_;
	GtkToggleButton* bold = NULL;
	gchar* _tmp102_;
	GVariant* _tmp103_;
	GtkImage* _tmp104_;
	gchar* _tmp105_;
	gchar** _tmp106_;
	gchar** _tmp107_;
	gint _tmp107__length1;
	gchar* _tmp108_;
	GtkToggleButton* _tmp109_ = NULL;
	GtkToggleButton* _tmp110_;
	GtkToggleButton* italic = NULL;
	gchar* _tmp111_;
	GVariant* _tmp112_;
	GtkImage* _tmp113_;
	gchar* _tmp114_;
	gchar** _tmp115_;
	gchar** _tmp116_;
	gint _tmp116__length1;
	gchar* _tmp117_;
	GtkToggleButton* _tmp118_ = NULL;
	GtkToggleButton* _tmp119_;
	GtkToggleButton* underline = NULL;
	gchar* _tmp120_;
	GVariant* _tmp121_;
	GtkImage* _tmp122_;
	gchar* _tmp123_;
	gchar** _tmp124_;
	gchar** _tmp125_;
	gint _tmp125__length1;
	gchar* _tmp126_;
	GtkToggleButton* _tmp127_ = NULL;
	GtkToggleButton* _tmp128_;
	GtkToggleButton* strikethrough = NULL;
	gchar* _tmp129_;
	GVariant* _tmp130_;
	GtkImage* _tmp131_;
	gchar* _tmp132_;
	gchar** _tmp133_;
	gchar** _tmp134_;
	gint _tmp134__length1;
	gchar* _tmp135_;
	GtkToggleButton* _tmp136_ = NULL;
	GtkToggleButton* _tmp137_;
	GtkButton* clear_format = NULL;
	gchar* _tmp138_;
	gchar* _tmp139_;
	gchar** _tmp140_;
	gchar** _tmp141_;
	gint _tmp141__length1;
	gchar* _tmp142_;
	GtkButton* _tmp143_ = NULL;
	GtkButton* _tmp144_;
	GtkGrid* formatting_buttons = NULL;
	GtkGrid* _tmp145_;
	GtkGrid* _tmp146_;
	GtkStyleContext* _tmp147_;
	GtkGrid* _tmp148_;
	GtkToggleButton* _tmp149_;
	GtkGrid* _tmp150_;
	GtkToggleButton* _tmp151_;
	GtkGrid* _tmp152_;
	GtkToggleButton* _tmp153_;
	GtkGrid* _tmp154_;
	GtkToggleButton* _tmp155_;
	GtkButton* link = NULL;
	gchar* _tmp156_;
	gchar* _tmp157_;
	gchar** _tmp158_;
	gchar** _tmp159_;
	gint _tmp159__length1;
	gchar* _tmp160_;
	GtkButton* _tmp161_ = NULL;
	GtkButton* _tmp162_;
	GtkGrid* button_row = NULL;
	GtkGrid* _tmp163_ = NULL;
	GtkGrid* _tmp164_;
	GtkGrid* _tmp165_;
	GtkGrid* _tmp166_;
	GtkButton* _tmp167_;
	GtkGrid* _tmp168_;
	GtkButton* _tmp169_;
	MailWebView* _tmp170_;
	MailWebView* _tmp178_;
	MailWebView* _tmp179_;
	GtkFlowBox* _tmp180_ = NULL;
	GtkFlowBox* _tmp181_;
	GtkStyleContext* _tmp182_;
	GtkButton* discard = NULL;
	gchar* _tmp183_;
	gchar* _tmp184_;
	GtkButton* _tmp185_ = NULL;
	GtkButton* attach = NULL;
	gchar* _tmp186_;
	gchar* _tmp187_;
	gchar** _tmp188_;
	gchar** _tmp189_;
	gint _tmp189__length1;
	gchar* _tmp190_;
	GtkButton* _tmp191_ = NULL;
	GtkButton* _tmp192_;
	GtkButton* send = NULL;
	gchar* _tmp193_;
	gchar* _tmp194_;
	GtkButton* _tmp195_ = NULL;
	GtkButton* _tmp196_;
	GtkStyleContext* _tmp197_;
	GtkActionBar* action_bar = NULL;
	GtkActionBar* _tmp198_ = NULL;
	GtkActionBar* _tmp199_;
	GtkStyleContext* _tmp200_;
	GtkActionBar* _tmp201_;
	GtkButton* _tmp202_;
	GtkActionBar* _tmp203_;
	GtkButton* _tmp204_;
	GtkActionBar* _tmp205_;
	GtkButton* _tmp206_;
	GtkOverlay* view_overlay = NULL;
	GtkOverlay* _tmp207_;
	GtkOverlay* _tmp208_;
	MailWebView* _tmp209_;
	GtkOverlay* _tmp210_;
	GraniteWidgetsOverlayBar* _tmp211_;
	GraniteWidgetsOverlayBar* _tmp212_;
	GtkGrid* _tmp213_;
	GtkGrid* _tmp214_;
	GtkSeparator* _tmp215_;
	GtkSeparator* _tmp216_;
	GtkOverlay* _tmp217_;
	GtkFlowBox* _tmp218_;
	GtkActionBar* _tmp219_;
	MailContactManager* contact_manager = NULL;
	MailContactManager* _tmp220_;
	MailContactManager* _tmp221_;
	MailContactManager* _tmp222_;
	GtkEntry* _tmp223_;
	MailContactManager* _tmp224_;
	GtkEntry* _tmp225_;
	MailContactManager* _tmp226_;
	GtkEntry* _tmp227_;
	GtkComboBoxText* _tmp228_;
	GtkTreeModel* _tmp229_;
	GtkTreeModel* _tmp230_;
	GtkButton* _tmp234_;
	GtkToggleButton* _tmp235_;
	GtkEntry* _tmp236_;
	GtkToggleButton* _tmp237_;
	GtkEntry* _tmp238_;
	GtkComboBoxText* _tmp239_;
	GtkEntry* _tmp240_;
	GtkEntry* _tmp241_;
	GtkStyleContext* _tmp242_;
	const gchar* _tmp243_;
	const gchar* _tmp246_;
	GError* _inner_error0_ = NULL;
	parent_class = G_OBJECT_CLASS (mail_composer_widget_parent_class);
	obj = parent_class->constructor (type, n_construct_properties, construct_properties);
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, MAIL_TYPE_COMPOSER_WIDGET, MailComposerWidget);
	_data18_ = g_slice_new0 (Block18Data);
	_data18_->_ref_count_ = 1;
	_data18_->self = g_object_ref (self);
	_tmp0_ = g_simple_action_group_new ();
	_g_object_unref0 (self->priv->actions);
	self->priv->actions = _tmp0_;
	_tmp1_ = self->priv->actions;
	g_action_map_add_action_entries ((GActionMap*) _tmp1_, MAIL_COMPOSER_WIDGET_ACTION_ENTRIES, (gint) G_N_ELEMENTS (MAIL_COMPOSER_WIDGET_ACTION_ENTRIES), self);
	_tmp2_ = self->priv->actions;
	gtk_widget_insert_action_group ((GtkWidget*) self, MAIL_COMPOSER_WIDGET_ACTION_GROUP_PREFIX, (GActionGroup*) _tmp2_);
	_tmp3_ = (GtkLabel*) gtk_label_new (_ ("From:"));
	g_object_ref_sink (_tmp3_);
	from_label = _tmp3_;
	_tmp4_ = from_label;
	gtk_label_set_xalign (_tmp4_, (gfloat) 1);
	_tmp5_ = from_label;
	_tmp6_ = gtk_widget_get_style_context ((GtkWidget*) _tmp5_);
	gtk_style_context_add_class (_tmp6_, GTK_STYLE_CLASS_DIM_LABEL);
	_tmp7_ = (GtkComboBoxText*) gtk_combo_box_text_new ();
	g_object_ref_sink (_tmp7_);
	_g_object_unref0 (self->priv->from_combo);
	self->priv->from_combo = _tmp7_;
	_tmp8_ = self->priv->from_combo;
	gtk_widget_set_hexpand ((GtkWidget*) _tmp8_, TRUE);
	_tmp9_ = (GtkGrid*) gtk_grid_new ();
	g_object_ref_sink (_tmp9_);
	from_grid = _tmp9_;
	_tmp10_ = from_grid;
	gtk_grid_set_column_spacing (_tmp10_, 6);
	_tmp11_ = from_grid;
	gtk_widget_set_margin_bottom ((GtkWidget*) _tmp11_, 6);
	_tmp12_ = from_grid;
	_tmp13_ = from_label;
	gtk_container_add ((GtkContainer*) _tmp12_, (GtkWidget*) _tmp13_);
	_tmp14_ = from_grid;
	_tmp15_ = self->priv->from_combo;
	gtk_container_add ((GtkContainer*) _tmp14_, (GtkWidget*) _tmp15_);
	_tmp16_ = (GtkRevealer*) gtk_revealer_new ();
	g_object_ref_sink (_tmp16_);
	_g_object_unref0 (self->priv->from_revealer);
	self->priv->from_revealer = _tmp16_;
	_tmp17_ = self->priv->from_revealer;
	_tmp18_ = from_grid;
	gtk_container_add ((GtkContainer*) _tmp17_, (GtkWidget*) _tmp18_);
	_tmp19_ = (GtkLabel*) gtk_label_new (_ ("To:"));
	g_object_ref_sink (_tmp19_);
	to_label = _tmp19_;
	_tmp20_ = to_label;
	gtk_label_set_xalign (_tmp20_, (gfloat) 1);
	_tmp21_ = to_label;
	_tmp22_ = gtk_widget_get_style_context ((GtkWidget*) _tmp21_);
	gtk_style_context_add_class (_tmp22_, GTK_STYLE_CLASS_DIM_LABEL);
	_tmp23_ = (GtkLabel*) gtk_label_new (_ ("Subject:"));
	g_object_ref_sink (_tmp23_);
	subject_label = _tmp23_;
	_tmp24_ = subject_label;
	gtk_label_set_xalign (_tmp24_, (gfloat) 1);
	_tmp25_ = subject_label;
	_tmp26_ = gtk_widget_get_style_context ((GtkWidget*) _tmp25_);
	gtk_style_context_add_class (_tmp26_, GTK_STYLE_CLASS_DIM_LABEL);
	_tmp27_ = (GtkEntry*) gtk_entry_new ();
	g_object_ref_sink (_tmp27_);
	_g_object_unref0 (self->priv->to_val);
	self->priv->to_val = _tmp27_;
	_tmp28_ = self->priv->to_val;
	gtk_widget_set_hexpand ((GtkWidget*) _tmp28_, TRUE);
	_tmp29_ = (GtkToggleButton*) gtk_toggle_button_new_with_label (_ ("Cc"));
	g_object_ref_sink (_tmp29_);
	_g_object_unref0 (self->priv->cc_button);
	self->priv->cc_button = _tmp29_;
	_tmp30_ = (GtkToggleButton*) gtk_toggle_button_new_with_label (_ ("Bcc"));
	g_object_ref_sink (_tmp30_);
	_data18_->bcc_button = _tmp30_;
	_tmp31_ = mail_composer_widget_entry_grid_new ();
	g_object_ref_sink (_tmp31_);
	_data18_->to_grid = _tmp31_;
	_tmp32_ = _data18_->to_grid;
	_tmp33_ = self->priv->to_val;
	gtk_container_add ((GtkContainer*) _tmp32_, (GtkWidget*) _tmp33_);
	_tmp34_ = _data18_->to_grid;
	_tmp35_ = self->priv->cc_button;
	gtk_container_add ((GtkContainer*) _tmp34_, (GtkWidget*) _tmp35_);
	_tmp36_ = _data18_->to_grid;
	_tmp37_ = _data18_->bcc_button;
	gtk_container_add ((GtkContainer*) _tmp36_, (GtkWidget*) _tmp37_);
	_tmp38_ = (GtkLabel*) gtk_label_new (_ ("Cc:"));
	g_object_ref_sink (_tmp38_);
	cc_label = _tmp38_;
	_tmp39_ = cc_label;
	gtk_label_set_xalign (_tmp39_, (gfloat) 1);
	_tmp40_ = cc_label;
	_tmp41_ = gtk_widget_get_style_context ((GtkWidget*) _tmp40_);
	gtk_style_context_add_class (_tmp41_, GTK_STYLE_CLASS_DIM_LABEL);
	_tmp42_ = (GtkEntry*) gtk_entry_new ();
	g_object_ref_sink (_tmp42_);
	_g_object_unref0 (self->priv->cc_val);
	self->priv->cc_val = _tmp42_;
	_tmp43_ = self->priv->cc_val;
	gtk_widget_set_hexpand ((GtkWidget*) _tmp43_, TRUE);
	_tmp44_ = (GtkGrid*) gtk_grid_new ();
	g_object_ref_sink (_tmp44_);
	cc_grid = _tmp44_;
	_tmp45_ = cc_grid;
	gtk_grid_set_column_spacing (_tmp45_, 6);
	_tmp46_ = cc_grid;
	gtk_widget_set_margin_top ((GtkWidget*) _tmp46_, 6);
	_tmp47_ = cc_grid;
	_tmp48_ = cc_label;
	gtk_container_add ((GtkContainer*) _tmp47_, (GtkWidget*) _tmp48_);
	_tmp49_ = cc_grid;
	_tmp50_ = self->priv->cc_val;
	gtk_container_add ((GtkContainer*) _tmp49_, (GtkWidget*) _tmp50_);
	_tmp51_ = (GtkRevealer*) gtk_revealer_new ();
	g_object_ref_sink (_tmp51_);
	_g_object_unref0 (self->priv->cc_revealer);
	self->priv->cc_revealer = _tmp51_;
	_tmp52_ = self->priv->cc_revealer;
	_tmp53_ = cc_grid;
	gtk_container_add ((GtkContainer*) _tmp52_, (GtkWidget*) _tmp53_);
	_tmp54_ = (GtkLabel*) gtk_label_new (_ ("Bcc:"));
	g_object_ref_sink (_tmp54_);
	bcc_label = _tmp54_;
	_tmp55_ = bcc_label;
	gtk_label_set_xalign (_tmp55_, (gfloat) 1);
	_tmp56_ = bcc_label;
	_tmp57_ = gtk_widget_get_style_context ((GtkWidget*) _tmp56_);
	gtk_style_context_add_class (_tmp57_, GTK_STYLE_CLASS_DIM_LABEL);
	_tmp58_ = (GtkEntry*) gtk_entry_new ();
	g_object_ref_sink (_tmp58_);
	_g_object_unref0 (self->priv->bcc_val);
	self->priv->bcc_val = _tmp58_;
	_tmp59_ = self->priv->bcc_val;
	gtk_widget_set_hexpand ((GtkWidget*) _tmp59_, TRUE);
	_tmp60_ = (GtkGrid*) gtk_grid_new ();
	g_object_ref_sink (_tmp60_);
	bcc_grid = _tmp60_;
	_tmp61_ = bcc_grid;
	gtk_grid_set_column_spacing (_tmp61_, 6);
	_tmp62_ = bcc_grid;
	gtk_widget_set_margin_top ((GtkWidget*) _tmp62_, 6);
	_tmp63_ = bcc_grid;
	_tmp64_ = bcc_label;
	gtk_container_add ((GtkContainer*) _tmp63_, (GtkWidget*) _tmp64_);
	_tmp65_ = bcc_grid;
	_tmp66_ = self->priv->bcc_val;
	gtk_container_add ((GtkContainer*) _tmp65_, (GtkWidget*) _tmp66_);
	_tmp67_ = (GtkRevealer*) gtk_revealer_new ();
	g_object_ref_sink (_tmp67_);
	_g_object_unref0 (self->priv->bcc_revealer);
	self->priv->bcc_revealer = _tmp67_;
	_tmp68_ = self->priv->bcc_revealer;
	_tmp69_ = bcc_grid;
	gtk_container_add ((GtkContainer*) _tmp68_, (GtkWidget*) _tmp69_);
	_tmp70_ = (GtkEntry*) gtk_entry_new ();
	g_object_ref_sink (_tmp70_);
	_g_object_unref0 (self->priv->subject_val);
	self->priv->subject_val = _tmp70_;
	_tmp71_ = self->priv->subject_val;
	gtk_widget_set_margin_top ((GtkWidget*) _tmp71_, 6);
	_tmp72_ = self->priv->subject_val;
	g_signal_connect_object ((GtkEditable*) _tmp72_, "changed", (GCallback) __mail_composer_widget___lambda67__gtk_editable_changed, self, 0);
	_tmp73_ = gtk_size_group_new (GTK_SIZE_GROUP_HORIZONTAL);
	size_group = _tmp73_;
	_tmp74_ = size_group;
	_tmp75_ = from_label;
	gtk_size_group_add_widget (_tmp74_, (GtkWidget*) _tmp75_);
	_tmp76_ = size_group;
	_tmp77_ = to_label;
	gtk_size_group_add_widget (_tmp76_, (GtkWidget*) _tmp77_);
	_tmp78_ = size_group;
	_tmp79_ = cc_label;
	gtk_size_group_add_widget (_tmp78_, (GtkWidget*) _tmp79_);
	_tmp80_ = size_group;
	_tmp81_ = bcc_label;
	gtk_size_group_add_widget (_tmp80_, (GtkWidget*) _tmp81_);
	_tmp82_ = size_group;
	_tmp83_ = subject_label;
	gtk_size_group_add_widget (_tmp82_, (GtkWidget*) _tmp83_);
	_tmp84_ = (GtkGrid*) gtk_grid_new ();
	g_object_ref_sink (_tmp84_);
	recipient_grid = _tmp84_;
	_tmp85_ = recipient_grid;
	g_object_set ((GtkWidget*) _tmp85_, "margin", 6, NULL);
	_tmp86_ = recipient_grid;
	gtk_grid_set_column_spacing (_tmp86_, 6);
	_tmp87_ = recipient_grid;
	_tmp88_ = self->priv->from_revealer;
	gtk_grid_attach (_tmp87_, (GtkWidget*) _tmp88_, 0, 0, 2, 1);
	_tmp89_ = recipient_grid;
	_tmp90_ = to_label;
	gtk_grid_attach (_tmp89_, (GtkWidget*) _tmp90_, 0, 1, 1, 1);
	_tmp91_ = recipient_grid;
	_tmp92_ = _data18_->to_grid;
	gtk_grid_attach (_tmp91_, (GtkWidget*) _tmp92_, 1, 1, 1, 1);
	_tmp93_ = recipient_grid;
	_tmp94_ = self->priv->cc_revealer;
	gtk_grid_attach (_tmp93_, (GtkWidget*) _tmp94_, 0, 2, 2, 1);
	_tmp95_ = recipient_grid;
	_tmp96_ = self->priv->bcc_revealer;
	gtk_grid_attach (_tmp95_, (GtkWidget*) _tmp96_, 0, 3, 2, 1);
	_tmp97_ = self->priv->_has_subject_field;
	if (_tmp97_) {
		GtkGrid* _tmp98_;
		GtkLabel* _tmp99_;
		GtkGrid* _tmp100_;
		GtkEntry* _tmp101_;
		_tmp98_ = recipient_grid;
		_tmp99_ = subject_label;
		gtk_grid_attach (_tmp98_, (GtkWidget*) _tmp99_, 0, 4, 1, 1);
		_tmp100_ = recipient_grid;
		_tmp101_ = self->priv->subject_val;
		gtk_grid_attach (_tmp100_, (GtkWidget*) _tmp101_, 1, 4, 1, 1);
	}
	_tmp102_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_BOLD);
	_tmp103_ = _variant_new5 (MAIL_COMPOSER_WIDGET_ACTION_BOLD);
	_tmp104_ = (GtkImage*) gtk_image_new_from_icon_name ("format-text-bold-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	g_object_ref_sink (_tmp104_);
	_tmp105_ = g_strdup ("<Ctrl>B");
	_tmp106_ = g_new0 (gchar*, 1 + 1);
	_tmp106_[0] = _tmp105_;
	_tmp107_ = _tmp106_;
	_tmp107__length1 = 1;
	_tmp108_ = granite_markup_accel_tooltip (_tmp107_, (gint) 1, _ ("Bold"));
	_tmp109_ = (GtkToggleButton*) gtk_toggle_button_new ();
	gtk_actionable_set_action_name ((GtkActionable*) _tmp109_, _tmp102_);
	_g_free0 (_tmp102_);
	g_object_set ((GtkActionable*) _tmp109_, "action-target", _tmp103_, NULL);
	_g_variant_unref0 (_tmp103_);
	gtk_button_set_image ((GtkButton*) _tmp109_, (GtkWidget*) _tmp104_);
	_g_object_unref0 (_tmp104_);
	gtk_widget_set_tooltip_markup ((GtkWidget*) _tmp109_, _tmp108_);
	_g_free0 (_tmp108_);
	g_object_ref_sink (_tmp109_);
	_tmp110_ = _tmp109_;
	_tmp107_ = (_vala_array_free (_tmp107_, _tmp107__length1, (GDestroyNotify) g_free), NULL);
	bold = _tmp110_;
	_tmp111_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_ITALIC);
	_tmp112_ = _variant_new6 (MAIL_COMPOSER_WIDGET_ACTION_ITALIC);
	_tmp113_ = (GtkImage*) gtk_image_new_from_icon_name ("format-text-italic-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	g_object_ref_sink (_tmp113_);
	_tmp114_ = g_strdup ("<Ctrl>I");
	_tmp115_ = g_new0 (gchar*, 1 + 1);
	_tmp115_[0] = _tmp114_;
	_tmp116_ = _tmp115_;
	_tmp116__length1 = 1;
	_tmp117_ = granite_markup_accel_tooltip (_tmp116_, (gint) 1, _ ("Italic"));
	_tmp118_ = (GtkToggleButton*) gtk_toggle_button_new ();
	gtk_actionable_set_action_name ((GtkActionable*) _tmp118_, _tmp111_);
	_g_free0 (_tmp111_);
	g_object_set ((GtkActionable*) _tmp118_, "action-target", _tmp112_, NULL);
	_g_variant_unref0 (_tmp112_);
	gtk_button_set_image ((GtkButton*) _tmp118_, (GtkWidget*) _tmp113_);
	_g_object_unref0 (_tmp113_);
	gtk_widget_set_tooltip_markup ((GtkWidget*) _tmp118_, _tmp117_);
	_g_free0 (_tmp117_);
	g_object_ref_sink (_tmp118_);
	_tmp119_ = _tmp118_;
	_tmp116_ = (_vala_array_free (_tmp116_, _tmp116__length1, (GDestroyNotify) g_free), NULL);
	italic = _tmp119_;
	_tmp120_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_UNDERLINE);
	_tmp121_ = _variant_new7 (MAIL_COMPOSER_WIDGET_ACTION_UNDERLINE);
	_tmp122_ = (GtkImage*) gtk_image_new_from_icon_name ("format-text-underline-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	g_object_ref_sink (_tmp122_);
	_tmp123_ = g_strdup ("");
	_tmp124_ = g_new0 (gchar*, 1 + 1);
	_tmp124_[0] = _tmp123_;
	_tmp125_ = _tmp124_;
	_tmp125__length1 = 1;
	_tmp126_ = granite_markup_accel_tooltip (_tmp125_, (gint) 1, _ ("Underline"));
	_tmp127_ = (GtkToggleButton*) gtk_toggle_button_new ();
	gtk_actionable_set_action_name ((GtkActionable*) _tmp127_, _tmp120_);
	_g_free0 (_tmp120_);
	g_object_set ((GtkActionable*) _tmp127_, "action-target", _tmp121_, NULL);
	_g_variant_unref0 (_tmp121_);
	gtk_button_set_image ((GtkButton*) _tmp127_, (GtkWidget*) _tmp122_);
	_g_object_unref0 (_tmp122_);
	gtk_widget_set_tooltip_markup ((GtkWidget*) _tmp127_, _tmp126_);
	_g_free0 (_tmp126_);
	g_object_ref_sink (_tmp127_);
	_tmp128_ = _tmp127_;
	_tmp125_ = (_vala_array_free (_tmp125_, _tmp125__length1, (GDestroyNotify) g_free), NULL);
	underline = _tmp128_;
	_tmp129_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_STRIKETHROUGH);
	_tmp130_ = _variant_new8 (MAIL_COMPOSER_WIDGET_ACTION_STRIKETHROUGH);
	_tmp131_ = (GtkImage*) gtk_image_new_from_icon_name ("format-text-strikethrough-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	g_object_ref_sink (_tmp131_);
	_tmp132_ = g_strdup ("");
	_tmp133_ = g_new0 (gchar*, 1 + 1);
	_tmp133_[0] = _tmp132_;
	_tmp134_ = _tmp133_;
	_tmp134__length1 = 1;
	_tmp135_ = granite_markup_accel_tooltip (_tmp134_, (gint) 1, _ ("Strikethrough"));
	_tmp136_ = (GtkToggleButton*) gtk_toggle_button_new ();
	gtk_actionable_set_action_name ((GtkActionable*) _tmp136_, _tmp129_);
	_g_free0 (_tmp129_);
	g_object_set ((GtkActionable*) _tmp136_, "action-target", _tmp130_, NULL);
	_g_variant_unref0 (_tmp130_);
	gtk_button_set_image ((GtkButton*) _tmp136_, (GtkWidget*) _tmp131_);
	_g_object_unref0 (_tmp131_);
	gtk_widget_set_tooltip_markup ((GtkWidget*) _tmp136_, _tmp135_);
	_g_free0 (_tmp135_);
	g_object_ref_sink (_tmp136_);
	_tmp137_ = _tmp136_;
	_tmp134_ = (_vala_array_free (_tmp134_, _tmp134__length1, (GDestroyNotify) g_free), NULL);
	strikethrough = _tmp137_;
	_tmp138_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_REMOVE_FORMAT);
	_tmp139_ = g_strdup ("");
	_tmp140_ = g_new0 (gchar*, 1 + 1);
	_tmp140_[0] = _tmp139_;
	_tmp141_ = _tmp140_;
	_tmp141__length1 = 1;
	_tmp142_ = granite_markup_accel_tooltip (_tmp141_, (gint) 1, _ ("Remove formatting"));
	_tmp143_ = (GtkButton*) gtk_button_new_from_icon_name ("format-text-clear-formatting-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	gtk_actionable_set_action_name ((GtkActionable*) _tmp143_, _tmp138_);
	_g_free0 (_tmp138_);
	gtk_widget_set_tooltip_markup ((GtkWidget*) _tmp143_, _tmp142_);
	_g_free0 (_tmp142_);
	g_object_ref_sink (_tmp143_);
	_tmp144_ = _tmp143_;
	_tmp141_ = (_vala_array_free (_tmp141_, _tmp141__length1, (GDestroyNotify) g_free), NULL);
	clear_format = _tmp144_;
	_tmp145_ = (GtkGrid*) gtk_grid_new ();
	g_object_ref_sink (_tmp145_);
	formatting_buttons = _tmp145_;
	_tmp146_ = formatting_buttons;
	_tmp147_ = gtk_widget_get_style_context ((GtkWidget*) _tmp146_);
	gtk_style_context_add_class (_tmp147_, GTK_STYLE_CLASS_LINKED);
	_tmp148_ = formatting_buttons;
	_tmp149_ = bold;
	gtk_container_add ((GtkContainer*) _tmp148_, (GtkWidget*) _tmp149_);
	_tmp150_ = formatting_buttons;
	_tmp151_ = italic;
	gtk_container_add ((GtkContainer*) _tmp150_, (GtkWidget*) _tmp151_);
	_tmp152_ = formatting_buttons;
	_tmp153_ = underline;
	gtk_container_add ((GtkContainer*) _tmp152_, (GtkWidget*) _tmp153_);
	_tmp154_ = formatting_buttons;
	_tmp155_ = strikethrough;
	gtk_container_add ((GtkContainer*) _tmp154_, (GtkWidget*) _tmp155_);
	_tmp156_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_INSERT_LINK);
	_tmp157_ = g_strdup ("");
	_tmp158_ = g_new0 (gchar*, 1 + 1);
	_tmp158_[0] = _tmp157_;
	_tmp159_ = _tmp158_;
	_tmp159__length1 = 1;
	_tmp160_ = granite_markup_accel_tooltip (_tmp159_, (gint) 1, _ ("Insert Link"));
	_tmp161_ = (GtkButton*) gtk_button_new_from_icon_name ("insert-link-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	gtk_actionable_set_action_name ((GtkActionable*) _tmp161_, _tmp156_);
	_g_free0 (_tmp156_);
	gtk_widget_set_tooltip_markup ((GtkWidget*) _tmp161_, _tmp160_);
	_g_free0 (_tmp160_);
	g_object_ref_sink (_tmp161_);
	_tmp162_ = _tmp161_;
	_tmp159_ = (_vala_array_free (_tmp159_, _tmp159__length1, (GDestroyNotify) g_free), NULL);
	link = _tmp162_;
	_tmp163_ = (GtkGrid*) gtk_grid_new ();
	gtk_grid_set_column_spacing (_tmp163_, 12);
	gtk_widget_set_margin_start ((GtkWidget*) _tmp163_, 6);
	gtk_widget_set_margin_bottom ((GtkWidget*) _tmp163_, 6);
	g_object_ref_sink (_tmp163_);
	button_row = _tmp163_;
	_tmp164_ = button_row;
	_tmp165_ = formatting_buttons;
	gtk_container_add ((GtkContainer*) _tmp164_, (GtkWidget*) _tmp165_);
	_tmp166_ = button_row;
	_tmp167_ = clear_format;
	gtk_container_add ((GtkContainer*) _tmp166_, (GtkWidget*) _tmp167_);
	_tmp168_ = button_row;
	_tmp169_ = link;
	gtk_container_add ((GtkContainer*) _tmp168_, (GtkWidget*) _tmp169_);
	_tmp170_ = mail_web_view_new ();
	g_object_ref_sink (_tmp170_);
	_g_object_unref0 (self->priv->web_view);
	self->priv->web_view = _tmp170_;
	{
		GBytes* template = NULL;
		GBytes* _tmp171_;
		MailWebView* _tmp172_;
		GBytes* _tmp173_;
		gsize _tmp174_ = 0;
		guint8* _tmp175_;
		_tmp171_ = g_resources_lookup_data ("/io/elementary/mail/blank-message-template.html", G_RESOURCE_LOOKUP_FLAGS_NONE, &_inner_error0_);
		template = _tmp171_;
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			goto __catch0_g_error;
		}
		_tmp172_ = self->priv->web_view;
		_tmp173_ = template;
		_tmp175_ = g_bytes_get_data (_tmp173_, &_tmp174_);
		mail_web_view_load_html (_tmp172_, (const gchar*) _tmp175_);
		_g_bytes_unref0 (template);
	}
	goto __finally0;
	__catch0_g_error:
	{
		GError* e = NULL;
		GError* _tmp176_;
		const gchar* _tmp177_;
		e = _inner_error0_;
		_inner_error0_ = NULL;
		_tmp176_ = e;
		_tmp177_ = _tmp176_->message;
		g_warning ("ComposerWidget.vala:255: Failed to load blank message template: %s", _tmp177_);
		_g_error_free0 (e);
	}
	__finally0:
	if (G_UNLIKELY (_inner_error0_ != NULL)) {
		_g_object_unref0 (button_row);
		_g_object_unref0 (link);
		_g_object_unref0 (formatting_buttons);
		_g_object_unref0 (clear_format);
		_g_object_unref0 (strikethrough);
		_g_object_unref0 (underline);
		_g_object_unref0 (italic);
		_g_object_unref0 (bold);
		_g_object_unref0 (recipient_grid);
		_g_object_unref0 (size_group);
		_g_object_unref0 (bcc_grid);
		_g_object_unref0 (bcc_label);
		_g_object_unref0 (cc_grid);
		_g_object_unref0 (cc_label);
		_g_object_unref0 (subject_label);
		_g_object_unref0 (to_label);
		_g_object_unref0 (from_grid);
		_g_object_unref0 (from_label);
		block18_data_unref (_data18_);
		_data18_ = NULL;
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
		g_clear_error (&_inner_error0_);
	}
	_tmp178_ = self->priv->web_view;
	g_signal_connect_object (_tmp178_, "selection-changed", (GCallback) _mail_composer_widget_update_actions_mail_web_view_selection_changed, self, 0);
	_tmp179_ = self->priv->web_view;
	g_signal_connect_object ((WebKitWebView*) _tmp179_, "mouse-target-changed", (GCallback) _mail_composer_widget_on_mouse_target_changed_webkit_web_view_mouse_target_changed, self, 0);
	_tmp180_ = (GtkFlowBox*) gtk_flow_box_new ();
	gtk_flow_box_set_homogeneous (_tmp180_, TRUE);
	gtk_flow_box_set_selection_mode (_tmp180_, GTK_SELECTION_NONE);
	g_object_ref_sink (_tmp180_);
	_g_object_unref0 (self->priv->attachment_box);
	self->priv->attachment_box = _tmp180_;
	_tmp181_ = self->priv->attachment_box;
	_tmp182_ = gtk_widget_get_style_context ((GtkWidget*) _tmp181_);
	gtk_style_context_add_class (_tmp182_, GTK_STYLE_CLASS_VIEW);
	_tmp183_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_DISCARD);
	_tmp184_ = g_strdup (_ ("Delete draft"));
	_tmp185_ = (GtkButton*) gtk_button_new_from_icon_name ("edit-delete-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	gtk_actionable_set_action_name ((GtkActionable*) _tmp185_, _tmp183_);
	_g_free0 (_tmp183_);
	gtk_widget_set_tooltip_text ((GtkWidget*) _tmp185_, _tmp184_);
	_g_free0 (_tmp184_);
	g_object_ref_sink (_tmp185_);
	discard = _tmp185_;
	_tmp186_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_ADD_ATTACHMENT);
	_tmp187_ = g_strdup ("");
	_tmp188_ = g_new0 (gchar*, 1 + 1);
	_tmp188_[0] = _tmp187_;
	_tmp189_ = _tmp188_;
	_tmp189__length1 = 1;
	_tmp190_ = granite_markup_accel_tooltip (_tmp189_, (gint) 1, _ ("Attach file"));
	_tmp191_ = (GtkButton*) gtk_button_new_from_icon_name ("mail-attachment-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	gtk_actionable_set_action_name ((GtkActionable*) _tmp191_, _tmp186_);
	_g_free0 (_tmp186_);
	gtk_widget_set_tooltip_markup ((GtkWidget*) _tmp191_, _tmp190_);
	_g_free0 (_tmp190_);
	g_object_ref_sink (_tmp191_);
	_tmp192_ = _tmp191_;
	_tmp189_ = (_vala_array_free (_tmp189_, _tmp189__length1, (GDestroyNotify) g_free), NULL);
	attach = _tmp192_;
	_tmp193_ = g_strdup (MAIL_COMPOSER_WIDGET_ACTION_PREFIX MAIL_COMPOSER_WIDGET_ACTION_SEND);
	_tmp194_ = g_strdup (_ ("Send"));
	_tmp195_ = (GtkButton*) gtk_button_new_from_icon_name ("mail-send-symbolic", (GtkIconSize) GTK_ICON_SIZE_MENU);
	gtk_actionable_set_action_name ((GtkActionable*) _tmp195_, _tmp193_);
	_g_free0 (_tmp193_);
	gtk_button_set_always_show_image (_tmp195_, TRUE);
	gtk_button_set_label (_tmp195_, _tmp194_);
	_g_free0 (_tmp194_);
	g_object_set ((GtkWidget*) _tmp195_, "margin", 6, NULL);
	gtk_widget_set_margin_end ((GtkWidget*) _tmp195_, 0);
	gtk_widget_set_sensitive ((GtkWidget*) _tmp195_, FALSE);
	g_object_ref_sink (_tmp195_);
	send = _tmp195_;
	_tmp196_ = send;
	_tmp197_ = gtk_widget_get_style_context ((GtkWidget*) _tmp196_);
	gtk_style_context_add_class (_tmp197_, GTK_STYLE_CLASS_SUGGESTED_ACTION);
	_tmp198_ = (GtkActionBar*) gtk_action_bar_new ();
	gtk_widget_set_margin_top ((GtkWidget*) _tmp198_, 1);
	g_object_ref_sink (_tmp198_);
	action_bar = _tmp198_;
	_tmp199_ = action_bar;
	_tmp200_ = gtk_widget_get_style_context ((GtkWidget*) _tmp199_);
	gtk_style_context_add_class (_tmp200_, GTK_STYLE_CLASS_FLAT);
	_tmp201_ = action_bar;
	_tmp202_ = discard;
	gtk_action_bar_pack_start (_tmp201_, (GtkWidget*) _tmp202_);
	_tmp203_ = action_bar;
	_tmp204_ = attach;
	gtk_action_bar_pack_start (_tmp203_, (GtkWidget*) _tmp204_);
	_tmp205_ = action_bar;
	_tmp206_ = send;
	gtk_action_bar_pack_end (_tmp205_, (GtkWidget*) _tmp206_);
	_tmp207_ = (GtkOverlay*) gtk_overlay_new ();
	g_object_ref_sink (_tmp207_);
	view_overlay = _tmp207_;
	_tmp208_ = view_overlay;
	_tmp209_ = self->priv->web_view;
	gtk_container_add ((GtkContainer*) _tmp208_, (GtkWidget*) _tmp209_);
	_tmp210_ = view_overlay;
	_tmp211_ = granite_widgets_overlay_bar_new (_tmp210_);
	g_object_ref_sink (_tmp211_);
	_g_object_unref0 (self->priv->message_url_overlay);
	self->priv->message_url_overlay = _tmp211_;
	_tmp212_ = self->priv->message_url_overlay;
	gtk_widget_set_no_show_all ((GtkWidget*) _tmp212_, TRUE);
	gtk_orientable_set_orientation ((GtkOrientable*) self, GTK_ORIENTATION_VERTICAL);
	_tmp213_ = recipient_grid;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) _tmp213_);
	_tmp214_ = button_row;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) _tmp214_);
	_tmp215_ = (GtkSeparator*) gtk_separator_new (GTK_ORIENTATION_HORIZONTAL);
	g_object_ref_sink (_tmp215_);
	_tmp216_ = _tmp215_;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) _tmp216_);
	_g_object_unref0 (_tmp216_);
	_tmp217_ = view_overlay;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) _tmp217_);
	_tmp218_ = self->priv->attachment_box;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) _tmp218_);
	_tmp219_ = action_bar;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) _tmp219_);
	_tmp220_ = mail_contact_manager_get_default ();
	_tmp221_ = _g_object_ref0 (_tmp220_);
	contact_manager = _tmp221_;
	_tmp222_ = contact_manager;
	_tmp223_ = self->priv->to_val;
	mail_contact_manager_setup_entry (_tmp222_, _tmp223_);
	_tmp224_ = contact_manager;
	_tmp225_ = self->priv->cc_val;
	mail_contact_manager_setup_entry (_tmp224_, _tmp225_);
	_tmp226_ = contact_manager;
	_tmp227_ = self->priv->bcc_val;
	mail_contact_manager_setup_entry (_tmp226_, _tmp227_);
	mail_composer_widget_load_from_combobox (self);
	_tmp228_ = self->priv->from_combo;
	_tmp229_ = gtk_combo_box_get_model ((GtkComboBox*) _tmp228_);
	_tmp230_ = _tmp229_;
	if (gtk_tree_model_iter_n_children (_tmp230_, NULL) > 1) {
		gboolean _tmp231_ = FALSE;
		GtkRevealer* _tmp233_;
		if (TRUE) {
			gboolean _tmp232_;
			_tmp232_ = self->priv->_can_change_sender;
			_tmp231_ = _tmp232_;
		} else {
			_tmp231_ = FALSE;
		}
		_tmp233_ = self->priv->from_revealer;
		gtk_revealer_set_reveal_child (_tmp233_, _tmp231_);
	}
	_tmp234_ = send;
	g_object_bind_property_with_closures ((GObject*) self, "has-recipients", (GObject*) _tmp234_, "sensitive", G_BINDING_DEFAULT, (GClosure*) ((NULL == NULL) ? NULL : g_cclosure_new ((GCallback) NULL, NULL, (GClosureNotify) NULL)), (GClosure*) ((NULL == NULL) ? NULL : g_cclosure_new ((GCallback) NULL, NULL, (GClosureNotify) NULL)));
	_tmp235_ = self->priv->cc_button;
	g_signal_connect_object ((GtkButton*) _tmp235_, "clicked", (GCallback) __mail_composer_widget___lambda70__gtk_button_clicked, self, 0);
	_tmp236_ = self->priv->cc_val;
	g_signal_connect_object ((GtkEditable*) _tmp236_, "changed", (GCallback) __mail_composer_widget___lambda71__gtk_editable_changed, self, 0);
	_tmp237_ = _data18_->bcc_button;
	g_signal_connect_data ((GtkButton*) _tmp237_, "clicked", (GCallback) __mail_composer_widget___lambda72__gtk_button_clicked, block18_data_ref (_data18_), (GClosureNotify) block18_data_unref, 0);
	_tmp238_ = self->priv->bcc_val;
	g_signal_connect_data ((GtkEditable*) _tmp238_, "changed", (GCallback) __mail_composer_widget___lambda73__gtk_editable_changed, block18_data_ref (_data18_), (GClosureNotify) block18_data_unref, 0);
	_tmp239_ = self->priv->from_combo;
	g_signal_connect_object ((GtkComboBox*) _tmp239_, "changed", (GCallback) __mail_composer_widget___lambda74__gtk_combo_box_changed, self, 0);
	_tmp240_ = self->priv->to_val;
	g_signal_connect_object ((GtkEditable*) _tmp240_, "changed", (GCallback) __mail_composer_widget___lambda75__gtk_editable_changed, self, 0);
	_tmp241_ = self->priv->to_val;
	_tmp242_ = gtk_widget_get_style_context ((GtkWidget*) _tmp241_);
	g_signal_connect_data (_tmp242_, "changed", (GCallback) __mail_composer_widget___lambda76__gtk_style_context_changed, block18_data_ref (_data18_), (GClosureNotify) block18_data_unref, 0);
	_tmp243_ = self->priv->_to;
	if (_tmp243_ != NULL) {
		GtkEntry* _tmp244_;
		const gchar* _tmp245_;
		_tmp244_ = self->priv->to_val;
		_tmp245_ = self->priv->_to;
		gtk_entry_set_text (_tmp244_, _tmp245_);
	}
	_tmp246_ = self->priv->_mailto_query;
	if (_tmp246_ != NULL) {
		GtkRevealer* _tmp247_;
		GeeHashMultiMap* _result_ = NULL;
		GeeHashMultiMap* _tmp248_;
		gchar** params = NULL;
		const gchar* _tmp249_;
		gchar** _tmp250_;
		gchar** _tmp251_;
		gint params_length1;
		gint _params_size_;
		gchar** _tmp252_;
		gint _tmp252__length1;
		GeeHashMultiMap* _tmp266_;
		GeeHashMultiMap* _tmp276_;
		GeeHashMultiMap* _tmp286_;
		GeeHashMultiMap* _tmp295_;
		GeeHashMultiMap* _tmp305_;
		_tmp247_ = self->priv->from_revealer;
		mail_composer_widget_set_can_change_sender (self, TRUE);
		gtk_revealer_set_reveal_child (_tmp247_, TRUE);
		_tmp248_ = gee_hash_multi_map_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, (GDestroyNotify) g_free, G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, (GDestroyNotify) g_free, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
		_result_ = _tmp248_;
		_tmp249_ = self->priv->_mailto_query;
		_tmp251_ = _tmp250_ = g_strsplit (_tmp249_, "&", 0);
		params = _tmp251_;
		params_length1 = _vala_array_length (_tmp250_);
		_params_size_ = params_length1;
		_tmp252_ = params;
		_tmp252__length1 = params_length1;
		{
			gchar** param_collection = NULL;
			gint param_collection_length1 = 0;
			gint _param_collection_size_ = 0;
			gint param_it = 0;
			param_collection = _tmp252_;
			param_collection_length1 = _tmp252__length1;
			for (param_it = 0; param_it < param_collection_length1; param_it = param_it + 1) {
				const gchar* param = NULL;
				param = param_collection[param_it];
				{
					gchar** terms = NULL;
					const gchar* _tmp253_;
					gchar** _tmp254_;
					gchar** _tmp255_;
					gint terms_length1;
					gint _terms_size_;
					gchar** _tmp256_;
					gint _tmp256__length1;
					_tmp253_ = param;
					_tmp255_ = _tmp254_ = g_strsplit (_tmp253_, "=", 0);
					terms = _tmp255_;
					terms_length1 = _vala_array_length (_tmp254_);
					_terms_size_ = terms_length1;
					_tmp256_ = terms;
					_tmp256__length1 = terms_length1;
					if (_tmp256__length1 == 2) {
						GeeHashMultiMap* _tmp257_;
						gchar** _tmp258_;
						gint _tmp258__length1;
						const gchar* _tmp259_;
						gchar* _tmp260_;
						gchar* _tmp261_;
						gchar** _tmp262_;
						gint _tmp262__length1;
						const gchar* _tmp263_;
						gchar* _tmp264_;
						gchar* _tmp265_;
						_tmp257_ = _result_;
						_tmp258_ = terms;
						_tmp258__length1 = terms_length1;
						_tmp259_ = _tmp258_[0];
						_tmp260_ = g_utf8_strdown (_tmp259_, (gssize) -1);
						_tmp261_ = _tmp260_;
						_tmp262_ = terms;
						_tmp262__length1 = terms_length1;
						_tmp263_ = _tmp262_[1];
						_tmp264_ = g_uri_unescape_string (_tmp263_, NULL);
						_tmp265_ = _tmp264_;
						gee_multi_map_set ((GeeMultiMap*) _tmp257_, _tmp261_, _tmp265_);
						_g_free0 (_tmp265_);
						_g_free0 (_tmp261_);
					} else {
						g_critical ("ComposerWidget.vala:387: Invalid mailto URL");
					}
					terms = (_vala_array_free (terms, terms_length1, (GDestroyNotify) g_free), NULL);
				}
			}
		}
		_tmp266_ = _result_;
		if (gee_multi_map_contains ((GeeMultiMap*) _tmp266_, "bcc")) {
			GtkToggleButton* _tmp267_;
			GtkEntry* _tmp268_;
			GeeHashMultiMap* _tmp269_;
			GeeCollection* _tmp270_;
			GeeCollection* _tmp271_;
			gint _tmp272_ = 0;
			gpointer* _tmp273_;
			gchar** _tmp274_;
			gint _tmp274__length1;
			const gchar* _tmp275_;
			_tmp267_ = _data18_->bcc_button;
			gtk_button_clicked ((GtkButton*) _tmp267_);
			_tmp268_ = self->priv->bcc_val;
			_tmp269_ = _result_;
			_tmp270_ = gee_multi_map_get ((GeeMultiMap*) _tmp269_, "bcc");
			_tmp271_ = _tmp270_;
			_tmp273_ = gee_collection_to_array (_tmp271_, &_tmp272_);
			_tmp274_ = _tmp273_;
			_tmp274__length1 = _tmp272_;
			_tmp275_ = _tmp274_[0];
			gtk_entry_set_text (_tmp268_, _tmp275_);
			_tmp274_ = (_vala_array_free (_tmp274_, _tmp274__length1, (GDestroyNotify) g_free), NULL);
			_g_object_unref0 (_tmp271_);
		}
		_tmp276_ = _result_;
		if (gee_multi_map_contains ((GeeMultiMap*) _tmp276_, "cc")) {
			GtkToggleButton* _tmp277_;
			GtkEntry* _tmp278_;
			GeeHashMultiMap* _tmp279_;
			GeeCollection* _tmp280_;
			GeeCollection* _tmp281_;
			gint _tmp282_ = 0;
			gpointer* _tmp283_;
			gchar** _tmp284_;
			gint _tmp284__length1;
			const gchar* _tmp285_;
			_tmp277_ = self->priv->cc_button;
			gtk_button_clicked ((GtkButton*) _tmp277_);
			_tmp278_ = self->priv->cc_val;
			_tmp279_ = _result_;
			_tmp280_ = gee_multi_map_get ((GeeMultiMap*) _tmp279_, "cc");
			_tmp281_ = _tmp280_;
			_tmp283_ = gee_collection_to_array (_tmp281_, &_tmp282_);
			_tmp284_ = _tmp283_;
			_tmp284__length1 = _tmp282_;
			_tmp285_ = _tmp284_[0];
			gtk_entry_set_text (_tmp278_, _tmp285_);
			_tmp284_ = (_vala_array_free (_tmp284_, _tmp284__length1, (GDestroyNotify) g_free), NULL);
			_g_object_unref0 (_tmp281_);
		}
		_tmp286_ = _result_;
		if (gee_multi_map_contains ((GeeMultiMap*) _tmp286_, "subject")) {
			GtkEntry* _tmp287_;
			GeeHashMultiMap* _tmp288_;
			GeeCollection* _tmp289_;
			GeeCollection* _tmp290_;
			gint _tmp291_ = 0;
			gpointer* _tmp292_;
			gchar** _tmp293_;
			gint _tmp293__length1;
			const gchar* _tmp294_;
			_tmp287_ = self->priv->subject_val;
			_tmp288_ = _result_;
			_tmp289_ = gee_multi_map_get ((GeeMultiMap*) _tmp288_, "subject");
			_tmp290_ = _tmp289_;
			_tmp292_ = gee_collection_to_array (_tmp290_, &_tmp291_);
			_tmp293_ = _tmp292_;
			_tmp293__length1 = _tmp291_;
			_tmp294_ = _tmp293_[0];
			gtk_entry_set_text (_tmp287_, _tmp294_);
			_tmp293_ = (_vala_array_free (_tmp293_, _tmp293__length1, (GDestroyNotify) g_free), NULL);
			_g_object_unref0 (_tmp290_);
		}
		_tmp295_ = _result_;
		if (gee_multi_map_contains ((GeeMultiMap*) _tmp295_, "body")) {
			CamelMimeFilterToHTMLFlags flags = 0U;
			MailWebView* _tmp296_;
			GeeHashMultiMap* _tmp297_;
			GeeCollection* _tmp298_;
			GeeCollection* _tmp299_;
			gint _tmp300_ = 0;
			gpointer* _tmp301_;
			gchar** _tmp302_;
			gint _tmp302__length1;
			const gchar* _tmp303_;
			gchar* _tmp304_;
			flags = ((CAMEL_MIME_FILTER_TOHTML_CONVERT_ADDRESSES | CAMEL_MIME_FILTER_TOHTML_CONVERT_NL) | CAMEL_MIME_FILTER_TOHTML_CONVERT_SPACES) | CAMEL_MIME_FILTER_TOHTML_CONVERT_URLS;
			_tmp296_ = self->priv->web_view;
			_tmp297_ = _result_;
			_tmp298_ = gee_multi_map_get ((GeeMultiMap*) _tmp297_, "body");
			_tmp299_ = _tmp298_;
			_tmp301_ = gee_collection_to_array (_tmp299_, &_tmp300_);
			_tmp302_ = _tmp301_;
			_tmp302__length1 = _tmp300_;
			_tmp303_ = _tmp302_[0];
			_tmp304_ = camel_text_to_html (_tmp303_, flags, (guint32) 0);
			mail_web_view_set_body_content (_tmp296_, _tmp304_);
			_tmp302_ = (_vala_array_free (_tmp302_, _tmp302__length1, (GDestroyNotify) g_free), NULL);
			_g_object_unref0 (_tmp299_);
		}
		_tmp305_ = _result_;
		if (gee_multi_map_contains ((GeeMultiMap*) _tmp305_, "attachment")) {
			GtkFlowBox* _tmp326_;
			{
				GeeIterator* _path_it = NULL;
				GeeHashMultiMap* _tmp306_;
				GeeCollection* _tmp307_;
				GeeCollection* _tmp308_;
				GeeIterator* _tmp309_;
				GeeIterator* _tmp310_;
				_tmp306_ = _result_;
				_tmp307_ = gee_multi_map_get ((GeeMultiMap*) _tmp306_, "attachment");
				_tmp308_ = _tmp307_;
				_tmp309_ = gee_iterable_iterator ((GeeIterable*) _tmp308_);
				_tmp310_ = _tmp309_;
				_g_object_unref0 (_tmp308_);
				_path_it = _tmp310_;
				while (TRUE) {
					GeeIterator* _tmp311_;
					gchar* path = NULL;
					GeeIterator* _tmp312_;
					gpointer _tmp313_;
					GFile* _tmp314_ = NULL;
					const gchar* _tmp315_;
					GFile* file = NULL;
					GFile* _tmp320_;
					MailComposerWidgetAttachment* attachment = NULL;
					GFile* _tmp321_;
					MailComposerWidgetAttachment* _tmp322_;
					MailComposerWidgetAttachment* _tmp323_;
					GtkFlowBox* _tmp324_;
					MailComposerWidgetAttachment* _tmp325_;
					_tmp311_ = _path_it;
					if (!gee_iterator_next (_tmp311_)) {
						break;
					}
					_tmp312_ = _path_it;
					_tmp313_ = gee_iterator_get (_tmp312_);
					path = (gchar*) _tmp313_;
					_tmp315_ = path;
					if (g_str_has_prefix (_tmp315_, "file://")) {
						const gchar* _tmp316_;
						GFile* _tmp317_;
						_tmp316_ = path;
						_tmp317_ = g_file_new_for_uri (_tmp316_);
						_g_object_unref0 (_tmp314_);
						_tmp314_ = _tmp317_;
					} else {
						const gchar* _tmp318_;
						GFile* _tmp319_;
						_tmp318_ = path;
						_tmp319_ = g_file_new_for_path (_tmp318_);
						_g_object_unref0 (_tmp314_);
						_tmp314_ = _tmp319_;
					}
					_tmp320_ = _g_object_ref0 (_tmp314_);
					file = _tmp320_;
					_tmp321_ = file;
					_tmp322_ = mail_composer_widget_attachment_new (_tmp321_);
					g_object_ref_sink (_tmp322_);
					attachment = _tmp322_;
					_tmp323_ = attachment;
					g_object_set ((GtkWidget*) _tmp323_, "margin", 3, NULL);
					_tmp324_ = self->priv->attachment_box;
					_tmp325_ = attachment;
					gtk_container_add ((GtkContainer*) _tmp324_, (GtkWidget*) _tmp325_);
					_g_object_unref0 (attachment);
					_g_object_unref0 (file);
					_g_object_unref0 (_tmp314_);
					_g_free0 (path);
				}
				_g_object_unref0 (_path_it);
			}
			_tmp326_ = self->priv->attachment_box;
			gtk_widget_show_all ((GtkWidget*) _tmp326_);
		}
		params = (_vala_array_free (params, params_length1, (GDestroyNotify) g_free), NULL);
		_g_object_unref0 (_result_);
	}
	_g_object_unref0 (contact_manager);
	_g_object_unref0 (view_overlay);
	_g_object_unref0 (action_bar);
	_g_object_unref0 (send);
	_g_object_unref0 (attach);
	_g_object_unref0 (discard);
	_g_object_unref0 (button_row);
	_g_object_unref0 (link);
	_g_object_unref0 (formatting_buttons);
	_g_object_unref0 (clear_format);
	_g_object_unref0 (strikethrough);
	_g_object_unref0 (underline);
	_g_object_unref0 (italic);
	_g_object_unref0 (bold);
	_g_object_unref0 (recipient_grid);
	_g_object_unref0 (size_group);
	_g_object_unref0 (bcc_grid);
	_g_object_unref0 (bcc_label);
	_g_object_unref0 (cc_grid);
	_g_object_unref0 (cc_label);
	_g_object_unref0 (subject_label);
	_g_object_unref0 (to_label);
	_g_object_unref0 (from_grid);
	_g_object_unref0 (from_label);
	block18_data_unref (_data18_);
	_data18_ = NULL;
	return obj;
}

static void
mail_composer_widget_class_init (MailComposerWidgetClass * klass,
                                 gpointer klass_data)
{
	mail_composer_widget_parent_class = g_type_class_peek_parent (klass);
	g_type_class_adjust_private_offset (klass, &MailComposerWidget_private_offset);
	((GtkWidgetClass *) klass)->destroy = (void (*) (GtkWidget*)) mail_composer_widget_real_destroy;
	G_OBJECT_CLASS (klass)->get_property = _vala_mail_composer_widget_get_property;
	G_OBJECT_CLASS (klass)->set_property = _vala_mail_composer_widget_set_property;
	G_OBJECT_CLASS (klass)->constructor = mail_composer_widget_constructor;
	G_OBJECT_CLASS (klass)->finalize = mail_composer_widget_finalize;
	g_object_class_install_property (G_OBJECT_CLASS (klass), MAIL_COMPOSER_WIDGET_HAS_RECIPIENTS_PROPERTY, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_HAS_RECIPIENTS_PROPERTY] = g_param_spec_boolean ("has-recipients", "has-recipients", "has-recipients", FALSE, G_PARAM_STATIC_STRINGS | G_PARAM_READABLE | G_PARAM_WRITABLE));
	g_object_class_install_property (G_OBJECT_CLASS (klass), MAIL_COMPOSER_WIDGET_HAS_SUBJECT_FIELD_PROPERTY, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_HAS_SUBJECT_FIELD_PROPERTY] = g_param_spec_boolean ("has-subject-field", "has-subject-field", "has-subject-field", FALSE, G_PARAM_STATIC_STRINGS | G_PARAM_READABLE | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
	g_object_class_install_property (G_OBJECT_CLASS (klass), MAIL_COMPOSER_WIDGET_CAN_CHANGE_SENDER_PROPERTY, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_CAN_CHANGE_SENDER_PROPERTY] = g_param_spec_boolean ("can-change-sender", "can-change-sender", "can-change-sender", TRUE, G_PARAM_STATIC_STRINGS | G_PARAM_READABLE));
	g_object_class_install_property (G_OBJECT_CLASS (klass), MAIL_COMPOSER_WIDGET_TO_PROPERTY, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_TO_PROPERTY] = g_param_spec_string ("to", "to", "to", NULL, G_PARAM_STATIC_STRINGS | G_PARAM_READABLE | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
	g_object_class_install_property (G_OBJECT_CLASS (klass), MAIL_COMPOSER_WIDGET_MAILTO_QUERY_PROPERTY, mail_composer_widget_properties[MAIL_COMPOSER_WIDGET_MAILTO_QUERY_PROPERTY] = g_param_spec_string ("mailto-query", "mailto-query", "mailto-query", NULL, G_PARAM_STATIC_STRINGS | G_PARAM_READABLE | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
	mail_composer_widget_signals[MAIL_COMPOSER_WIDGET_DISCARDED_SIGNAL] = g_signal_new ("discarded", MAIL_TYPE_COMPOSER_WIDGET, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
	mail_composer_widget_signals[MAIL_COMPOSER_WIDGET_SENT_SIGNAL] = g_signal_new ("sent", MAIL_TYPE_COMPOSER_WIDGET, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
	mail_composer_widget_signals[MAIL_COMPOSER_WIDGET_SUBJECT_CHANGED_SIGNAL] = g_signal_new ("subject-changed", MAIL_TYPE_COMPOSER_WIDGET, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__STRING, G_TYPE_NONE, 1, G_TYPE_STRING);
}

static void
mail_composer_widget_instance_init (MailComposerWidget * self,
                                    gpointer klass)
{
	self->priv = mail_composer_widget_get_instance_private (self);
	self->priv->_has_subject_field = FALSE;
	self->priv->_can_change_sender = TRUE;
	self->priv->discard_draft = FALSE;
	self->priv->ancestor_message_info = NULL;
}

static void
mail_composer_widget_finalize (GObject * obj)
{
	MailComposerWidget * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, MAIL_TYPE_COMPOSER_WIDGET, MailComposerWidget);
	_g_free0 (self->priv->_to);
	_g_free0 (self->priv->_mailto_query);
	_g_object_unref0 (self->priv->ancestor_message_info);
	_g_object_unref0 (self->priv->web_view);
	_g_object_unref0 (self->priv->actions);
	_g_object_unref0 (self->priv->to_val);
	_g_object_unref0 (self->priv->cc_val);
	_g_object_unref0 (self->priv->bcc_val);
	_g_object_unref0 (self->priv->attachment_box);
	_g_object_unref0 (self->priv->from_revealer);
	_g_object_unref0 (self->priv->cc_revealer);
	_g_object_unref0 (self->priv->bcc_revealer);
	_g_object_unref0 (self->priv->cc_button);
	_g_object_unref0 (self->priv->message_url_overlay);
	_g_object_unref0 (self->priv->from_combo);
	_g_object_unref0 (self->priv->subject_val);
	G_OBJECT_CLASS (mail_composer_widget_parent_class)->finalize (obj);
}

static GType
mail_composer_widget_get_type_once (void)
{
	static const GTypeInfo g_define_type_info = { sizeof (MailComposerWidgetClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) mail_composer_widget_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (MailComposerWidget), 0, (GInstanceInitFunc) mail_composer_widget_instance_init, NULL };
	GType mail_composer_widget_type_id;
	mail_composer_widget_type_id = g_type_register_static (gtk_grid_get_type (), "MailComposerWidget", &g_define_type_info, 0);
	MailComposerWidget_private_offset = g_type_add_instance_private (mail_composer_widget_type_id, sizeof (MailComposerWidgetPrivate));
	return mail_composer_widget_type_id;
}

GType
mail_composer_widget_get_type (void)
{
	static volatile gsize mail_composer_widget_type_id__once = 0;
	if (g_once_init_enter (&mail_composer_widget_type_id__once)) {
		GType mail_composer_widget_type_id;
		mail_composer_widget_type_id = mail_composer_widget_get_type_once ();
		g_once_init_leave (&mail_composer_widget_type_id__once, mail_composer_widget_type_id);
	}
	return mail_composer_widget_type_id__once;
}

static void
_vala_mail_composer_widget_get_property (GObject * object,
                                         guint property_id,
                                         GValue * value,
                                         GParamSpec * pspec)
{
	MailComposerWidget * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, MAIL_TYPE_COMPOSER_WIDGET, MailComposerWidget);
	switch (property_id) {
		case MAIL_COMPOSER_WIDGET_HAS_RECIPIENTS_PROPERTY:
		g_value_set_boolean (value, mail_composer_widget_get_has_recipients (self));
		break;
		case MAIL_COMPOSER_WIDGET_HAS_SUBJECT_FIELD_PROPERTY:
		g_value_set_boolean (value, mail_composer_widget_get_has_subject_field (self));
		break;
		case MAIL_COMPOSER_WIDGET_CAN_CHANGE_SENDER_PROPERTY:
		g_value_set_boolean (value, mail_composer_widget_get_can_change_sender (self));
		break;
		case MAIL_COMPOSER_WIDGET_TO_PROPERTY:
		g_value_set_string (value, mail_composer_widget_get_to (self));
		break;
		case MAIL_COMPOSER_WIDGET_MAILTO_QUERY_PROPERTY:
		g_value_set_string (value, mail_composer_widget_get_mailto_query (self));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}

static void
_vala_mail_composer_widget_set_property (GObject * object,
                                         guint property_id,
                                         const GValue * value,
                                         GParamSpec * pspec)
{
	MailComposerWidget * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, MAIL_TYPE_COMPOSER_WIDGET, MailComposerWidget);
	switch (property_id) {
		case MAIL_COMPOSER_WIDGET_HAS_RECIPIENTS_PROPERTY:
		mail_composer_widget_set_has_recipients (self, g_value_get_boolean (value));
		break;
		case MAIL_COMPOSER_WIDGET_HAS_SUBJECT_FIELD_PROPERTY:
		mail_composer_widget_set_has_subject_field (self, g_value_get_boolean (value));
		break;
		case MAIL_COMPOSER_WIDGET_CAN_CHANGE_SENDER_PROPERTY:
		mail_composer_widget_set_can_change_sender (self, g_value_get_boolean (value));
		break;
		case MAIL_COMPOSER_WIDGET_TO_PROPERTY:
		mail_composer_widget_set_to (self, g_value_get_string (value));
		break;
		case MAIL_COMPOSER_WIDGET_MAILTO_QUERY_PROPERTY:
		mail_composer_widget_set_mailto_query (self, g_value_get_string (value));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}

static void
_vala_array_destroy (gpointer array,
                     gssize array_length,
                     GDestroyNotify destroy_func)
{
	if ((array != NULL) && (destroy_func != NULL)) {
		gssize i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}

static void
_vala_array_free (gpointer array,
                  gssize array_length,
                  GDestroyNotify destroy_func)
{
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}

static gssize
_vala_array_length (gpointer array)
{
	gssize length;
	length = 0;
	if (array) {
		while (((gpointer*) array)[length]) {
			length++;
		}
	}
	return length;
}

